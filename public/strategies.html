<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AlgoHive – Strategy Factsheet</title>

  <!-- Tailwind + Fonts + Icons -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"/>

  <style>
    :root{ --page:#0b1220; --bg:#f9fafb; --muted:#64748b; --ink:#0f172a; --olive:#556B2F; --brand:#f59e0b; --line:#e5e7f0 }
    html,body{ font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif; background:var(--bg); color:var(--ink) }
    .card{ background:#fff; border:1px solid #e5e7eb; border-radius:16px; box-shadow:0 1px 2px rgba(0,0,0,.04) }
    .btn{ display:inline-flex; align-items:center; justify-content:center; gap:.5rem; height:40px; padding:0 .875rem; border-radius:10px; border:1px solid var(--line); font-weight:600 }
    .chip{ display:inline-flex; align-items:center; border-radius:9999px; padding:.2rem .55rem; font-size:.74rem; font-weight:600 }
    .tab-btn{ border:1px solid #e5e7eb; border-radius:.6rem; padding:.35rem .7rem; font-size:.85rem; background:#fff }
    .tab-btn.active{ background:var(--olive); border-color:var(--olive); color:#fff }
    .legend-dot{ width:10px; height:10px; border-radius:9999px; display:inline-block }
    .kv td{ padding:.4rem .6rem; border-bottom:1px solid #e5e7eb; font-size:.9rem }
    .kv td:first-child{ color:#64748b; width:46% }
    .hm td{ border:1px solid #e5e7eb; font-size:.78rem; text-align:right; padding:.3rem .4rem }
    .hm th{ border:1px solid #e5e7eb; font-size:.72rem; padding:.3rem .4rem; background:#f8fafc; text-align:center }
    .hm .y{ text-align:left; font-weight:600 }
    .topbar{ height:52px }

    /* Layout / Sidebar (KEPT) */
    #layout{ --sb:220px; display:grid; grid-template-columns:var(--sb) 1fr; min-height:100vh }
    #layout.is-collapsed{ --sb:64px }
    #ah-sidebar{ transition: width .2s ease; width:var(--sb) }
    #ah-sidebar[data-collapsed="true"] .label, #ah-sidebar[data-collapsed="true"] .chevron{ display:none }
    #ah-sidebar details .sub{ transition: height .2s ease }
    #ah-sidebar[data-collapsed="true"] details>.sub{ display:none!important }
    #ah-sidebar[data-collapsed="true"] nav a, #ah-sidebar[data-collapsed="true"] details>summary{ justify-content:center; gap:.25rem }
    #ah-sidebar[data-collapsed="true"] details>summary span{ gap:0 }
    #ah-sidebar .footer{ transition:all .2s ease }
    #ah-sidebar[data-collapsed="true"] .footer{ justify-content:center; flex-direction:column; gap:12px }
    #ah-sidebar[data-collapsed="true"] .btn-collapse :is(svg,i){ transform:rotate(180deg) }
  </style>
</head>

<body class="min-h-screen overflow-x-hidden">
  <div id="layout">
    <!-- ===== Sidebar (KEPT from your setup) ===== -->
    <aside id="ah-sidebar" data-collapsed="false" class="border-r border-slate-200 h-[100vh] sticky top-0 bg-white flex flex-col overflow-hidden">
      <div class="px-4 py-4 flex items-center gap-3 border-b border-slate-200">
        <img src="https://static.wixstatic.com/media/ac771e_af06d86a7a1f4abd87e52e45f3bcbd96~mv2.png" alt="AlgoHive Logo" class="w-10 h-10 object-contain"/>
        <div class="min-w-0">
          <div class="font-bold text-[15px] text-slate-900 label">AlgoHive</div>
          <div class="text-[11px] text-slate-500 label">ID: <span id="sidebar-acc">—</span></div>
        </div>
      </div>

      <nav class="p-2 text-[14px] flex-1 overflow-y-auto">
        <a class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-slate-50 font-medium text-slate-900 bg-slate-100" href="home.html" title="Home">
          <i class="fa-solid fa-house text-slate-500 w-4 shrink-0"></i><span class="label">Home</span>
        </a>

        <details class="group mt-1">
          <summary class="flex items-center justify-between px-3 py-2 rounded-lg hover:bg-slate-50 cursor-pointer font-medium text-slate-900">
            <span class="flex items-center gap-3"><i class="fa-regular fa-user w-4 text-slate-500"></i><span class="label">Portfolio</span></span>
            <i class="fa-solid fa-chevron-down text-slate-400 group-open:rotate-180 transition-transform chevron"></i>
          </summary>
          <div class="ml-8 mt-1 flex flex-col sub">
            <a class="px-3 py-2 rounded-lg hover:bg-slate-50 flex items-center gap-2" href="#" title="Positions"><i class="fa-solid fa-chart-pie w-4 text-slate-500"></i><span class="label">Positions</span></a>
            <a class="px-3 py-2 rounded-lg hover:bg-slate-50 flex items-center gap-2" href="#" title="Orders"><i class="fa-regular fa-clipboard w-4 text-slate-500"></i><span class="label">Orders</span></a>
            <a class="px-3 py-2 rounded-lg hover:bg-slate-50 flex items-center gap-2" href="#" title="Activity"><i class="fa-solid fa-bars w-4 text-slate-500"></i><span class="label">Activity</span></a>
            <a class="px-3 py-2 rounded-lg hover:bg-slate-50 flex items-center gap-2" href="#" title="Balances"><i class="fa-solid fa-table w-4 text-slate-500"></i><span class="label">Balances</span></a>
            <a class="px-3 py-2 rounded-lg hover:bg-slate-50 flex items-center gap-2" href="#" title="Funding"><i class="fa-solid fa-hand-holding-dollar w-4 text-slate-500"></i><span class="label">Funding</span></a>
          </div>
        </details>

        <details class="group mt-1" open>
          <summary class="flex items-center justify-between px-3 py-2 rounded-lg hover:bg-slate-50 cursor-pointer font-medium text-slate-900">
            <span class="flex items-center gap-3"><i class="fa-solid fa-link w-4 text-slate-500"></i><span class="label">Invest</span></span>
            <i class="fa-solid fa-chevron-down text-slate-400 group-open:rotate-180 transition-transform chevron"></i>
          </summary>
          <div class="ml-8 mt-1 flex flex-col sub">
            <a class="px-3 py-2 rounded-lg hover:bg-slate-50 flex items-center gap-2 bg-slate-100" href="strategies.html" title="OpenStrategies"><i class="fa-solid fa-chart-line w-4 text-slate-500"></i><span class="label">OpenStrategies</span></a>
            <a class="px-3 py-2 rounded-lg hover:bg-slate-50 flex items-center gap-2" href="#" title="Funds"><i class="fa-solid fa-coins w-4 text-slate-500"></i><span class="label">Funds</span></a>
          </div>
        </details>

        <a class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-slate-50" href="pricing.html" title="Plans & Features"><i class="fa-regular fa-square-check w-4 text-slate-500"></i><span class="label">Plans & Features</span></a>
        <a class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-slate-50" href="#" title="Community"><i class="fa-regular fa-comments w-4 text-slate-500"></i><span class="label">Community</span></a>
        <a class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-slate-50" href="#" title="Support"><i class="fa-solid fa-life-ring w-4 text-slate-500"></i><span class="label">Support</span></a>
        <a class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-slate-50" href="#" title="Legal"><i class="fa-solid fa-scale-balanced w-4 text-slate-500"></i><span class="label">Legal</span></a>
      </nav>

      <div class="p-3 border-t border-slate-200 footer flex items-center justify-between gap-2">
        <button id="ah-settings" class="btn btn-settings h-10 w-10 p-0 rounded-xl bg-slate-100 hover:bg-slate-200 border-0" title="Settings">
          <i class="fa-solid fa-gear"></i>
        </button>
        <button id="ah-collapse" class="btn btn-collapse h-10 w-10 p-0 rounded-xl bg-slate-100 hover:bg-slate-200 border-0" title="Collapse">
          <i class="fa-solid fa-arrow-left"></i>
        </button>
      </div>
    </aside>

    <!-- ===== Main ===== -->
    <main class="flex-1 min-w-0">
      <!-- Header (KEPT) -->
      <div class="flex items-center justify-between px-6 py-4 border-b border-slate-200 bg-white">
        <div class="flex items-center gap-3 flex-1 min-w-0 max-w-[460px]">
          <div class="relative w-full">
            <input class="input w-full pl-9" placeholder="Search"/>
            <svg class="w-4 h-4 absolute left-3 top-1/2 -translate-y-1/2 text-slate-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/>
            </svg>
          </div>
        </div>

        <!-- Profile (dummy) -->
        <div class="flex items-center gap-3">
          <button class="relative h-10 w-10 rounded-full border border-slate-200 grid place-items-center hover:bg-slate-50" aria-label="Notifications">
            <i class="fa-regular fa-bell text-slate-500"></i>
            <span class="absolute -top-0.5 -right-0.5 h-2.5 w-2.5 rounded-full bg-orange-500 ring-2 ring-white"></span>
          </button>

          <img id="hdr-avatar"
               src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='36' height='36'><rect width='100%' height='100%' fill='%23f1f5f9'/></svg>"
               alt="Profile" class="w-9 h-9 rounded-full object-cover border border-slate-200"/>

          <button id="hdr-profile-btn" class="flex items-center gap-2 text-slate-900 font-medium hover:text-slate-700">
            <span id="hdr-name">User</span>
            <i class="fa-solid fa-chevron-down text-slate-500 text-xs"></i>
          </button>
        </div>
      </div>

      <!-- ===== Factsheet MAIN (dummy data) ===== -->
      <div class="max-w-7xl mx-auto px-6">
        <!-- Topbar row (like your preferred page) -->
        <section class="sticky top-0 z-10 bg-white/70 backdrop-blur border-b border-slate-200 mt-0 px-0 py-3 hidden md:block">
          <div class="flex items-center gap-3">
            <a href="strategies.html" class="text-sm text-slate-600 hover:underline">Strategies</a>
            <i class="fa-solid fa-chevron-right text-xs text-slate-400"></i>
            <div class="text-sm text-slate-900 font-medium">Factsheet</div>
            <button id="btnAllocateTop" class="ml-auto rounded-lg h-9 px-3 bg-[var(--olive)] text-white"><i class="fa-solid fa-plus mr-2"></i>Allocate</button>
          </div>
        </section>

        <!-- Header / Selector -->
        <section class="pt-6">
          <div class="flex flex-wrap items-center gap-4 justify-between">
            <div class="min-w-0">
              <div class="flex items-center gap-2 text-xs text-slate-500">
                <span class="uppercase tracking-wider">Strategy Factsheet</span>
                <span class="hidden sm:inline">•</span>
                <span id="fsUpdated" class="hidden sm:inline">Updated just now</span>
              </div>
              <h1 id="fsTitle" class="text-[28px] leading-tight font-semibold truncate">Trend Alpha (Dummy)</h1>
              <div class="flex flex-wrap items-center gap-2 mt-1 text-sm text-slate-600">
                <span id="fsProvider">AlgoForge</span>
                <span>•</span>
                <span id="fsSince">Live since Feb 1, 2021</span>
                <span>•</span>
                <span id="fsCurrency">ZAR</span>
                <span class="chip bg-amber-50 text-amber-700" id="fsRisk">Risk Moderate</span>
                <span class="chip bg-emerald-50 text-emerald-700" id="fsAum">AUM R1,200,000</span>
              </div>
            </div>
            <div class="flex items-center gap-3">
              <select id="strategySel" class="border rounded-lg text-sm px-2 py-1">
                <option value="trend-alpha">Trend Alpha</option>
                <option value="momentum-fx">Momentum FX</option>
              </select>
              <button id="btnShare" class="border rounded-lg px-3 py-1.5 text-sm bg-white"><i class="fa-solid fa-link mr-2"></i>Copy Link</button>
            </div>
          </div>
        </section>

        <!-- Content Grid -->
        <section class="py-6 grid grid-cols-1 lg:grid-cols-12 gap-6">
          <!-- LEFT MAIN -->
          <div class="lg:col-span-8 xl:col-span-9 space-y-6">
            <!-- Growth + Key Metrics + Tabs -->
            <div class="card p-5">
              <div class="flex flex-wrap items-center justify-between gap-3 mb-3">
                <div>
                  <div class="text-sm text-slate-600">Investment Growth (Net of TIF)</div>
                  <div class="flex items-center gap-2">
                    <div id="eqValue" class="text-2xl font-semibold">R1,087,000</div>
                    <span id="eqDelta" class="chip bg-green-50 text-green-700">+8.7%</span>
                  </div>
                </div>
                <div class="flex items-center gap-4 text-xs">
                  <span><span class="legend-dot" style="background:#0f172a"></span> Portfolio</span>
                  <span><span class="legend-dot" style="background:#556B2F"></span> Benchmark</span>
                </div>
                <div class="flex gap-2" id="eqTabs">
                  <button class="tab-btn active" data-range="1Y">1Y</button>
                  <button class="tab-btn" data-range="3Y">3Y</button>
                  <button class="tab-btn" data-range="ALL">All</button>
                </div>
              </div>
              <div class="mb-4 grid grid-cols-2 sm:grid-cols-6 gap-3 text-sm">
                <div class="p-3 border rounded-xl"><div class="text-slate-500 text-xs">CAGR</div><div id="mCagr" class="font-semibold">+12.4%</div></div>
                <div class="p-3 border rounded-xl"><div class="text-slate-500 text-xs">Volatility (ann.)</div><div id="mVol" class="font-semibold">8.9%</div></div>
                <div class="p-3 border rounded-xl"><div class="text-slate-500 text-xs">Sharpe (sim.)</div><div id="mSharpe" class="font-semibold">1.21</div></div>
                <div class="p-3 border rounded-xl"><div class="text-slate-500 text-xs">Max Drawdown</div><div id="mDD" class="font-semibold">-6.7%</div></div>
                <div class="p-3 border rounded-xl"><div class="text-slate-500 text-xs">Win Rate</div><div id="mWin" class="font-semibold">61%</div></div>
                <div class="p-3 border rounded-xl"><div class="text-slate-500 text-xs">Avg Monthly</div><div id="mAvg" class="font-semibold">+0.9%</div></div>
              </div>
              <div class="relative w-full h-[320px] overflow-hidden rounded-xl border bg-white">
                <svg id="growthSvg" viewBox="0 0 900 320" class="w-full h-full"></svg>
              </div>
              <div class="mt-2 text-xs text-slate-500">* TIF (Total Investment Fee) applied as a monthly deduction.</div>
            </div>

            <!-- Monthly Returns Heatmap -->
            <div class="card p-5">
              <div class="flex items-center justify-between mb-3">
                <div class="font-semibold">Monthly Returns (by Year)</div>
                <div class="text-xs text-slate-500">% net of TIF</div>
              </div>
              <div class="overflow-x-auto">
                <table id="heatmap" class="hm w-full bg-white rounded-lg"></table>
              </div>
            </div>

            <!-- Drawdown & Rolling Sharpe -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
              <div class="card p-5">
                <div class="font-semibold mb-2">Drawdown (from peak)</div>
                <div class="w-full h-[220px] relative overflow-hidden rounded-xl border bg-white">
                  <svg id="ddSvg" viewBox="0 0 900 220" class="w-full h-full"></svg>
                </div>
              </div>
              <div class="card p-5">
                <div class="font-semibold mb-2">Rolling 12M Sharpe (sim.)</div>
                <div class="w-full h-[220px] relative overflow-hidden rounded-xl border bg-white">
                  <svg id="rollSvg" viewBox="0 0 900 220" class="w-full h-full"></svg>
                </div>
              </div>
            </div>

            <!-- Allocation (%) -->
            <div class="card p-5">
              <div class="flex items-center justify-between mb-2">
                <div class="font-semibold">Asset Allocation (%)</div>
                <div class="text-xs text-slate-500">Percentage</div>
              </div>
              <div class="w-full h-[260px] relative overflow-hidden rounded-xl border bg-white">
                <svg id="allocSvg" viewBox="0 0 900 260" class="w-full h-full"></svg>
              </div>
            </div>

            <!-- Holdings donut -->
            <div class="card p-5">
              <div class="font-semibold mb-2">Portfolio Holdings (Neutral)</div>
              <div class="flex items-center gap-4">
                <svg id="holdingsDonut" viewBox="0 0 180 180" class="h-40 w-40"></svg>
                <div id="holdingsLegend" class="text-sm grow"></div>
              </div>
            </div>

            <!-- Costs -->
            <div class="card p-5">
              <div class="font-semibold mb-2">What Costs Can I Expect to Pay?</div>
              <table class="w-full text-sm">
                <thead class="text-slate-500">
                  <tr><th class="text-left py-2">Fee</th><th class="text-right py-2">Incl. VAT</th></tr>
                </thead>
                <tbody id="costRows" class="divide-y">
                  <tr><td class="py-2">Model Portfolio Charge (MPC)</td><td class="py-2 text-right">1.26%</td></tr>
                  <tr><td class="py-2">Total Investment Fee (TIF)</td><td class="py-2 text-right">1.51%</td></tr>
                </tbody>
              </table>
              <div class="text-xs text-slate-500 mt-2">Please refer to the end of the factsheet for detailed notes on fees.</div>
            </div>

            <!-- Important Information -->
            <div class="card p-5">
              <div class="font-semibold mb-2">Important Information</div>
              <p class="text-sm text-slate-600 leading-relaxed">
                Past performance is not indicative of future results. Returns are shown <strong>net of TIF</strong> and before brokerage, slippage and taxes.
                Trading and investing involve risk, including the possible loss of capital. AlgoHive is an authorised Financial Services Provider (FSP No. 55118) regulated by the FSCA in South Africa.
                This factsheet is for information only and does not constitute advice.
              </p>
            </div>
          </div>

          <!-- RIGHT RAIL -->
          <aside class="lg:col-span-4 xl:col-span-3 space-y-6">
            <div class="card p-5">
              <div class="font-semibold mb-2">Portfolio Information</div>
              <table class="kv w-full">
                <tbody id="keyFacts">
                  <tr><td>Discretionary Manager</td><td class="text-right">AlgoHive Multi-Manager</td></tr>
                  <tr><td>Client Need</td><td class="text-right">Moderate growth</td></tr>
                  <tr><td>Benchmark</td><td class="text-right">SA CPI +4%</td></tr>
                  <tr><td>Inception Date</td><td class="text-right">2021-02-01</td></tr>
                  <tr><td>Risk Profile</td><td class="text-right">Moderate</td></tr>
                </tbody>
              </table>
            </div>

            <div class="card p-5">
              <div class="font-semibold mb-2">Strategy Overview</div>
              <p id="fsDesc" class="text-sm text-slate-700">Medium-term trend-following on large-cap equities and index ETFs with systematic risk controls.</p>
              <div class="grid grid-cols-2 gap-3 text-sm mt-3">
                <div class="p-3 border rounded-xl"><div class="text-slate-500 text-xs">Style</div><div id="fsStyle" class="font-semibold">Trend-Following</div></div>
                <div class="p-3 border rounded-xl"><div class="text-slate-500 text-xs">Universe</div><div id="fsUniverse" class="font-semibold">Global Equities & ETFs</div></div>
                <div class="p-3 border rounded-xl"><div class="text-slate-500 text-xs">Avg Holding</div><div id="fsHold" class="font-semibold">25–45 days</div></div>
                <div class="p-3 border rounded-xl"><div class="text-slate-500 text-xs">Trades / Month</div><div id="fsTrades" class="font-semibold">18</div></div>
              </div>
            </div>

            <div class="card p-5">
              <div class="font-semibold mb-1">Risk Description</div>
              <p class="text-sm text-slate-700 leading-relaxed">Accepts moderate market volatility in exchange for potential inflation-beating returns.</p>
              <div class="font-semibold mb-1 mt-4">Investment Objective</div>
              <p class="text-sm text-slate-700 leading-relaxed">Provide moderate long-term total return with low probability of capital loss over the medium term.</p>
              <div class="font-semibold mb-1 mt-4">Investment Strategy</div>
              <p class="text-sm text-slate-700 leading-relaxed">Dual-bucket rebalancing with a risk-managed equity trend sleeve and flexible income sleeve; volatility targeting and dynamic stops.</p>
            </div>
          </aside>
        </section>
      </div>
    </main>
  </div>

  <!-- Profile Modal (simple) -->
  <div id="profile-modal" class="fixed inset-0 z-[100] hidden">
    <div class="absolute inset-0 bg-black/40"></div>
    <div class="absolute right-6 top-20 w-64 rounded-2xl bg-white shadow-xl border border-slate-200 overflow-hidden">
      <div class="px-4 py-3 border-b border-slate-200">
        <div class="text-sm font-semibold text-slate-900">Account</div>
        <div id="pm-email" class="text-xs text-slate-500 truncate">user@example.com</div>
      </div>
      <div class="p-2">
        <a id="pm-profile" href="/settings.html#basic" class="w-full flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-slate-50">
          <i class="fa-regular fa-user text-slate-500 w-4"></i>
          <span>Profile settings</span>
        </a>
        <button id="pm-logout" class="w-full flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-slate-50 text-rose-700">
          <i class="fa-solid fa-right-from-bracket w-4"></i>
          <span>Log out</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script>
    // Sidebar collapse memory
    (function(){
      const layout=document.getElementById('layout');
      const aside=document.getElementById('ah-sidebar');
      const btn=document.getElementById('ah-collapse');
      const saved=localStorage.getItem('ah_collapsed')==='true';
      if(saved){ aside.setAttribute('data-collapsed','true'); layout.classList.add('is-collapsed'); }
      btn.addEventListener('click',()=>{
        const isCollapsed=aside.getAttribute('data-collapsed')==='true';
        if(!isCollapsed) aside.querySelectorAll('details[open]').forEach(d=>d.removeAttribute('open'));
        aside.setAttribute('data-collapsed', String(!isCollapsed));
        layout.classList.toggle('is-collapsed', !isCollapsed);
        localStorage.setItem('ah_collapsed', String(!isCollapsed));
        layout.offsetHeight; window.dispatchEvent(new Event('resize'));
      });
    })();

    // Simple helpers
    const fmtMoneyZA = (v)=> new Intl.NumberFormat('en-ZA',{style:'currency',currency:'ZAR',maximumFractionDigits:0}).format(v);

    // ===== SVG helpers (no libs) =====
    function drawGrowth(svgEl, port, bench, labels){
      const W=900, H=320, padL=44, padR=12, padT=16, padB=28;
      svgEl.innerHTML='';
      const all = port.concat(bench);
      const mn = Math.min(...all), mx = Math.max(...all), rng=(mx-mn)||1;
      for(let i=0;i<4;i++){ const y=padT+i*(H-padT-padB)/3; const ln=document.createElementNS('http://www.w3.org/2000/svg','line'); ln.setAttribute('x1',padL); ln.setAttribute('x2',W-padR); ln.setAttribute('y1',y); ln.setAttribute('y2',y); ln.setAttribute('stroke','#e5e7eb'); ln.setAttribute('stroke-width','1'); svgEl.appendChild(ln); }
      const step=(W-padL-padR)/(port.length-1);
      const X=i=> padL+i*step, Y=v=> padT + (mx-v)*((H-padT-padB)/rng);
      function pathFor(arr){ let d=''; arr.forEach((v,i)=>{ d+=(i?'L':'M')+X(i).toFixed(2)+','+Y(v).toFixed(2)+' '; }); return d.trim(); }
      const pPath=document.createElementNS('http://www.w3.org/2000/svg','path'); pPath.setAttribute('d',pathFor(port)); pPath.setAttribute('fill','none'); pPath.setAttribute('stroke','#0f172a'); pPath.setAttribute('stroke-width','2.6'); svgEl.appendChild(pPath);
      const bPath=document.createElementNS('http://www.w3.org/2000/svg','path'); bPath.setAttribute('d',pathFor(bench)); bPath.setAttribute('fill','none'); bPath.setAttribute('stroke','#556B2F'); bPath.setAttribute('stroke-width','2.2'); bPath.setAttribute('stroke-dasharray','4 4'); svgEl.appendChild(bPath);
      const g=document.createElementNS('http://www.w3.org/2000/svg','g');
      const stepL=(W-padL-padR)/(labels.length-1);
      labels.forEach((lb,i)=>{ if(i%6!==0 && i!==labels.length-1) return; const t=document.createElementNS('http://www.w3.org/2000/svg','text'); t.textContent=lb; t.setAttribute('x', padL+i*stepL); t.setAttribute('y', H-8); t.setAttribute('font-size','10'); t.setAttribute('text-anchor','middle'); t.setAttribute('fill','#64748b'); g.appendChild(t); });
      svgEl.appendChild(g);
    }
    function drawLine(svgEl, series, labels, {minY=null,maxY=null, padL=34,padR=12,padT=16,padB=26, color='#0f172a'}={}){
      const W=svgEl.viewBox.baseVal.width||900, H=svgEl.viewBox.baseVal.height||320;
      svgEl.innerHTML='';
      for(let i=0;i<4;i++){ const y=padT+i*(H-padT-padB)/3; const ln=document.createElementNS('http://www.w3.org/2000/svg','line'); ln.setAttribute('x1',padL);ln.setAttribute('x2',W-padR);ln.setAttribute('y1',y);ln.setAttribute('y2',y); ln.setAttribute('stroke','#e5e7eb'); ln.setAttribute('stroke-width','1'); svgEl.appendChild(ln); }
      const mn=(minY??Math.min(...series)), mx=(maxY??Math.max(...series)), rng=(mx-mn)||1; const step=(W-padL-padR)/(series.length-1);
      let d=''; series.forEach((v,i)=>{ const x=padL+i*step; const y= padT + (mx-v)*((H-padT-padB)/rng); d += (i?'L':'M')+x.toFixed(2)+','+y.toFixed(2)+' '; });
      const path=document.createElementNS('http://www.w3.org/2000/svg','path'); path.setAttribute('d',d.trim()); path.setAttribute('fill','none'); path.setAttribute('stroke',color); path.setAttribute('stroke-width','2.4'); svgEl.appendChild(path);
      if(labels){ const g=document.createElementNS('http://www.w3.org/2000/svg','g'); const n=labels.length; const stepL=(W-padL-padR)/(n-1); labels.forEach((lb,i)=>{ if(i%6!==0 && i!==n-1) return; const t=document.createElementNS('http://www.w3.org/2000/svg','text'); t.textContent=lb; t.setAttribute('x', padL+i*stepL); t.setAttribute('y', H-8); t.setAttribute('font-size','10'); t.setAttribute('text-anchor','middle'); t.setAttribute('fill','#64748b'); g.appendChild(t); }); svgEl.appendChild(g); }
    }
    function drawAllocBars(svgEl, rows){
      const W=900, H=260, padL=130, padR=26, padT=18, padB=28;
      svgEl.innerHTML='';
      const maxPct = Math.max(100, Math.max(...rows.map(r=>r.pct)));
      const X=v=> padL + (v/maxPct)*(W-padL-padR), Y=i=> padT + i*((H-padT-padB)/rows.length) + 8;
      for(let i=0;i<=5;i++){ const x=padL+i*(W-padL-padR)/5; const ln=document.createElementNS('http://www.w3.org/2000/svg','line'); ln.setAttribute('x1',x); ln.setAttribute('x2',x); ln.setAttribute('y1',padT); ln.setAttribute('y2',H-padB); ln.setAttribute('stroke','#e5e7eb'); ln.setAttribute('stroke-width','1'); svgEl.appendChild(ln); }
      rows.forEach((r,i)=>{
        const t=document.createElementNS('http://www.w3.org/2000/svg','text'); t.textContent=r.label; t.setAttribute('x', padL-8); t.setAttribute('y', Y(i)+4); t.setAttribute('font-size','11'); t.setAttribute('text-anchor','end'); t.setAttribute('fill','#334155'); svgEl.appendChild(t);
        const rect=document.createElementNS('http://www.w3.org/2000/svg','rect'); rect.setAttribute('x', padL); rect.setAttribute('y', Y(i)-8); rect.setAttribute('width', Math.max(1, X(r.pct)-padL)); rect.setAttribute('height', 16); rect.setAttribute('rx','4'); rect.setAttribute('fill', r.color || '#0f172a'); svgEl.appendChild(rect);
        const p=document.createElementNS('http://www.w3.org/2000/svg','text'); p.textContent=r.pct.toFixed(2)+'%'; p.setAttribute('x', X(r.pct)+6); p.setAttribute('y', Y(i)+4); p.setAttribute('font-size','11'); p.setAttribute('fill','#64748b'); svgEl.appendChild(p);
      });
      const g=document.createElementNS('http://www.w3.org/2000/svg','g');
      for(let i=0;i<=5;i++){ const v=i*20; const t=document.createElementNS('http://www.w3.org/2000/svg','text'); t.textContent=v+'%'; t.setAttribute('x', padL+i*(W-padL-padR)/5); t.setAttribute('y', H-10); t.setAttribute('font-size','10'); t.setAttribute('text-anchor','middle'); t.setAttribute('fill','#64748b'); g.appendChild(t); }
      svgEl.appendChild(g);
    }
    function drawDonut(svgEl, items){
      const cx=90, cy=90, r=62, R=72, TAU=Math.PI*2; svgEl.innerHTML='';
      const sum = items.reduce((s,i)=>s+i.pct,0) || 1; let a0=-Math.PI/2;
      items.forEach(it=>{ const frac = it.pct/sum, a1=a0+frac*TAU, la=(a1-a0)>Math.PI?1:0;
        const p0=[cx+R*Math.cos(a0), cy+R*Math.sin(a0)], p1=[cx+R*Math.cos(a1), cy+R*Math.sin(a1)];
        const q0=[cx+r*Math.cos(a1), cy+r*Math.sin(a1)], q1=[cx+r*Math.cos(a0), cy+r*Math.sin(a0)];
        const d=`M ${p0[0]} ${p0[1]} A ${R} ${R} 0 ${la} 1 ${p1[0]} ${p1[1]} L ${q0[0]} ${q0[1]} A ${r} ${r} 0 ${la} 0 ${q1[0]} ${q1[1]} Z`;
        const path=document.createElementNS('http://www.w3.org/2000/svg','path'); path.setAttribute('d',d); path.setAttribute('fill',it.color||'#0f172a'); path.setAttribute('opacity','.95'); svgEl.appendChild(path); a0=a1; });
      const tot=document.createElementNS('http://www.w3.org/2000/svg','text'); tot.textContent='100%'; tot.setAttribute('x',cx); tot.setAttribute('y',cy+5); tot.setAttribute('text-anchor','middle'); tot.setAttribute('font-size','16'); tot.setAttribute('font-weight','700'); svgEl.appendChild(tot);
    }

    // Heatmap builder
    function buildHeatmap(el, yearly){
      const years = Object.keys(yearly).sort((a,b)=> b-a);
      const head = ['<tr><th>Year</th>', ...['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'].map(m=>`<th>${m}</th>`), '<th>YTD</th></tr>'].join('');
      function cellBg(v){ if(v===null||v===undefined) return ''; const a=Math.min(1, Math.abs(v)/6); return `style="background:${v>=0?`rgba(16,185,129,${0.12+a*0.35})`:`rgba(239,68,68,${0.12+a*0.35})`}"`; }
      const rows = years.map(y=>{
        let ytd=0; const cells = Array.from({length:12}, (_,i)=>{ const v = yearly[y][i+1]; if(v!==undefined && v!==null){ ytd+=v; }
          return `<td ${cellBg(v)}>${v!==undefined && v!==null ? (v>=0?'+':'')+v.toFixed(1)+'%' : ''}</td>`; }).join('');
        return `<tr><td class="y">${y}</td>${cells}<td class="font-semibold ${ytd>=0?'text-emerald-700':'text-rose-700'}">${(ytd>=0?'+':'')+ytd.toFixed(1)}%</td></tr>`;
      }).join('');
      el.innerHTML = `<thead>${head}</thead><tbody>${rows}</tbody>`;
    }

    // ===== Dummy DATA =====
    const STRATS = {
      'trend-alpha': {
        name:'Trend Alpha', provider:'AlgoForge', currency:'ZAR', aum: 1200000, risk:'Moderate', inception:'2021-02-01',
        desc:'Medium-term trend-following model on large-cap equities and index ETFs with systematic risk management.',
        style:'Trend-Following', universe:'Global Equities & ETFs', avg_holding:'25–45 days', trades_pm: 18,
        costs:{ mpc:1.26, tif:1.51 },
        monthly_port:{
          2023:[0.8,1.0,-0.6,1.4,2.1,0.5,1.3,0.9,1.6,-0.7,1.2,1.0],
          2024:[1.1,0.7,0.6,1.0,0.9,1.0,0.4,0.6,1.1,0.8,0.9,1.0],
          2025:[0.9,0.6,0.7,0.8,0.4,0.5,0.7,0.6,0.8,0.7,0.6,0.5]
        },
        monthly_bench:{
          2023:[0.4,0.5,0.4,0.5,0.4,0.5,0.4,0.5,0.4,0.5,0.4,0.5],
          2024:[0.4,0.4,0.5,0.4,0.4,0.5,0.4,0.4,0.5,0.4,0.4,0.5],
          2025:[0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.4]
        },
        allocation:[
          {label:'SA Equity', pct:29.56, color:'#0f172a'},
          {label:'Offshore Equity', pct:25.49, color:'#3b82f6'},
          {label:'SA Cash', pct:10.44, color:'#94a3b8'},
          {label:'Offshore Bonds', pct:4.05, color:'#10b981'},
          {label:'Offshore Cash', pct:2.12, color:'#6ee7b7'},
          {label:'SA Property', pct:1.13, color:'#f59e0b'},
          {label:'Offshore Property', pct:1.05, color:'#f97316'}
        ],
        holdings:[
          {label:'AlgoHive Global Flexible Fund B3', pct:20.15, color:'#0f172a'},
          {label:'Stability Income Fund B1', pct:18.65, color:'#94a3b8'},
          {label:'Asc SA Absolute Prescient Fund B3', pct:10.07, color:'#3b82f6'},
          {label:'Stone Growth BCI Opportunity Fund B3', pct:7.85, color:'#64748b'},
          {label:'Allan Gray Balanced Fund R', pct:7.58, color:'#6366f1'},
          {label:'Baillie Gifford Worldwide Fund', pct:7.55, color:'#10b981'},
          {label:'Laurium SA Flexible Prescient Fund C1', pct:7.56, color:'#ef4444'},
          {label:'Ninety One Opportunity Fund Z', pct:7.23, color:'#f59e0b'},
          {label:'AlgoHive Multi-Asset Growth Fund', pct:7.08, color:'#3f6212'},
          {label:'Truffle SCI Flexible Fund R', pct:7.58, color:'#6b7280'}
        ]
      },
      'momentum-fx': {
        name:'Momentum FX', provider:'QuantBee', currency:'USD', aum: 820000, risk:'Low', inception:'2020-06-01',
        desc:'Diversified G10 momentum/carry strategy with low correlation to equities.',
        style:'FX Momentum', universe:'G10 FX', avg_holding:'2–7 days', trades_pm: 35,
        costs:{ mpc:1.10, tif:1.30 },
        monthly_port:{ 2023:[0.4,0.3,0.2,0.4,0.5,0.3,0.2,0.4,0.3,0.2,0.2,0.3], 2024:[0.4,0.3,0.2,0.4,0.5,0.3,0.2,0.4,0.3,0.2,0.2,0.3], 2025:[0.3,0.2,0.3,0.2,0.3,0.2,0.3,0.2,0.3,0.2,0.3,0.2] },
        monthly_bench:{ 2023:[0.2,0.2,0.2,0.2,0.2,0.2,0.2,0.2,0.2,0.2,0.2,0.2], 2024:[0.2,0.2,0.2,0.2,0.2,0.2,0.2,0.2,0.2,0.2,0.2,0.2], 2025:[0.2,0.2,0.2,0.2,0.2,0.2,0.2,0.2,0.2,0.2,0.2,0.2] },
        allocation:[ {label:'FX (G10 Majors)', pct:88.00, color:'#10b981'}, {label:'Cash', pct:12.00, color:'#94a3b8'} ],
        holdings:[ {label:'EURUSD', pct:22, color:'#0f172a'}, {label:'GBPUSD', pct:18, color:'#3b82f6'}, {label:'USDJPY', pct:16, color:'#6366f1'}, {label:'AUDUSD', pct:14, color:'#10b981'}, {label:'USDCAD', pct:12, color:'#f59e0b'}, {label:'USDCHF', pct:10, color:'#ef4444'}, {label:'NZDUSD', pct:8, color:'#94a3b8'} ]
      }
    };

    // Utilities for monthly → sequences
    function flattenMonthlyMap(m){ const years = Object.keys(m).map(n=>+n).sort((a,b)=>a-b); const vals=[], labels=[]; const months=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec']; years.forEach(y=>{ (m[y]||[]).forEach((v,i)=>{ vals.push(v); labels.push(`${months[i]} ${String(y).slice(2)}`); }); }); return {vals, labels}; }
    function sliceByRange(vals, labels, range){ if(range==='ALL') return {vals, labels}; const n = range==='3Y' ? 36 : 12; if(vals.length<=n) return {vals, labels}; return { vals: vals.slice(-n), labels: labels.slice(-n) }; }
    function applyTIFNet(monthlyPct, tifAnnualPct){ const mFee=(tifAnnualPct||0)/12; return monthlyPct.map(x=> x - mFee); }
    function seqFromMonthly(pcts, base=100){ const out=[base]; pcts.forEach(p=> out.push(out.at(-1)*(1+p/100))); return out; }
    function equityFromMonthly(pcts){ const eq=[1]; pcts.forEach(r=> eq.push(eq.at(-1)*(1+r/100))); return eq; }
    function calcMetricsFromMonthly(pcts){ const eq=equityFromMonthly(pcts), first=eq[0], last=eq.at(-1); const total=(last/first-1); const years=pcts.length/12; const cagr = Math.pow(1+total, 1/Math.max(years,1e-6)) - 1; const mR=pcts.map(x=>x/100); const avg=mR.reduce((a,b)=>a+b,0)/mR.length; const sdM=Math.sqrt(mR.reduce((a,b)=>a+Math.pow(b-avg,2),0)/mR.length)||1e-6; const volA= sdM * Math.sqrt(12); const sharpe = avg/sdM * Math.sqrt(12); let peak=eq[0], maxDD=0; const dds=eq.map(v=>{ peak=Math.max(peak,v); const dd=v/peak-1; maxDD=Math.min(maxDD,dd); return dd; }); const wins = pcts.filter(x=>x>0).length / pcts.length; const avgM = pcts.reduce((a,b)=>a+b,0)/pcts.length; return {eq, dds, cagr, volA, sharpe, maxDD:Math.abs(maxDD), wins, avgM}; }

    // Boot
    let currentKey='trend-alpha', eqRange='1Y';
    function renderFactsheet(key){
      const s = STRATS[key] || STRATS['trend-alpha']; currentKey=key;
      document.getElementById('fsTitle').textContent = s.name;
      document.getElementById('fsProvider').textContent = s.provider;
      document.getElementById('fsSince').textContent = 'Live since ' + new Date(s.inception).toLocaleDateString();
      document.getElementById('fsCurrency').textContent = s.currency;
      document.getElementById('fsRisk').textContent = 'Risk ' + s.risk;
      document.getElementById('fsAum').textContent = 'AUM ' + (s.currency==='ZAR'? fmtMoneyZA(s.aum): new Intl.NumberFormat('en-US',{style:'currency',currency:s.currency,maximumFractionDigits:0}).format(s.aum));
      document.getElementById('fsDesc').textContent = s.desc;
      document.getElementById('fsStyle').textContent = s.style; document.getElementById('fsUniverse').textContent = s.universe; document.getElementById('fsHold').textContent = s.avg_holding; document.getElementById('fsTrades').textContent = s.trades_pm;

      // monthly → net of TIF
      const port = flattenMonthlyMap(s.monthly_port);
      const bench = flattenMonthlyMap(s.monthly_bench);
      const portNet = applyTIFNet(port.vals, s.costs?.tif || 0);

      // Metrics
      const M = calcMetricsFromMonthly(portNet);
      document.getElementById('mCagr').textContent = (M.cagr*100>=0?'+':'')+(M.cagr*100).toFixed(1)+'%';
      document.getElementById('mVol').textContent  = (M.volA*100).toFixed(1)+'%';
      document.getElementById('mSharpe').textContent = M.sharpe.toFixed(2);
      document.getElementById('mDD').textContent = (-M.maxDD*100).toFixed(1)+'%'.replace('--','-');
      document.getElementById('mWin').textContent = (M.wins*100).toFixed(0)+'%';
      document.getElementById('mAvg').textContent = (M.avgM>=0?'+':'')+M.avgM.toFixed(2)+'%';

      // Equity curves for tabs
      const sliced = sliceByRange(portNet, port.labels, eqRange);
      const slicedBench = sliceByRange(bench.vals, bench.labels, eqRange);
      const eqPort = seqFromMonthly(sliced.vals, 100);
      const eqBench = seqFromMonthly(slicedBench.vals, 100);
      drawGrowth(document.getElementById('growthSvg'), eqPort, eqBench, sliced.labels);

      // Headline value & delta (base = R1m)
      const base=1_000_000; const eqMoney = seqFromMonthly(sliced.vals, base); const delta=((eqMoney.at(-1)/eqMoney[0])-1)*100;
      document.getElementById('eqValue').textContent = s.currency==='ZAR'? fmtMoneyZA(eqMoney.at(-1)) : new Intl.NumberFormat('en-US',{style:'currency',currency:s.currency}).format(eqMoney.at(-1));
      const dEl=document.getElementById('eqDelta'); dEl.textContent = (delta>=0?'+':'')+delta.toFixed(1)+'%'; dEl.className = 'chip '+(delta>=0?'bg-green-50 text-green-700':'bg-rose-50 text-rose-700');

      // Heatmap (net of TIF)
      const ymap = {}; Object.keys(s.monthly_port).forEach(y=>{ ymap[y] = {}; (s.monthly_port[y]||[]).forEach((v,i)=> ymap[y][i+1]= v - (s.costs?.tif||0)/12 ); });
      buildHeatmap(document.getElementById('heatmap'), ymap);

      // Drawdown & rolling sharpe
      const eqFull = equityFromMonthly(portNet); let peak=eqFull[0]; const ddPct = eqFull.map(v=>{ peak=Math.max(peak,v); return (v/peak-1)*100; });
      const ddSlice = ddPct.slice(-Math.max(ddPct.length, sliced.labels.length));
      drawLine(document.getElementById('ddSvg'), ddSlice, sliced.labels, {minY:-100,maxY:0,color:'#ef4444'});

      const win=12; const rolls=[]; for(let i=win;i<=portNet.length;i++){ const seg=portNet.slice(i-win,i).map(x=>x/100); const avg=seg.reduce((a,b)=>a+b,0)/seg.length; const sd=Math.sqrt(seg.reduce((a,b)=>a+Math.pow(b-avg,2),0)/seg.length)||1e-6; rolls.push((avg/sd)*Math.sqrt(12)); }
      const rLbls = port.labels.slice(win-1);
      drawLine(document.getElementById('rollSvg'), rolls, rLbls, {color:'#6366f1'});

      // Allocation & holdings
      drawAllocBars(document.getElementById('allocSvg'), s.allocation);
      drawDonut(document.getElementById('holdingsDonut'), s.holdings);
      document.getElementById('holdingsLegend').innerHTML = s.holdings.map(h=>`<div class="flex items-center justify-between py-1"><div class="flex items-center gap-2 min-w-0"><span class="legend-dot" style="background:${h.color}"></span><span class="truncate">${h.label}</span></div><div class="ml-3">${h.pct.toFixed(2)}%</div></div>`).join('');
    }

    // Init
    renderFactsheet('trend-alpha');
    document.querySelectorAll('#eqTabs .tab-btn').forEach(b=>{
      b.addEventListener('click',()=>{ document.querySelectorAll('#eqTabs .tab-btn').forEach(x=>x.classList.remove('active')); b.classList.add('active'); eqRange=b.dataset.range; renderFactsheet(currentKey); });
    });
    document.getElementById('strategySel').addEventListener('change', (e)=>{ renderFactsheet(e.target.value); });
    document.getElementById('btnShare').addEventListener('click', async ()=>{ const url=location.href; try{ await navigator.clipboard.writeText(url);}catch(e){} const btn=document.getElementById('btnShare'); const old=btn.innerHTML; btn.innerHTML='<i class="fa-solid fa-check mr-2"></i>Copied!'; setTimeout(()=>btn.innerHTML=old,1200); });
    document.getElementById('btnAllocateTop').addEventListener('click', ()=>{ location.href='open-strategies.html'; });

    // profile modal toggles (dummy)
    const modal=document.getElementById('profile-modal');
    document.getElementById('hdr-profile-btn')?.addEventListener('click',()=> modal.classList.toggle('hidden'));
    modal.addEventListener('click',(e)=>{ if(e.target===modal||e.target.classList.contains('bg-black/40')) modal.classList.add('hidden'); });
  </script>
</body>
</html>
