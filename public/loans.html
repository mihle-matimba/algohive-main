<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AlgoHive — Algolend Application</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
  <style>
    :root {
      color-scheme: light;
    }
    html, body {
      font-family: "Inter", system-ui, -apple-system, "Segoe UI", sans-serif;
      background: #f8fafc;
      color: #0f172a;
      min-height: 100%;
    }
    [data-step-item][data-status="complete"] {
      color: rgb(34 197 94);
    }
    [data-step-item][data-status="current"] {
      color: rgb(22 101 52);
      font-weight: 600;
    }
    [data-step-item][data-status="upcoming"] {
      color: rgb(148 163 184);
    }
    [data-bureau-outcome="approved"],
    [data-bank-status][data-outcome="success"],
    [data-mandate-status][data-outcome="success"],
    [data-application-state][data-tone="emerald"] {
      color: rgb(22 101 52);
    }
    [data-bureau-outcome="pending"],
    [data-bank-status][data-outcome="pending"],
    [data-mandate-status][data-outcome="pending"],
    [data-application-state][data-tone="amber"] {
      color: rgb(217 119 6);
    }
    [data-bureau-outcome="decline"],
    [data-bank-status][data-outcome="error"],
    [data-mandate-status][data-outcome="error"],
    [data-application-state][data-tone="rose"] {
      color: rgb(220 38 38);
    }
    [data-timeline-state]::before {
      content: "";
      position: absolute;
      inset-inline-start: 0;
      top: 0.75rem;
      width: 0.5rem;
      height: 0.5rem;
      border-radius: 999px;
      background: rgb(148 163 184);
    }
    [data-timeline-state][data-state="complete"]::before {
      background: rgb(34 197 94);
    }
    [data-timeline-state] {
      position: relative;
      padding-inline-start: 1.75rem;
    }
  </style>
</head>
<body class="min-h-screen">
  <header class="border-b border-slate-200 bg-white/90 backdrop-blur">
    <div class="mx-auto flex max-w-6xl items-center justify-between px-4 py-5">
      <a href="index.html" class="flex items-center gap-3 text-lg font-semibold text-slate-900">
        <img src="https://static.wixstatic.com/media/ac771e_af06d86a7a1f4abd87e52e45f3bcbd96~mv2.png" alt="AlgoHive logo" class="h-10 w-10" />
        <span>AlgoHive</span>
      </a>
      <div class="flex items-center gap-4 text-sm">
        <a href="support.html" class="inline-flex items-center gap-2 rounded-full border border-slate-200 px-4 py-2 font-semibold text-slate-600 transition hover:border-slate-300 hover:bg-white">Need help?</a>
        <div class="flex items-center gap-3 rounded-full border border-slate-200 bg-white/70 px-3 py-2 shadow-sm">
          <img id="hdr-avatar" alt="AlgoHive member avatar" class="h-10 w-10 rounded-full object-cover ring-2 ring-white" src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='56' height='56'><rect width='100%' height='100%' rx='18' ry='18' fill='%23f1f5f9'/><text x='50%' y='56%' text-anchor='middle' font-family='Inter, sans-serif' font-size='20' fill='%2363748b'>AH</text></svg>" />
          <div class="leading-tight">
            <p id="hdr-name" class="font-semibold text-slate-900">—</p>
            <p class="text-xs text-slate-500">Algolend applicant</p>
          </div>
        </div>
      </div>
    </div>
  </header>

  <main class="py-12">
    <div class="mx-auto grid max-w-6xl gap-10 px-4 lg:grid-cols-[minmax(0,1.35fr)_minmax(320px,360px)] lg:px-8">
      <section data-algolend-flow class="space-y-8">
        <div class="rounded-3xl border border-slate-200/60 bg-white shadow-xl">
          <div class="border-b border-slate-100 px-6 pb-6 pt-8">
            <p class="text-xs font-semibold uppercase tracking-[0.28em] text-emerald-600">Algolend</p>
            <div class="mt-4 flex flex-wrap items-center gap-3">
              <h1 class="text-3xl font-bold tracking-tight text-slate-900 sm:text-4xl">Complete your Algolend application</h1>
              <span class="rounded-full bg-emerald-50 px-3 py-1 text-xs font-semibold text-emerald-700">NCR compliant</span>
            </div>
            <p class="mt-4 max-w-2xl text-sm text-slate-600">
              We’ll guide you from consent through Experian checks, secure bank linking, personalised offers, contracts, and DebiCheck authentication.
              Your application state updates automatically and you can pick up right where you left off.
            </p>
          </div>
          <div class="px-6 pb-6 pt-4">
            <ol class="grid gap-3 sm:grid-cols-3 lg:grid-cols-4" data-stepper>
              <li data-step-item="consents" data-status="current" class="text-xs font-semibold uppercase tracking-[0.18em]">Consents</li>
              <li data-step-item="bureau" data-status="upcoming" class="text-xs font-semibold uppercase tracking-[0.18em]">Bureau</li>
              <li data-step-item="bank" data-status="upcoming" class="text-xs font-semibold uppercase tracking-[0.18em]">Bank link</li>
              <li data-step-item="offer" data-status="upcoming" class="text-xs font-semibold uppercase tracking-[0.18em]">Offer</li>
              <li data-step-item="contract" data-status="upcoming" class="text-xs font-semibold uppercase tracking-[0.18em]">Contract</li>
              <li data-step-item="mandate" data-status="upcoming" class="text-xs font-semibold uppercase tracking-[0.18em]">Mandate</li>
              <li data-step-item="disbursement" data-status="upcoming" class="text-xs font-semibold uppercase tracking-[0.18em]">Disburse</li>
            </ol>
          </div>
        </div>

        <div class="space-y-6">
          <article class="rounded-3xl border border-slate-200/60 bg-white p-6 shadow-xl" data-step="consents">
            <header class="space-y-2">
              <p class="text-xs font-semibold uppercase tracking-[0.3em] text-slate-500">Step 1</p>
              <h2 class="text-2xl font-semibold text-slate-900">Consents &amp; employment details</h2>
              <p class="text-sm text-slate-600">Provide bureau, bank-link, and DebiCheck consent so we can assess affordability securely.</p>
            </header>
            <form id="consent-form" class="mt-6 space-y-6">
              <div class="space-y-3 rounded-2xl border border-slate-100 bg-slate-50/70 p-4">
                <label class="flex items-start gap-3 text-sm text-slate-600">
                  <input type="checkbox" name="consentExperian" data-consent class="mt-1 h-4 w-4 rounded border-slate-300 text-emerald-600 focus:ring-emerald-500" />
                  <span>I consent to AlgoHive performing a credit bureau check with Experian.</span>
                </label>
                <label class="flex items-start gap-3 text-sm text-slate-600">
                  <input type="checkbox" name="consentBank" data-consent class="mt-1 h-4 w-4 rounded border-slate-300 text-emerald-600 focus:ring-emerald-500" />
                  <span>I consent to link my bank account via secure Open Banking to verify income and expenses.</span>
                </label>
                <label class="flex items-start gap-3 text-sm text-slate-600">
                  <input type="checkbox" name="consentEmployment" data-consent class="mt-1 h-4 w-4 rounded border-slate-300 text-emerald-600 focus:ring-emerald-500" />
                  <span>I confirm the employer and salary details provided are accurate.</span>
                </label>
                <label class="flex items-start gap-3 text-sm text-slate-600">
                  <input type="checkbox" name="consentDebicheck" data-consent class="mt-1 h-4 w-4 rounded border-slate-300 text-emerald-600 focus:ring-emerald-500" />
                  <span>I consent to an authenticated DebiCheck mandate if approved.</span>
                </label>
              </div>

              <div class="grid gap-4 sm:grid-cols-2">
                <label class="text-sm font-medium text-slate-600">
                  Employer name
                  <input type="text" name="employer" required class="mt-1 w-full rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200" placeholder="AlgoHive Labs" />
                </label>
                <label class="text-sm font-medium text-slate-600">
                  Employment type
                  <select name="employmentType" required class="mt-1 w-full rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200">
                    <option value="" disabled selected>Select employment type</option>
                    <option>Permanent</option>
                    <option>Contract</option>
                    <option>Self-employed</option>
                  </select>
                </label>
                <label class="text-sm font-medium text-slate-600">
                  Employment start date
                  <input type="date" name="employmentStart" required class="mt-1 w-full rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200" />
                </label>
                <label class="text-sm font-medium text-slate-600">
                  Salary day
                  <select name="salaryDay" required class="mt-1 w-full rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200">
                    <option value="" disabled selected>Select salary day</option>
                    <option value="25">25th</option>
                    <option value="27">27th</option>
                    <option value="28">28th</option>
                    <option value="30">30th</option>
                    <option value="last-business-day">Last business day</option>
                  </select>
                </label>
                <label class="text-sm font-medium text-slate-600 sm:col-span-2">
                  Net monthly salary (optional)
                  <input type="number" name="netSalary" min="0" step="1" class="mt-1 w-full rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200" placeholder="R 35,000" />
                </label>
              </div>

              <p data-consent-error class="hidden rounded-xl border border-rose-200 bg-rose-50 px-3 py-2 text-sm font-medium text-rose-600"></p>

              <div class="flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
                <a href="algolend.html" class="text-sm font-semibold text-slate-500 hover:text-slate-700">Back to overview</a>
                <button type="submit" class="inline-flex items-center justify-center gap-2 rounded-2xl bg-emerald-600 px-6 py-3 text-sm font-semibold text-white shadow-lg shadow-emerald-500/20 transition hover:bg-emerald-700">
                  Continue to credit check
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M8.25 4.5l7.5 7.5-7.5 7.5" /></svg>
                </button>
              </div>
            </form>
          </article>

          <article class="hidden rounded-3xl border border-slate-200/60 bg-white p-6 shadow-xl" data-step="bureau" aria-hidden="true">
            <header class="space-y-2">
              <p class="text-xs font-semibold uppercase tracking-[0.3em] text-slate-500">Step 2</p>
              <h2 class="text-2xl font-semibold text-slate-900">Experian bureau result</h2>
              <p class="text-sm text-slate-600">We pull your consented Experian profile to determine eligibility.</p>
            </header>
            <div class="mt-6 space-y-4">
              <div class="rounded-2xl border border-slate-100 bg-slate-50/70 p-4">
                <p class="text-xs font-semibold uppercase tracking-[0.2em] text-slate-500">Score band</p>
                <div class="mt-2 flex items-center justify-between">
                  <div>
                    <p class="text-lg font-semibold text-slate-900" data-bureau-band>Band —</p>
                    <p class="text-sm text-slate-600" data-bureau-message>Connecting to Experian to retrieve your score band...</p>
                  </div>
                  <span class="text-sm font-semibold" data-bureau-outcome="pending">Pending</span>
                </div>
              </div>
              <div class="rounded-2xl border border-slate-100 bg-white p-4 shadow-sm">
                <dl class="grid gap-3 text-sm sm:grid-cols-2">
                  <div>
                    <dt class="text-slate-500">Personalised limit</dt>
                    <dd class="mt-1 text-base font-semibold text-slate-900" data-bureau-limit>R 0</dd>
                  </div>
                  <div>
                    <dt class="text-slate-500">Experian status</dt>
                    <dd class="mt-1 text-base font-semibold text-slate-900">Live pull</dd>
                  </div>
                </dl>
                <ul data-bureau-reasons class="mt-3 hidden list-disc space-y-1 pl-5 text-sm text-rose-600"></ul>
              </div>
            </div>
            <footer class="mt-8 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
              <button type="button" data-action="retry-bureau" class="inline-flex items-center justify-center gap-2 rounded-2xl border border-slate-200 px-5 py-3 text-sm font-semibold text-slate-500 transition hover:border-slate-300 hover:text-slate-700">
                Retry check
              </button>
              <button type="button" data-action="continue-bank" disabled class="inline-flex items-center justify-center gap-2 rounded-2xl bg-emerald-600 px-6 py-3 text-sm font-semibold text-white shadow-lg shadow-emerald-500/20 transition disabled:cursor-not-allowed disabled:bg-slate-300">
                Link bank data
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M8.25 4.5l7.5 7.5-7.5 7.5" /></svg>
              </button>
            </footer>
          </article>

          <article class="hidden rounded-3xl border border-slate-200/60 bg-white p-6 shadow-xl" data-step="bank" aria-hidden="true">
            <header class="space-y-2">
              <p class="text-xs font-semibold uppercase tracking-[0.3em] text-slate-500">Step 3</p>
              <h2 class="text-2xl font-semibold text-slate-900">Secure bank linking</h2>
              <p class="text-sm text-slate-600">We link 90 days of statements to confirm income, affordability, and NSF events.</p>
            </header>
            <div class="mt-6 space-y-4">
              <div class="rounded-2xl border border-slate-100 bg-slate-50/70 p-4">
                <div class="flex items-center justify-between text-sm font-medium">
                  <span data-bank-status data-outcome="pending">Waiting to start</span>
                  <button type="button" data-action="start-bank-link" class="inline-flex items-center gap-2 rounded-xl border border-emerald-200 bg-white px-4 py-2 text-xs font-semibold text-emerald-700 transition hover:border-emerald-300">Launch Experian flow</button>
                </div>
                <p class="mt-2 text-xs text-slate-600" data-bank-summary>When you continue, we’ll redirect you to Experian’s secure widget.</p>
              </div>
              <div class="rounded-2xl border border-slate-100 bg-white p-4 shadow-sm">
                <h3 class="text-sm font-semibold text-slate-900">Affordability snapshot</h3>
                <dl class="mt-4 grid gap-3 text-sm sm:grid-cols-2">
                  <div>
                    <dt class="text-slate-500">Net monthly income</dt>
                    <dd class="mt-1 text-base font-semibold text-slate-900" data-afford-income>R 0</dd>
                  </div>
                  <div>
                    <dt class="text-slate-500">Current debt instalments</dt>
                    <dd class="mt-1 text-base font-semibold text-slate-900" data-afford-debt>R 0</dd>
                  </div>
                  <div>
                    <dt class="text-slate-500">Instalment cap (30%)</dt>
                    <dd class="mt-1 text-base font-semibold text-slate-900" data-afford-cap>R 0</dd>
                  </div>
                  <div>
                    <dt class="text-slate-500">Residual buffer</dt>
                    <dd class="mt-1 text-base font-semibold text-slate-900" data-afford-residual>R 0</dd>
                  </div>
                </dl>
              </div>
              <div class="rounded-2xl border border-dashed border-slate-200 p-4 text-sm text-slate-500">
                Prefer manual uploads? <button type="button" data-action="manual-upload" class="font-semibold text-emerald-700 underline-offset-2 hover:underline">Submit payslips &amp; statements</button>
              </div>
            </div>
            <footer class="mt-8 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
              <button type="button" class="inline-flex items-center justify-center gap-2 rounded-2xl border border-slate-200 px-5 py-3 text-sm font-semibold text-slate-500 transition hover:border-slate-300 hover:text-slate-700" data-step-back="bureau">
                Back to bureau
              </button>
              <button type="button" data-action="to-offer" disabled class="inline-flex items-center justify-center gap-2 rounded-2xl bg-emerald-600 px-6 py-3 text-sm font-semibold text-white shadow-lg shadow-emerald-500/20 transition disabled:cursor-not-allowed disabled:bg-slate-300">
                Continue to offer
              </button>
            </footer>
          </article>

          <article class="hidden rounded-3xl border border-slate-200/60 bg-white p-6 shadow-xl" data-step="offer" aria-hidden="true">
            <header class="space-y-2">
              <p class="text-xs font-semibold uppercase tracking-[0.3em] text-slate-500">Step 4</p>
              <h2 class="text-2xl font-semibold text-slate-900">Tailor your personalised offer</h2>
              <p class="text-sm text-slate-600">Adjust the amount, confirm your due date, and review mandatory fees before accepting.</p>
            </header>
            <div class="mt-6 space-y-6" data-offer-wrapper>
              <div class="space-y-3 rounded-2xl border border-slate-100 bg-slate-50/60 p-5">
                <div class="flex items-center justify-between text-sm">
                  <span class="font-medium text-slate-600">Requested amount</span>
                  <span class="font-semibold text-slate-900" data-offer-amount-display>R 5,000</span>
                </div>
                <input id="offer-amount" type="range" min="500" max="50000" step="500" value="5000" class="w-full accent-emerald-600" />
                <div class="flex justify-between text-xs text-slate-500">
                  <span>R 500</span>
                  <span>Max</span>
                </div>
              </div>

              <div class="grid gap-4 sm:grid-cols-2">
                <label class="text-sm font-medium text-slate-600">
                  Repayment due date
                  <input id="offer-due-date" type="date" class="mt-1 w-full rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200" />
                </label>
                <label class="text-sm font-medium text-slate-600">
                  Allocate to strategy (optional)
                  <input id="offer-strategy-allocation" type="range" min="0" max="20" step="5" value="0" class="mt-3 w-full accent-emerald-600" />
                  <span class="mt-2 block text-xs text-slate-500">Allocation: <strong data-offer-strategy-display>0% (R 0)</strong></span>
                </label>
              </div>

              <div class="rounded-2xl border border-slate-100 bg-white p-4 shadow-sm">
                <h3 class="text-sm font-semibold text-slate-900">Fee breakdown</h3>
                <dl class="mt-4 grid gap-3 text-sm sm:grid-cols-2">
                  <div><dt class="text-slate-500">Principal</dt><dd class="mt-1 font-semibold text-slate-900" data-offer-principal>R 0</dd></div>
                  <div><dt class="text-slate-500">Initiation fee</dt><dd class="mt-1 font-semibold text-slate-900" data-offer-initiation>R 0</dd></div>
                  <div><dt class="text-slate-500">Service fee</dt><dd class="mt-1 font-semibold text-slate-900" data-offer-service>R 0</dd></div>
                  <div><dt class="text-slate-500">Interest</dt><dd class="mt-1 font-semibold text-slate-900" data-offer-interest>R 0</dd></div>
                  <div class="sm:col-span-2 border-t border-slate-100 pt-3"><dt class="text-slate-500">Total due</dt><dd class="mt-1 text-lg font-semibold text-slate-900" data-offer-total>R 0</dd></div>
                </dl>
                <p class="mt-3 text-xs text-slate-500">Single repayment on <span class="font-semibold text-slate-700" data-offer-due-date-display>—</span> covering <span data-offer-days>0 days</span>.</p>
              </div>

              <div class="rounded-2xl border border-emerald-200 bg-emerald-50/80 p-4 text-xs text-emerald-900">
                <p class="font-semibold">Affordability check</p>
                <p class="mt-1">We cap your offer based on Experian score, income, and the NCR instalment limits. If you need a lower amount you can adjust the slider.</p>
              </div>

              <label class="flex items-start gap-3 rounded-2xl border border-slate-200 bg-slate-50/70 px-4 py-3 text-sm text-slate-600">
                <input type="checkbox" data-offer-declaration class="mt-1 h-4 w-4 rounded border-slate-300 text-emerald-600 focus:ring-emerald-500" />
                <span>I confirm my employer and salary details are accurate and this loan fits within my affordability.</span>
              </label>
            </div>
            <footer class="mt-8 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
              <button type="button" class="inline-flex items-center justify-center gap-2 rounded-2xl border border-slate-200 px-5 py-3 text-sm font-semibold text-slate-500 transition hover:border-slate-300 hover:text-slate-700" data-step-back="bank">Back to bank link</button>
              <button type="button" data-action="accept-offer" disabled class="inline-flex items-center justify-center gap-2 rounded-2xl bg-emerald-600 px-6 py-3 text-sm font-semibold text-white shadow-lg shadow-emerald-500/20 transition disabled:cursor-not-allowed disabled:bg-slate-300">Accept offer</button>
            </footer>
          </article>

          <article class="hidden rounded-3xl border border-slate-200/60 bg-white p-6 shadow-xl" data-step="contract" aria-hidden="true">
            <header class="space-y-2">
              <p class="text-xs font-semibold uppercase tracking-[0.3em] text-slate-500">Step 5</p>
              <h2 class="text-2xl font-semibold text-slate-900">Disclosures &amp; contract</h2>
              <p class="text-sm text-slate-600">Review the pre-agreement and credit agreement, acknowledge the terms, and sign with a one-time PIN.</p>
            </header>
            <div class="mt-6 space-y-5">
              <div class="grid gap-4 sm:grid-cols-2">
                <a href="#" class="flex flex-col gap-3 rounded-2xl border border-slate-200 bg-white p-4 text-sm shadow-sm transition hover:border-emerald-300">
                  <span class="font-semibold text-slate-900">Pre-agreement statement</span>
                  <span class="text-xs text-slate-500">Key facts and fee summary in plain language.</span>
                  <span class="text-xs font-semibold text-emerald-600">Download PDF</span>
                </a>
                <a href="#" class="flex flex-col gap-3 rounded-2xl border border-slate-200 bg-white p-4 text-sm shadow-sm transition hover:border-emerald-300">
                  <span class="font-semibold text-slate-900">Credit agreement</span>
                  <span class="text-xs text-slate-500">Full contractual terms of your Algolend facility.</span>
                  <span class="text-xs font-semibold text-emerald-600">Download PDF</span>
                </a>
              </div>

              <div class="space-y-3">
                <label class="flex items-start gap-3 rounded-2xl border border-slate-200 bg-slate-50/70 px-4 py-3 text-sm text-slate-600">
                  <input type="checkbox" data-contract-ack class="mt-1 h-4 w-4 rounded border-slate-300 text-emerald-600 focus:ring-emerald-500" />
                  <span>I have read and understand the pre-agreement and credit agreement.</span>
                </label>
                <label class="flex items-start gap-3 rounded-2xl border border-slate-200 bg-slate-50/70 px-4 py-3 text-sm text-slate-600">
                  <input type="checkbox" data-contract-ack class="mt-1 h-4 w-4 rounded border-slate-300 text-emerald-600 focus:ring-emerald-500" />
                  <span>I authorise AlgoHive to use the supplied contact details to send an OTP for e-signature.</span>
                </label>
              </div>

              <div class="space-y-3 rounded-2xl border border-slate-200 bg-white p-4 shadow-sm">
                <div class="flex flex-col gap-3 sm:flex-row sm:items-center">
                  <button type="button" data-action="send-otp" class="inline-flex items-center justify-center gap-2 rounded-xl border border-emerald-200 bg-emerald-50 px-4 py-2 text-sm font-semibold text-emerald-700 transition hover:border-emerald-300">
                    Send OTP
                  </button>
                  <input id="contract-otp" type="text" inputmode="numeric" maxlength="6" placeholder="Enter 6-digit OTP" class="w-full rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200" />
                  <button type="button" data-action="verify-otp" class="inline-flex items-center justify-center gap-2 rounded-xl border border-slate-200 bg-white px-4 py-2 text-sm font-semibold text-slate-600 transition hover:border-slate-300">Verify</button>
                </div>
                <p data-otp-info class="hidden text-xs font-medium text-emerald-700"></p>
              </div>
            </div>
            <footer class="mt-8 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
              <button type="button" class="inline-flex items-center justify-center gap-2 rounded-2xl border border-slate-200 px-5 py-3 text-sm font-semibold text-slate-500 transition hover:border-slate-300 hover:text-slate-700" data-step-back="offer">Back to offer</button>
              <button type="button" data-action="contract-continue" disabled class="inline-flex items-center justify-center gap-2 rounded-2xl bg-emerald-600 px-6 py-3 text-sm font-semibold text-white shadow-lg shadow-emerald-500/20 transition disabled:cursor-not-allowed disabled:bg-slate-300">Continue to DebiCheck</button>
            </footer>
          </article>

          <article class="hidden rounded-3xl border border-slate-200/60 bg-white p-6 shadow-xl" data-step="mandate" aria-hidden="true">
            <header class="space-y-2">
              <p class="text-xs font-semibold uppercase tracking-[0.3em] text-slate-500">Step 6</p>
              <h2 class="text-2xl font-semibold text-slate-900">DebiCheck mandate</h2>
              <p class="text-sm text-slate-600">Authenticate your repayment mandate via your banking app, USSD, or SMS.</p>
            </header>
            <div class="mt-6 space-y-4" data-mandate-summary>
              <div class="rounded-2xl border border-slate-100 bg-slate-50/70 p-4">
                <dl class="grid gap-3 text-sm sm:grid-cols-2">
                  <div><dt class="text-slate-500">Mandate reference</dt><dd class="mt-1 text-base font-semibold text-slate-900" data-mandate-reference>Pending</dd></div>
                  <div><dt class="text-slate-500">Channel</dt><dd class="mt-1 text-base font-semibold text-slate-900" data-mandate-channel>—</dd></div>
                  <div class="sm:col-span-2"><dt class="text-slate-500">Collection account</dt><dd class="mt-1 text-base font-semibold text-slate-900" data-mandate-account>—</dd></div>
                </dl>
              </div>
              <p class="text-sm font-semibold" data-mandate-status data-outcome="pending">Ready to authenticate</p>
            </div>
            <footer class="mt-8 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
              <button type="button" class="inline-flex items-center justify-center gap-2 rounded-2xl border border-slate-200 px-5 py-3 text-sm font-semibold text-slate-500 transition hover:border-slate-300 hover:text-slate-700" data-step-back="contract">Back to contract</button>
              <div class="flex flex-col gap-3 sm:flex-row">
                <button type="button" data-action="start-mandate" class="inline-flex items-center justify-center gap-2 rounded-2xl border border-emerald-200 bg-emerald-50 px-5 py-3 text-sm font-semibold text-emerald-700 transition hover:border-emerald-300">Authenticate mandate</button>
                <button type="button" data-action="mandate-continue" disabled class="inline-flex items-center justify-center gap-2 rounded-2xl bg-emerald-600 px-6 py-3 text-sm font-semibold text-white shadow-lg shadow-emerald-500/20 transition disabled:cursor-not-allowed disabled:bg-slate-300">Confirm disbursement</button>
              </div>
            </footer>
          </article>

          <article class="hidden rounded-3xl border border-slate-200/60 bg-white p-6 shadow-xl" data-step="disbursement" aria-hidden="true">
            <header class="space-y-2">
              <p class="text-xs font-semibold uppercase tracking-[0.3em] text-slate-500">Step 7</p>
              <h2 class="text-2xl font-semibold text-slate-900">Disbursement &amp; dashboard</h2>
              <p class="text-sm text-slate-600">We split the payout between your bank account and optional strategy allocation.</p>
            </header>
            <div class="mt-6 space-y-4" data-disbursement-summary>
              <div class="rounded-2xl border border-slate-100 bg-white p-4 shadow-sm">
                <dl class="grid gap-3 text-sm sm:grid-cols-2">
                  <div><dt class="text-slate-500">Transfer reference</dt><dd class="mt-1 text-base font-semibold text-slate-900" data-disbursement-reference>Pending</dd></div>
                  <div><dt class="text-slate-500">Expected time</dt><dd class="mt-1 text-base font-semibold text-slate-900" data-disbursement-eta>Shortly</dd></div>
                  <div class="sm:col-span-2 text-xs text-slate-500">We’ll notify you via email and in-app when funds clear. Strategy allocations post instantly to your AlgoHive wallet.</div>
                </dl>
              </div>
            </div>
            <footer class="mt-8 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
              <a href="lend.html" class="inline-flex items-center justify-center gap-2 rounded-2xl border border-slate-200 px-5 py-3 text-sm font-semibold text-slate-600 transition hover:border-slate-300 hover:text-slate-800">View loan dashboard</a>
              <div class="flex flex-col gap-3 sm:flex-row">
                <a href="#" data-action="download-receipt" class="inline-flex items-center justify-center gap-2 rounded-2xl border border-slate-200 px-5 py-3 text-sm font-semibold text-slate-600 transition hover:border-slate-300" aria-disabled="true">Download receipt</a>
                <a href="support.html" class="inline-flex items-center justify-center gap-2 rounded-2xl bg-emerald-600 px-6 py-3 text-sm font-semibold text-white shadow-lg shadow-emerald-500/20 transition hover:bg-emerald-700">Need assistance?</a>
              </div>
            </footer>
          </article>
        </div>
      </section>

      <aside class="space-y-6">
        <section class="rounded-3xl border border-slate-200/60 bg-white p-6 shadow-xl">
          <header class="flex items-center justify-between">
            <div>
              <p class="text-xs font-semibold uppercase tracking-[0.3em] text-slate-500">Profile</p>
              <h2 class="mt-1 text-lg font-semibold text-slate-900">AlgoHive member</h2>
            </div>
            <span data-application-state data-tone="slate" class="text-xs font-semibold uppercase tracking-[0.18em]">Collecting consents</span>
          </header>
          <div class="mt-6 flex flex-col items-center gap-4 text-center">
            <img id="profile-avatar" class="h-24 w-24 rounded-3xl object-cover ring-4 ring-emerald-100" alt="Profile avatar" src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='112' height='112'><rect width='100%' height='100%' rx='28' ry='28' fill='%23e2e8f0'/><text x='50%' y='56%' text-anchor='middle' font-family='Inter, sans-serif' font-size='40' fill='%2363748b'>AH</text></svg>" />
            <div class="space-y-1">
              <p id="profile-name" class="text-lg font-semibold text-slate-900">—</p>
              <p id="profile-summary" class="text-sm text-slate-500">Active AlgoHive investor.</p>
            </div>
          </div>
          <dl class="mt-6 grid gap-4 text-sm">
            <div class="rounded-2xl border border-slate-100 bg-slate-50/80 px-4 py-3">
              <dt class="text-slate-500">Invested AUM</dt>
              <dd id="profile-aum" class="mt-1 text-base font-semibold text-slate-900">R 0</dd>
            </div>
            <div class="rounded-2xl border border-slate-100 bg-slate-50/80 px-4 py-3">
              <dt class="text-slate-500">AlgoHive net worth</dt>
              <dd id="profile-networth" class="mt-1 text-base font-semibold text-slate-900">R 0</dd>
            </div>
          </dl>
        </section>

        <section class="rounded-3xl border border-slate-200/60 bg-white p-6 shadow-xl">
          <h2 class="text-sm font-semibold uppercase tracking-[0.2em] text-slate-500">Application timeline</h2>
          <ol class="mt-5 space-y-4 text-sm text-slate-600">
            <li data-timeline-state="STARTED" data-state="complete">Consents submitted</li>
            <li data-timeline-state="BUREAU_CHECKING" data-state="pending">Experian bureau check</li>
            <li data-timeline-state="BANK_LINKING" data-state="pending">Bank linking &amp; affordability</li>
            <li data-timeline-state="OFFERED" data-state="pending">Offer presented</li>
            <li data-timeline-state="CONTRACT_SIGN" data-state="pending">Contract signed</li>
            <li data-timeline-state="DEBICHECK_AUTH" data-state="pending">DebiCheck authentication</li>
            <li data-timeline-state="READY_TO_DISBURSE" data-state="pending">Ready to disburse</li>
            <li data-timeline-state="DISBURSED" data-state="pending">Funds disbursed</li>
          </ol>
        </section>

        <section class="rounded-3xl border border-slate-200/60 bg-white p-6 shadow-xl">
          <h2 class="text-sm font-semibold uppercase tracking-[0.2em] text-slate-500">Need support?</h2>
          <p class="mt-3 text-sm text-slate-600">Our lending desk can help with Experian retries, manual affordability reviews, or mandate issues.</p>
          <div class="mt-4 space-y-3 text-sm">
            <a href="mailto:lending@algohive.ai" class="flex items-center gap-2 text-emerald-700 hover:underline"><span class="inline-flex h-8 w-8 items-center justify-center rounded-full bg-emerald-50 text-emerald-700">@</span>Email lending@algohive.ai</a>
            <a href="support.html" class="flex items-center gap-2 text-emerald-700 hover:underline"><span class="inline-flex h-8 w-8 items-center justify-center rounded-full bg-emerald-50 text-emerald-700">?</span>Visit support centre</a>
          </div>
        </section>
      </aside>
    </div>
  </main>

  <footer class="border-t border-slate-200 bg-white/80">
    <div class="mx-auto flex max-w-6xl flex-col gap-4 px-4 py-8 text-xs text-slate-500 sm:flex-row sm:items-center sm:justify-between">
      <p>© AlgoHive <span id="footer-year">2024</span> — Lending services governed by NCR.</p>
      <div class="flex flex-wrap gap-4">
        <a href="legal.html#privacy" class="hover:text-slate-700">Privacy</a>
        <a href="legal.html#terms" class="hover:text-slate-700">Terms</a>
        <a href="support.html" class="hover:text-slate-700">Support</a>
      </div>
    </div>
  </footer>

  <script type="module" nonce="ALGOHIVE">
    import { supabase } from "/js/supabase.js";
    import { initAlgolendFlow } from "/js/algolend-flow.js";

    const flow = initAlgolendFlow();

    const moneyFmt = new Intl.NumberFormat('en-ZA', {
      style: 'currency',
      currency: 'ZAR',
      maximumFractionDigits: 0,
    });

    const footerYear = document.getElementById('footer-year');
    if (footerYear) footerYear.textContent = new Date().getFullYear();

    const text = (id, value) => {
      const el = document.getElementById(id);
      if (el) el.textContent = value ?? '—';
    };

    const setAvatar = (id, url, name) => {
      const el = document.getElementById(id);
      if (!el) return;
      const initial = (name?.match(/[A-Za-z]/)?.[0] || 'A').toUpperCase();
      const fallbackSvg = encodeURIComponent(`
        <svg xmlns='http://www.w3.org/2000/svg' width='128' height='128'>
          <rect width='100%' height='100%' rx='28' ry='28' fill='#e2e8f0'/>
          <text x='50%' y='56%' text-anchor='middle' font-family='Inter, sans-serif' font-size='48' fill='#475569'>${initial}</text>
        </svg>
      `.trim());
      if (url) {
        el.src = url.startsWith('data:') ? url : `${url}${url.includes('?') ? '&' : '?'}v=${Date.now()}`;
      } else {
        el.src = `data:image/svg+xml;utf8,${fallbackSvg}`;
      }
      if (name) {
        el.alt = `Profile photo of ${name}`;
      }
    };

    const cleanNumber = (value) => {
      if (typeof value === 'number' && Number.isFinite(value)) return value;
      if (typeof value === 'string') {
        const normalised = value
          .replace(/,/g, '')
          .replace(/\s+/g, '')
          .replace(/rand/gi, '')
          .replace(/zar/gi, '')
          .replace(/R(?=\d)/gi, '')
          .replace(/(?:million|m)\b/gi, 'e6')
          .replace(/(?:billion|bn)\b/gi, 'e9');

        const exponentMatches = [...normalised.matchAll(/[0-9.]+e[+\-]?[0-9]+/gi)]
          .map((m) => Number(m[0]))
          .filter((n) => Number.isFinite(n));
        if (exponentMatches.length) {
          return Math.max(...exponentMatches);
        }

        const sciCandidate = Number(normalised.replace(/[^0-9eE+\.\-]/g, ''));
        if (Number.isFinite(sciCandidate)) return sciCandidate;

        const numericCandidate = Number(normalised.replace(/[^0-9.\-]/g, ''));
        if (Number.isFinite(numericCandidate)) return numericCandidate;

        const plainMatches = normalised.match(/[0-9]+(?:\.[0-9]+)?/g);
        if (plainMatches?.length) {
          const asNumber = Number(plainMatches.at(-1));
          if (Number.isFinite(asNumber)) return asNumber;
        }
      }
      return null;
    };

    const pickNumber = (...candidates) => {
      for (const value of candidates) {
        if (Array.isArray(value)) {
          const nested = pickNumber(...value);
          if (nested !== null) return nested;
          continue;
        }
        const parsed = cleanNumber(value);
        if (parsed !== null) return parsed;
      }
      return null;
    };

    const redirectToAuth = () => {
      const next = encodeURIComponent(location.pathname + location.search + location.hash);
      location.replace(`/auth.html?tab=in&redirect=${next}`);
    };

    try {
      const { data: { session } } = await supabase.auth.getSession();
      if (!session) {
        redirectToAuth();
        throw new Error('redirecting');
      }

      const { data: { user } } = await supabase.auth.getUser();
      if (!user) {
        redirectToAuth();
        throw new Error('redirecting');
      }

      const { data, error } = await supabase
        .from('profiles')
        .select('*')
        .eq('id', user.id)
        .maybeSingle();
      if (error && error.code !== 'PGRST116') throw error;
      let profile = data;
      if (!profile) {
        const up = await supabase
          .from('profiles')
          .upsert({ id: user.id, email: user.email, updated_at: new Date().toISOString() }, { onConflict: 'id' })
          .select('*')
          .single();
        if (up.error) throw up.error;
        profile = up.data;
      }

      const meta = user.user_metadata || {};
      const bestName = [
        profile?.full_name,
        [profile?.first_name, profile?.last_name].filter(Boolean).join(' '),
        meta.full_name,
        [meta.first_name, meta.last_name].filter(Boolean).join(' '),
        meta.name,
        user.email?.split('@')[0],
      ].find((value) => value && String(value).trim()) || 'AlgoHive member';

      const summary = [
        profile?.headline,
        profile?.bio,
        profile?.title,
        profile?.role,
        profile?.occupation,
        meta.headline,
        meta.role,
      ].find((value) => value && String(value).trim()) || 'Active AlgoHive portfolio member with personalised optimisation.';

      const investedAum = pickNumber([
        profile?.aum_invested,
        profile?.aum,
        profile?.portfolio_value,
        meta?.aum,
        meta?.aum_invested,
      ]);

      const netWorth = pickNumber([
        profile?.algohive_networth,
        profile?.networth,
        profile?.net_worth,
        profile?.portfolio_net_worth,
        meta?.net_worth,
        meta?.networth,
      ]);

      text('hdr-name', bestName);
      text('profile-name', bestName);
      text('profile-summary', summary);
      text('profile-aum', moneyFmt.format((investedAum ?? 0) || 0));
      text('profile-networth', moneyFmt.format((netWorth ?? investedAum ?? 0) || 0));
      setAvatar('hdr-avatar', profile?.avatar_url || meta?.avatar_url || null, bestName);
      setAvatar('profile-avatar', profile?.avatar_url || meta?.avatar_url || null, bestName);

      flow.setBorrowerContext({
        salaryDay: profile?.salary_day || meta?.salary_day || null,
      });
    } catch (err) {
      if (String(err?.message).toLowerCase() !== 'redirecting') {
        console.error(err);
      }
    }
  </script>
</body>
</html>
