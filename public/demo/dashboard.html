<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AlgoHive — Demo Dashboard</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js" nonce="ALGOHIVE"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />

  <style>
    :root {
      --page: #0b1220;
      --bg: #ffffff;
      --muted: #64748b;
      --ink: #0f172a;
      --olive: #556b2f;
      --olive-700: #3f4f21;
      --brand: #556b2f;
      --line: #e5e7ef
    }

      html,
      body {
        font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      background: var(--bg);
      color: var(--ink)
    }

    .card {
      background: #fff;
      border: 1px solid var(--line);
      border-radius: 12px
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: .5rem;
      height: 40px;
      padding: 0 .875rem;
      border-radius: 10px;
      border: 1px solid var(--line);
      font-weight: 600
    }

    .btn-olive {
      background: var(--olive);
      border-color: var(--olive-700);
      color: #f8fafc;
      box-shadow: 0 14px 28px -18px rgba(63, 79, 33, 0.45);
      transition: transform .15s ease, box-shadow .2s ease, background .2s ease;
    }

    .btn-olive:hover {
      background: var(--olive-700);
      box-shadow: 0 18px 38px -18px rgba(63, 79, 33, 0.55);
      transform: translateY(-1px);
    }

    .tab {
      height: 36px;
      border-radius: 8px;
      padding: 0 .75rem
    }

    .tab-active {
      background: #111827;
      color: #fff
    }

    #layout {
      --sb: 275px;
      display: grid;
      grid-template-columns: 1fr;
      min-height: 100vh
    }

    #ah-sidebar {
      transition: transform .3s ease, width .2s ease;
      width: 350px;
      max-width: 85vw;
      position: fixed;
      top: 0;
      z-index: 50;
      height: 100vh;
      transform: translateX(-100%)
    }

    #ah-sidebar.is-open {
      transform: translateX(0)
    }

    @media (min-width: 768px) {
      #layout {
        grid-template-columns: var(--sb) 1fr
      }

      #layout.is-collapsed {
        --sb: 64px
      }

      #ah-sidebar {
        position: sticky;
        top: 0;
        width: var(--sb);
        max-width: none;
        height: 100vh;
        transform: translateX(0);
        z-index: auto
      }
    }

    #ah-sidebar[data-collapsed="true"] .label,
    #ah-sidebar[data-collapsed="true"] .chevron {
      display: none
    }

    #ah-sidebar[data-collapsed="true"] #main-nav {
      visibility: hidden;
      pointer-events: none;
    }

    #ah-sidebar[data-collapsed="true"] #ah-brand-switcher .brand-menu {
      display: none;
    }

    #ah-sidebar[data-collapsed="true"] details>.sub {
      display: none !important
    }

    #ah-sidebar[data-collapsed="true"] nav a,
    #ah-sidebar[data-collapsed="true"] details>summary {
      justify-content: center;
      gap: .25rem
    }

    #ah-sidebar[data-collapsed="true"] details>summary span {
      gap: 0
    }

    #ah-sidebar .footer {
      transition: all .2s ease
    }

    #ah-sidebar[data-collapsed="true"] .footer {
      justify-content: center;
      flex-direction: column;
      gap: 12px
    }

    #ah-sidebar[data-collapsed="true"] .btn-collapse :is(svg, i) {
      transform: rotate(180deg)
    }

    #ah-collapse {
      display: none
    }

    @media (min-width: 768px) {
      #ah-collapse {
        display: inline-flex
      }
    }

    .ps-tile {
      border: 1px solid #e5e7eb;
      border-radius: 14px;
      padding: 14px 16px;
      background: #fff
    }

    .ps-label {
      color: #64748b;
      font-weight: 500;
      font-size: .85rem
    }

    .ps-value {
      font-weight: 600;
      font-size: 1rem;
      margin-top: 2px
    }

    .no-scrollbar::-webkit-scrollbar {
      display: none
    }

    .no-scrollbar {
      -ms-overflow-style: none;
      scrollbar-width: none
    }

    .scrollbar-hide::-webkit-scrollbar {
      display: none
    }

    .scrollbar-hide {
      -ms-overflow-style: none;
      scrollbar-width: none
    }

    .stat-card {
      box-shadow: 0 16px 44px -24px rgba(12, 18, 31, 0.32);
      transition: transform .18s ease, box-shadow .22s ease;
    }

    .stat-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 20px 52px -26px rgba(12, 18, 31, 0.38);
    }

    .skeleton {
      position: relative;
      overflow: hidden;
      background: #e5e7eb;
    }

    .skeleton::after {
      content: '';
      position: absolute;
      inset: 0;
      transform: translateX(-100%);
      background: linear-gradient(90deg, rgba(255, 255, 255, 0) 0%, rgba(255, 255, 255, 0.6) 50%, rgba(255, 255, 255, 0) 100%);
      animation: shimmer 1.25s infinite;
    }

    @keyframes shimmer {
      100% {
        transform: translateX(100%);
      }
    }

    #dashboard-skeleton {
      position: absolute;
      inset: 0;
      z-index: 20;
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(1px);
      transition: opacity .25s ease;
    }

    /* Brand switcher */
    #ah-brand-switcher {
      position: relative;
    }

    #ah-brand-switcher summary {
      list-style: none;
    }

    #ah-brand-switcher summary::-webkit-details-marker {
      display: none;
    }

    .brand-toggle {
      margin: 10px 12px;
      border: 1px solid #e2e8f0;
      border-radius: 14px;
      background: linear-gradient(135deg, #f8fafc, #eef2ff);
      box-shadow: 0 10px 30px -18px rgba(15, 23, 42, 0.4);
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 12px;
      cursor: pointer;
      transition: all .2s ease;
    }

    #ah-brand-switcher[open] .brand-toggle {
      border-color: #cbd5e1;
      background: #fff;
      box-shadow: 0 14px 36px -18px rgba(15, 23, 42, 0.55);
    }

    .brand-marker {
      width: 42px;
      height: 42px;
      border-radius: 12px;
      background: #111827;
      display: grid;
      place-items: center;
      box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.12);
    }

    .brand-menu {
      position: absolute;
      left: 12px;
      right: 12px;
      top: calc(100% - 6px);
      border: 1px solid #e2e8f0;
      border-radius: 16px;
      background: #fff;
      box-shadow: 0 24px 48px -20px rgba(15, 23, 42, 0.5);
      padding: 12px;
      display: grid;
      gap: 8px;
      z-index: 10;
    }

    .brand-menu-header {
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: .08em;
      font-weight: 700;
      color: #475569;
      padding: 4px 4px 2px;
    }

    .brand-option {
        display: flex;
        flex-direction: row;
        align-items: center;
        gap: 12px;
        padding: 12px;
        border-radius: 12px;
        transition: background-color .2s ease, color .2s ease, filter .2s ease;
    }

    .brand-option:hover {
      background: linear-gradient(135deg, #000000, #7c3aed);
    }

    .brand-option:hover img {
      filter: brightness(0) invert(1);
    }

    .brand-option:hover .algomoney-word {
      color: #fff;
    }

    .brand-option img {
        width: 38px;
        height: 38px;
        border-radius: 10px;
        object-fit: contain;
        background: transparent;
    }

    .brand-option .algomoney-word {
        font-weight: 800;
        letter-spacing: 0.14em;
        text-transform: uppercase;
        font-size: 13px;
        color: #0f172a;
    }

    #ah-sidebar[data-collapsed="true"] #ah-brand-switcher .brand-toggle {
        margin: 12px;
        padding: 0;
        border: none;
        background: transparent;
        box-shadow: none;
        justify-content: center;
        gap: 0;
    }

    #ah-sidebar[data-collapsed="true"] #ah-brand-switcher .brand-toggle .label,
    #ah-sidebar[data-collapsed="true"] #ah-brand-switcher .brand-toggle .fa-chevron-down {
        display: none;
    }

    #ah-sidebar[data-collapsed="true"] #ah-brand-switcher .brand-marker {
        background: transparent;
        width: 38px;
        height: 38px;
        box-shadow: none;
    }

    #ah-sidebar[data-collapsed="true"] #ah-brand-switcher .brand-marker img {
        width: 38px;
        height: 38px;
        border-radius: 10px;
    }

    .watch-strip {
      display: flex;
      gap: 12px;
      overflow-x: auto;
      scroll-snap-type: x mandatory;
    }

    .watch-strip > article {
      scroll-snap-align: start;
    }

    .watch-fade {
      pointer-events: none;
      position: absolute;
      top: 0;
      bottom: 0;
      width: 48px;
    }

    .watch-fade-left {
      left: 0;
      background: linear-gradient(90deg, rgba(255, 255, 255, 1), rgba(255, 255, 255, 0));
    }

    .watch-fade-right {
      right: 0;
      background: linear-gradient(270deg, rgba(255, 255, 255, 1), rgba(255, 255, 255, 0));
    }

    .allocation-card {
      background: radial-gradient(circle at 10% 20%, rgba(190, 242, 100, 0.18), transparent 35%),
        radial-gradient(circle at 90% 10%, rgba(190, 242, 100, 0.16), transparent 30%),
        linear-gradient(135deg, #1a2a15, #2f4a2a);
      border: 1px solid rgba(163, 190, 90, 0.35);
      box-shadow: 0 24px 60px -32px rgba(137, 168, 72, 0.5);
      color: #f8fafc;
    }

    .chip {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 0.35rem 0.65rem;
      border-radius: 9999px;
      font-weight: 700;
    }

    .toast-stack {
      position: fixed;
      top: 1.5rem;
      right: 1.5rem;
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
      z-index: 400;
      pointer-events: none;
    }

    .toast-card {
      pointer-events: auto;
      display: flex;
      align-items: flex-start;
      gap: 0.75rem;
      min-width: 240px;
      max-width: 360px;
      padding: 0.9rem 1rem;
      border-radius: 1rem;
      background-image: linear-gradient(135deg, #0b1215, #1c2714);
      color: #f8fafc;
      box-shadow: 0 18px 42px -18px rgba(11, 18, 21, 0.7);
      border: 1px solid rgba(126, 141, 82, 0.45);
      transform: translateX(120%);
      opacity: 0;
      animation: toastIn 0.45s cubic-bezier(.22, 1, .36, 1) forwards;
    }

    .toast-card[data-tone="err"],
    .toast-card[data-tone="warn"] {
      background-image: linear-gradient(135deg, #231312, #261a12);
      border-color: rgba(248, 113, 113, 0.35);
    }

    .toast-card[data-tone="ok"] {
      background-image: linear-gradient(135deg, #0d1b10, #14200f);
      border-color: rgba(52, 211, 153, 0.35);
    }

    .toast-icon {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
      border-radius: 12px;
      background: rgba(126, 141, 82, 0.12);
      color: #f8fafc;
      border: 1px solid rgba(126, 141, 82, 0.35);
      flex-shrink: 0;
    }

    .toast-card[data-tone="err"] .toast-icon,
    .toast-card[data-tone="warn"] .toast-icon {
      background: rgba(248, 113, 113, 0.12);
      border-color: rgba(248, 113, 113, 0.35);
    }

    .toast-card[data-tone="ok"] .toast-icon {
      background: rgba(52, 211, 153, 0.12);
      border-color: rgba(52, 211, 153, 0.35);
    }

    .toast-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 0.15rem;
    }

    .toast-message {
      font-weight: 600;
      line-height: 1.3;
    }

    .toast-dismiss {
      color: #cbd5e1;
      background: transparent;
      border: none;
      cursor: pointer;
      padding: 0.1rem;
      transition: color .2s ease;
    }

    .toast-dismiss:hover {
      color: #f8fafc;
    }

    .toast-card--leaving {
      animation: toastOut 0.32s ease forwards;
    }

    @keyframes toastIn {
      0% { transform: translateX(120%); opacity: 0; }
      100% { transform: translateX(0); opacity: 1; }
    }

    @keyframes toastOut {
      0% { transform: translateX(0); opacity: 1; }
      100% { transform: translateX(120%); opacity: 0; }
    }

    .top-gainers-marquee {
      width: 100%;
      overflow: hidden;
      position: relative;
      background: #fff;
      border: 1px solid #e2e8f0;
      border-radius: 16px;
      padding: 18px;
      box-shadow: 0 12px 30px -18px rgba(15, 23, 42, 0.35);
    }

    .top-gainers-marquee::-webkit-scrollbar {
      display: none;
    }

    .top-gainers-track {
      display: flex;
      align-items: stretch;
      gap: 14px;
      width: max-content;
    }

    .top-gainers-track.is-looping {
      animation: tg-scroll var(--tg-duration, 24s) linear infinite;
    }

    .top-gainers-track.is-looping:hover {
      animation-play-state: paused;
    }

    @keyframes tg-scroll {
      0% { transform: translateX(0); }
      100% { transform: translateX(-50%); }
    }

    .tg-card {
      min-width: 220px;
      background: linear-gradient(135deg, #f8fafc, #ffffff);
      border: 1px solid #e2e8f0;
      border-radius: 14px;
      padding: 14px;
      color: #0f172a;
      box-shadow: 0 18px 42px -18px rgba(15, 23, 42, 0.25);
    }

    .tg-card-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 8px;
    }

    .tg-logo-img {
      width: 38px;
      height: 38px;
      border-radius: 12px;
      object-fit: contain;
      background: #fff;
      border: 1px solid rgba(226, 232, 240, 0.6);
      padding: 6px;
    }

    .tg-logo-fallback {
      width: 38px;
      height: 38px;
      border-radius: 12px;
      display: grid;
      place-items: center;
      font-weight: 700;
      color: #0f172a;
      background: #e2e8f0;
    }

    .tg-card-meta {
      min-width: 0;
    }

    .tg-symbol {
      font-weight: 700;
      letter-spacing: 0.04em;
    }

    .tg-name {
      font-size: 13px;
      color: #475569;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .tg-value {
      font-size: 13px;
      color: #0f172a;
    }

    .tg-change {
      margin-top: 6px;
      font-weight: 700;
      font-size: 14px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.06);
    }

    .tg-change.is-up { color: #22c55e; }
    .tg-change.is-down { color: #ef4444; }

    .ph-item {
      display: grid;
      grid-template-columns: auto 1fr 1fr auto;
      gap: 10px;
      align-items: center;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid #e2e8f0;
      background: #fff;
    }

    .ph-symbol { font-weight: 700; color: #0f172a; }
    .ph-name { font-size: 13px; color: #475569; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
    .ph-weight { font-weight: 700; color: #0f172a; }

    .ph-logo-fallback {
      width: 36px;
      height: 36px;
      border-radius: 12px;
      display: grid;
      place-items: center;
      font-weight: 700;
      color: #0f172a;
      background: #e2e8f0;
    }
  </style>
</head>

<body class="min-h-screen overflow-x-hidden bg-white">
  <div id="layout">
    <div id="ah-overlay" class="fixed inset-0 bg-black/40 z-40 hidden md:hidden"></div>
    <aside id="ah-sidebar" data-collapsed="false" class="border-r border-slate-200 h-[100vh] bg-white flex flex-col overflow-hidden">
      <details class="group border-b border-slate-200 pb-2" id="ah-brand-switcher">
        <summary class="brand-toggle">
          <div class="brand-marker">
            <img src="https://static.wixstatic.com/media/ac771e_af06d86a7a1f4abd87e52e45f3bcbd96~mv2.png" alt="AlgoHive Logo" class="w-7 h-7 object-contain" />
          </div>
          <div class="min-w-0">
            <div class="font-bold text-[15px] text-slate-900 label">AlgoHive</div>
            <div class="text-[11px] text-slate-500 label">Markets</div>
          </div>
          <i class="fa-solid fa-chevron-down text-slate-400 ml-auto transition-transform group-open:rotate-180"></i>
        </summary>
        <div class="brand-menu">
          <div class="brand-menu-header">Switch workspace</div>
          <a href="#" class="brand-option">
            <img src="https://aazofjsssobejhkyyiqv.supabase.co/storage/v1/object/public/AlgoHive/ICON%20AHM.svg" alt="AlgoMoney Logo" />
            <div class="min-w-0 font-semibold text-slate-900 label algomoney-word">AlgoMoney</div>
          </a>
        </div>
      </details>

        <nav id="main-nav" class="p-2 text-[14px] flex-1 overflow-y-auto">
          <p class="px-3 py-2 text-[12px] font-semibold uppercase tracking-[0.14em] text-slate-500 label">Overview</p>

          <a class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-slate-50 font-medium text-slate-900" href="/demo/dashboard.html" title="Home">
            <img src="https://aazofjsssobejhkyyiqv.supabase.co/storage/v1/object/public/AlgoHive/icons/home-01-stroke-rounded.svg" alt="" class="w-4 h-4 shrink-0" /><span class="label">Home</span>
          </a>

          <p class="mt-4 px-3 py-2 text-[12px] font-semibold uppercase tracking-[0.14em] text-slate-500 label">Markets</p>

          <details class="group mt-1">
            <summary class="flex items-center justify-between px-3 py-2 rounded-lg hover:bg-slate-50 cursor-pointer font-medium text-slate-900">
              <span class="flex items-center gap-3">
                <img src="https://aazofjsssobejhkyyiqv.supabase.co/storage/v1/object/public/AlgoHive/icons/market-analysis-stroke-rounded.svg" alt="" class="w-4 h-4" /><span class="label">Invest</span>
              </span>
              <i class="fa-solid fa-chevron-down text-slate-400 group-open:rotate-180 transition-transform chevron"></i>
            </summary>
            <div class="ml-8 mt-1 flex flex-col sub">
              <a class="px-3 py-2 rounded-lg hover:bg-slate-50 flex items-center gap-2" href="/demo/strategies.html" title="OpenStrategies">
                <img src="https://aazofjsssobejhkyyiqv.supabase.co/storage/v1/object/public/AlgoHive/icons/analysis-text-link-stroke-rounded.svg" alt="" class="w-4 h-4" /><span class="label">OpenStrategies</span>
              </a>
              <a class="px-3 py-2 rounded-lg hover:bg-slate-50 flex items-center gap-2" href="#" title="Funds">
                <img src="https://aazofjsssobejhkyyiqv.supabase.co/storage/v1/object/public/AlgoHive/icons/corporate-stroke-rounded.svg" alt="" class="w-4 h-4" />
                <span class="flex items-center gap-2">
                  <span class="label">Funds</span>
                  <span class="text-[10px] font-semibold uppercase tracking-[0.14em] text-slate-500 border border-slate-200 rounded-full px-2 py-[2px]">Coming Soon</span>
                </span>
              </a>
            <a class="px-3 py-2 rounded-lg hover:bg-slate-50 flex items-center gap-2" href="/demo/markets.html" title="Markets">
                <img src="https://aazofjsssobejhkyyiqv.supabase.co/storage/v1/object/public/AlgoHive/icons/earth-stroke-rounded.svg" alt="" class="w-4 h-4" /><span class="label">Markets</span>
              </a>
            </div>
          </details>

          <a class="mt-1 px-3 py-2 rounded-lg flex items-center gap-2 hover:bg-slate-50 font-medium text-slate-900" href="/demo/news-insights.html" title="News &amp; Insights">
            <img src="https://aazofjsssobejhkyyiqv.supabase.co/storage/v1/object/public/AlgoHive/icons/news-stroke-rounded.svg" alt="" class="w-4 h-4" /><span class="label">News &amp; Insights</span>
          </a>

          <p class="mt-4 px-3 py-2 text-[12px] font-semibold uppercase tracking-[0.14em] text-slate-500 label">Account</p>
          <a class="px-3 py-2 rounded-lg hover:bg-slate-50 flex items-center gap-2 font-medium text-slate-900" href="/demo/holdings.html" title="Holdings">
            <img src="https://aazofjsssobejhkyyiqv.supabase.co/storage/v1/object/public/AlgoHive/icons/pie-chart-09-stroke-rounded.svg" alt="" class="w-4 h-4" /><span class="label">Holdings</span>
          </a>
          <a class="px-3 py-2 rounded-lg hover:bg-slate-50 flex items-center gap-2 font-medium text-slate-900" href="/demo/account-statements.html" title="Account Statements">
            <img src="https://aazofjsssobejhkyyiqv.supabase.co/storage/v1/object/public/AlgoHive/icons/invoice-01-stroke-rounded.svg" alt="" class="w-4 h-4" /><span class="label">Account Statements</span>
          </a>
          <a class="px-3 py-2 rounded-lg hover:bg-slate-50 flex items-center gap-2 font-medium text-slate-900" href="#" title="Rewards">
            <img src="https://aazofjsssobejhkyyiqv.supabase.co/storage/v1/object/public/AlgoHive/icons/gift-stroke-rounded.svg" alt="" class="w-4 h-4" />
            <span class="flex items-center gap-2">
              <span class="label">Rewards</span>
              <span class="text-[10px] font-semibold uppercase tracking-[0.14em] text-slate-500 border border-slate-200 rounded-full px-2 py-[2px]">Coming Soon</span>
            </span>
          </a>
        <details class="group mt-4">
          <summary class="flex items-center justify-between px-3 py-2 rounded-lg hover:bg-slate-50 cursor-pointer font-medium text-slate-900">
            <span class="flex items-center">
              <span class="label">Other</span>
            </span>
            <i class="fa-solid fa-chevron-down text-slate-400 group-open:rotate-180 transition-transform chevron"></i>
          </summary>
          <div class="ml-8 mt-1 flex flex-col sub">
            <a class="px-3 py-2 rounded-lg flex items-center gap-2 hover:bg-slate-50 font-medium text-slate-900" href="#" title="Help">
              <img src="https://aazofjsssobejhkyyiqv.supabase.co/storage/v1/object/public/AlgoHive/icons/help-circle-stroke-rounded.svg" alt="" class="w-4 h-4" /><span class="label">Help</span>
            </a>
            <a class="px-3 py-2 rounded-lg flex items-center gap-2 hover:bg-slate-50 font-medium text-slate-900" href="#" title="Legal">
              <img src="https://aazofjsssobejhkyyiqv.supabase.co/storage/v1/object/public/AlgoHive/icons/audit-01-stroke-rounded.svg" alt="" class="w-4 h-4" /><span class="label">Legal</span>
            </a>
            <a class="px-3 py-2 rounded-lg flex items-center gap-2 hover:bg-slate-50 font-medium text-slate-900" href="#" title="Learn">
              <img src="https://aazofjsssobejhkyyiqv.supabase.co/storage/v1/object/public/AlgoHive/icons/pencil-stroke-rounded.svg" alt="" class="w-4 h-4" /><span class="flex items-center gap-2"><span class="label">Learn</span><span class="text-[10px] font-semibold uppercase tracking-[0.14em] text-slate-500 border border-slate-200 rounded-full px-2 py-[2px]">Coming Soon</span></span>
            </a>
          </div>
        </details>
      </nav>

      <div class="p-3 border-t border-slate-200 footer flex items-center justify-between gap-2">
        <a id="ah-settings" class="btn btn-settings h-10 w-10 p-0 rounded-xl bg-slate-100 hover:bg-slate-200 border-0" href="/demo/settings.html" title="Settings">
          <i class="fa-solid fa-gear"></i>
        </a>
        <button id="ah-collapse" class="btn btn-collapse h-10 w-10 p-0 rounded-xl bg-slate-100 hover:bg-slate-200 border-0" title="Collapse">
          <i class="fa-solid fa-arrow-left"></i>
        </button>
      </div>
    </aside>

    <main class="relative flex-1 min-w-0 bg-white">
      <div id="dashboard-skeleton" class="overflow-y-auto px-4 md:px-6 pt-4 pb-10">
        <div class="flex items-center justify-between gap-4">
          <div class="flex items-start md:items-center gap-3 flex-1 min-w-0">
            <div class="h-11 w-11 rounded-xl skeleton"></div>
            <div class="h-10 w-32 rounded-full skeleton"></div>
          </div>
          <div class="h-11 w-32 rounded-full skeleton"></div>
        </div>

        <div class="px-6 md:px-10 py-6 space-y-6">
          <div class="space-y-2">
            <div class="h-8 w-72 rounded-lg skeleton"></div>
            <div class="h-4 w-80 max-w-full rounded-lg skeleton"></div>
          </div>

          <div class="grid gap-6 sm:grid-cols-2 xl:grid-cols-4">
            <div class="bg-white rounded-xl shadow-sm p-5 space-y-3">
              <div class="h-4 w-24 rounded skeleton"></div>
              <div class="h-8 w-24 rounded skeleton"></div>
              <div class="h-4 w-32 rounded skeleton"></div>
            </div>
            <div class="bg-white rounded-xl shadow-sm p-5 space-y-3">
              <div class="h-4 w-20 rounded skeleton"></div>
              <div class="h-8 w-24 rounded skeleton"></div>
              <div class="h-4 w-28 rounded skeleton"></div>
            </div>
            <div class="bg-white rounded-xl shadow-sm p-5 space-y-3">
              <div class="h-4 w-28 rounded skeleton"></div>
              <div class="h-8 w-28 rounded skeleton"></div>
              <div class="h-4 w-24 rounded skeleton"></div>
            </div>
            <div class="bg-white rounded-xl shadow-sm p-5 space-y-3">
              <div class="h-4 w-24 rounded skeleton"></div>
              <div class="h-8 w-24 rounded skeleton"></div>
              <div class="h-4 w-24 rounded skeleton"></div>
            </div>
          </div>

          <div class="grid gap-6 lg:grid-cols-3">
            <div class="bg-white rounded-xl shadow-sm p-6 lg:col-span-2 space-y-4">
              <div class="h-5 w-56 rounded skeleton"></div>
              <div class="h-4 w-72 rounded skeleton"></div>
              <div class="h-[240px] rounded-lg skeleton"></div>
            </div>
            <div class="bg-white rounded-xl shadow-sm p-5 space-y-4">
              <div class="h-5 w-40 rounded skeleton"></div>
              <div class="h-4 w-52 rounded skeleton"></div>
              <div class="grid grid-cols-3 gap-3">
                <div class="h-16 rounded-lg skeleton"></div>
                <div class="h-16 rounded-lg skeleton"></div>
                <div class="h-16 rounded-lg skeleton"></div>
              </div>
              <div class="space-y-3">
                <div class="h-12 rounded-lg skeleton"></div>
                <div class="h-12 rounded-lg skeleton"></div>
                <div class="h-12 rounded-lg skeleton"></div>
              </div>
            </div>
          </div>

          <div class="bg-white rounded-xl shadow-sm p-5 space-y-4">
            <div class="h-5 w-48 rounded skeleton"></div>
            <div class="h-4 w-64 rounded skeleton"></div>
            <div class="flex flex-wrap gap-2">
              <div class="h-11 w-full md:w-64 rounded-lg skeleton"></div>
              <div class="h-11 w-28 rounded-lg skeleton"></div>
              <div class="h-11 w-28 rounded-lg skeleton"></div>
            </div>
            <div class="h-[260px] rounded-lg skeleton"></div>
          </div>
        </div>
      </div>
      <div class="px-4 md:px-6 pt-4">
        <div class="flex items-center justify-between gap-4">
          <div class="flex items-start md:items-center gap-3 flex-1 min-w-0">
            <button id="ah-mobile-menu-btn" class="md:hidden btn h-11 w-11 p-0 rounded-xl border-0" title="Open Menu">
              <i class="fa-solid fa-bars"></i>
            </button>
            <div class="inline-flex items-center gap-3 rounded-full border border-blue-200 bg-blue-50 px-4 py-2 text-sm text-blue-800 font-semibold">
              <div class="h-8 w-8 rounded-full border border-blue-200 bg-white grid place-items-center text-blue-600 text-base">ⓘ</div>
              <p class="whitespace-normal">Demo Account</p>
            </div>
          </div>

          <button id="profile-btn" class="shrink-0 inline-flex items-center gap-2 rounded-full border border-slate-200 bg-white px-3 py-1.5 shadow-sm hover:bg-slate-50">
            <img id="profile-avatar" src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='36' height='36'><rect width='100%' height='100%' fill='%23f1f5f9'/></svg>" alt="Profile" class="w-9 h-9 rounded-full object-cover border border-slate-200" />
            <span id="profile-name" class="text-sm font-semibold text-slate-900 hidden sm:inline">Demo User</span>
            <i class="fa-solid fa-chevron-down text-slate-500 text-xs"></i>
          </button>
        </div>
      </div>

      <div class="px-6 md:px-10 py-6 space-y-6">
        <section class="space-y-2" id="header-section">
          <h1 id="dashboard-title" class="text-[28px] md:text-[32px] font-semibold text-slate-900">Dashboard</h1>
          <p class="text-sm md:text-base text-slate-500">Here's your financial snapshot for today.</p>
        </section>

        <section id="stats-cards" class="grid gap-6 sm:grid-cols-2 xl:grid-cols-4"></section>

        <section class="grid gap-6 lg:grid-cols-3" id="performance-grid">
          <article class="bg-white rounded-xl shadow-sm p-6 lg:col-span-2">
            <div class="flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
              <div>
                <p class="text-sm font-semibold text-slate-900">Portfolio Growth &amp; Equity Curve</p>
                <p class="text-sm text-slate-500">Compare AlgoHive performance against the benchmark.</p>
              </div>
              <div class="inline-flex rounded-lg border border-slate-200 bg-slate-50 p-1" id="equity-toggle" role="group" aria-label="Equity range">
                <button data-range="monthly" class="h-10 min-w-[88px] rounded-md px-4 text-sm font-semibold text-slate-700">Monthly</button>
                <button data-range="yearly" class="h-10 min-w-[88px] rounded-md px-4 text-sm font-semibold text-slate-700">Yearly</button>
              </div>
            </div>
            <div class="mt-6 h-[280px]">
              <canvas id="equity-chart"></canvas>
            </div>
          </article>

          <article class="bg-white rounded-xl shadow-sm p-5 flex flex-col gap-4" id="asset-panel">
            <div class="flex items-start justify-between gap-2">
              <div>
                <p class="text-sm font-semibold text-slate-900">Asset Allocation Status</p>
                <p class="text-sm text-slate-500">Portfolio health by performance.</p>
              </div>
              <a href="#" class="text-sm font-semibold text-indigo-600 hover:text-indigo-700">View all</a>
            </div>
            <div class="grid grid-cols-3 gap-3 text-center">
              <div class="rounded-lg bg-green-50 py-3">
                <p class="text-xl font-bold text-slate-900" id="performing-count">0</p>
                <p class="text-xs font-semibold uppercase tracking-wide text-green-600">Performing</p>
              </div>
              <div class="rounded-lg bg-rose-50 py-3">
                <p class="text-xl font-bold text-slate-900" id="declining-count">0</p>
                <p class="text-xs font-semibold uppercase tracking-wide text-rose-600">Declining</p>
              </div>
              <div class="rounded-lg bg-yellow-50 py-3">
                <p class="text-xl font-bold text-slate-900" id="idle-count">0</p>
                <p class="text-xs font-semibold uppercase tracking-wide text-amber-600">Idle Capital</p>
              </div>
            </div>
            <div class="space-y-4" id="asset-list"></div>
          </article>
        </section>

        <section class="bg-white rounded-xl shadow-sm p-5">
          <div class="flex flex-col gap-3 md:flex-row md:items-center md:justify-between">
            <div>
              <p class="text-lg font-semibold text-slate-900">Transactions List</p>
              <p class="text-sm text-slate-500">Recent portfolio movements and status.</p>
            </div>
            <div class="flex flex-wrap items-center gap-2">
              <input id="transaction-search" type="search" placeholder="Search transactions" class="h-11 w-full rounded-lg border border-slate-200 px-3 text-sm text-slate-700 shadow-sm focus:border-slate-400 focus:outline-none md:w-64" />
              <button id="date-filter" class="h-11 rounded-lg border border-slate-200 bg-white px-3 text-sm font-semibold text-slate-700 shadow-sm hover:bg-slate-50">All dates</button>
              <button id="export-csv" class="h-11 rounded-lg bg-slate-900 px-4 text-sm font-semibold text-white shadow-sm hover:bg-slate-800">Export CSV</button>
            </div>
          </div>

          <div class="mt-4 hidden md:block">
            <div class="overflow-x-auto rounded-lg border border-slate-200">
              <table class="min-w-full divide-y divide-slate-200 text-sm" aria-label="Transactions table">
                <thead class="bg-slate-50 text-left text-xs font-semibold uppercase tracking-wide text-slate-500">
                  <tr>
                    <th class="px-4 py-3">Transaction ID</th>
                    <th class="px-4 py-3">Asset</th>
                    <th class="px-4 py-3">Type</th>
                    <th class="px-4 py-3">Amount</th>
                    <th class="px-4 py-3">Date</th>
                    <th class="px-4 py-3">Status</th>
                    <th class="px-4 py-3">Notes</th>
                  </tr>
                </thead>
                <tbody id="transaction-rows" class="divide-y divide-slate-100 bg-white"></tbody>
              </table>
            </div>
          </div>

          <div class="mt-4 space-y-3 md:hidden" id="transaction-cards" aria-label="Transactions list"></div>
        </section>
      </div>
    </main>
  </div>

  <div id="toast-stack" class="toast-stack" aria-live="polite" aria-atomic="true"></div>

  <div id="transaction-modal" class="fixed inset-0 z-50 hidden items-center justify-center bg-black/40 px-4">
    <div class="w-full max-w-lg rounded-2xl bg-white shadow-2xl">
      <div class="flex items-start justify-between gap-3 border-b border-slate-200 px-5 py-4">
        <div>
          <p class="text-xs font-semibold uppercase tracking-[0.14em] text-slate-500">Transaction Details</p>
          <h3 id="modal-title" class="text-lg font-semibold text-slate-900"></h3>
        </div>
        <button id="close-modal" class="text-slate-400 hover:text-slate-600" aria-label="Close modal">
          <i class="fa-solid fa-xmark"></i>
        </button>
      </div>
      <div id="modal-body" class="space-y-3 px-5 py-4 text-sm text-slate-700"></div>
      <div class="flex items-center justify-end gap-2 border-t border-slate-200 px-5 py-4">
        <button id="modal-close-btn" class="h-11 rounded-lg border border-slate-200 bg-white px-4 text-sm font-semibold text-slate-700 hover:bg-slate-50">Close</button>
        <button class="h-11 rounded-lg bg-slate-900 px-4 text-sm font-semibold text-white hover:bg-slate-800">View in ledger</button>
      </div>
    </div>
  </div>

  <div id="funds-modal" class="fixed inset-0 z-50 hidden">
    <div id="funds-overlay" class="absolute inset-0 bg-black/40"></div>
    <div class="absolute inset-0 flex items-center justify-center p-4">
      <div class="w-full max-w-md overflow-hidden rounded-2xl border border-slate-200 bg-white shadow-2xl">
        <div class="flex items-start justify-between gap-3 border-b border-slate-200 px-5 py-4">
          <div>
            <p class="text-xs font-semibold uppercase tracking-[0.2em] text-slate-500">Add funds</p>
            <h3 class="text-lg font-semibold text-slate-900">Top up a demo account</h3>
          </div>
          <button id="funds-close" type="button" class="text-slate-500 hover:text-slate-800" aria-label="Close">
            <i class="fa-solid fa-xmark"></i>
          </button>
        </div>
        <div class="px-5 py-4 space-y-4">
          <label class="block text-sm font-medium text-slate-700">
            Choose account
            <select id="funds-account" class="mt-1 w-full rounded-lg border border-slate-200 px-3 py-2 text-[15px] font-semibold text-slate-900 focus:outline-none focus:ring-2 focus:ring-slate-900">
              <option value="">Loading…</option>
            </select>
          </label>
          <label class="block text-sm font-medium text-slate-700">
            Amount (USD)
            <input id="funds-amount" type="number" inputmode="decimal" min="1" max="100000" step="1" placeholder="500" class="mt-1 w-full rounded-lg border border-slate-200 px-3 py-2 text-[15px] font-semibold text-slate-900 focus:outline-none focus:ring-2 focus:ring-slate-900" />
            <p class="mt-1 text-xs text-slate-500">Minimum $1 — Maximum $100,000.</p>
          </label>
        </div>
        <div class="flex items-center justify-between gap-3 border-t border-slate-200 bg-slate-50/80 px-5 py-3">
          <p class="text-xs text-slate-500">Funds apply to your selected demo account.</p>
          <div class="flex items-center gap-3">
            <button id="funds-cancel" type="button" class="btn bg-white text-slate-700">Cancel</button>
            <button id="funds-submit" type="button" class="btn bg-slate-900 text-white border-slate-900 hover:bg-slate-800">Confirm</button>
          </div>
        </div>
      </div>
    </div>
  </div>

    <script type="module" nonce="ALGOHIVE">
    import { supabase } from '/js/supabase.js';

    const dashboardTitle = document.getElementById('dashboard-title');
    const profileNameEl = document.getElementById('profile-name');
    const profileAvatarEl = document.getElementById('profile-avatar');
    const fallbackFirstName = 'Trader';

    const getGreeting = () => {
      const hour = new Date().getHours();
      if (hour < 12) return 'Good Morning';
      if (hour < 18) return 'Good Afternoon';
      return 'Good Evening';
    };

    const setGreetingName = (firstName = fallbackFirstName) => {
      if (dashboardTitle) dashboardTitle.textContent = `${getGreeting()} ${firstName}`;
    };

    const setProfileName = (fullName) => {
      if (profileNameEl && fullName) {
        profileNameEl.textContent = fullName;
      }
    };

    let baseCurrency = 'USD';
    let profileBalance = 0;
    let currentUserId = null;

    const statsData = [
      { title: 'Total Balance', value: '$0.00', changePercent: 0, changeDirection: 'up', subtitle: 'Funds available in demo wallet' },
      { title: 'Total Transactions', value: '179', changePercent: -1.1, changeDirection: 'down', subtitle: 'Number of trades this period' },
      { title: 'Total Revenue', value: '$7,209.29', changePercent: 2.3, changeDirection: 'up', subtitle: 'Net revenue' },
      { title: 'Active Investments', value: '234', changePercent: 6.4, changeDirection: 'up', subtitle: 'Live portfolios following strategies' },
    ];

    const equitySeries = {
      monthly: [
        { date: '2024-01-01', equity: 9200, benchmark: 9100 },
        { date: '2024-02-01', equity: 9600, benchmark: 9400 },
        { date: '2024-03-01', equity: 10150, benchmark: 9900 },
        { date: '2024-04-01', equity: 10780, benchmark: 10300 },
        { date: '2024-05-01', equity: 11240, benchmark: 10780 },
        { date: '2024-06-01', equity: 11810, benchmark: 11140 },
        { date: '2024-07-01', equity: 12360, benchmark: 11500 },
        { date: '2024-08-01', equity: 12840, benchmark: 11860 },
        { date: '2024-09-01', equity: 13320, benchmark: 12210 },
        { date: '2024-10-01', equity: 13780, benchmark: 12500 },
        { date: '2024-11-01', equity: 14240, benchmark: 12860 },
        { date: '2024-12-01', equity: 14860, benchmark: 13220 },
      ],
      yearly: [
        { date: '2021', equity: 6200, benchmark: 6400 },
        { date: '2022', equity: 8200, benchmark: 7900 },
        { date: '2023', equity: 10900, benchmark: 9800 },
        { date: '2024', equity: 14860, benchmark: 13220 },
      ],
    };

    const assetSummary = {
      performing: 72,
      declining: 24,
      idle: 16,
      assets: [
        { symbol: 'DASH', name: 'Dash', type: 'Cryptocurrency', status: 'Performing' },
        { symbol: 'ETH', name: 'Ethereum', type: 'Cryptocurrency', status: 'Performing' },
        { symbol: 'BTC', name: 'Bitcoin', type: 'Cryptocurrency', status: 'Declining' },
        { symbol: 'USDC', name: 'USDC', type: 'Stablecoin', status: 'Idle' },
      ],
    };

    const transactions = [
      { id: '#TX29814', asset: 'Dash', type: 'Cryptocurrency', amount: 250.0, date: '2024-01-24', status: 'Performing', notes: 'Live trade' },
      { id: '#TX58982', asset: 'Ethereum', type: 'Cryptocurrency', amount: 74.29, date: '2024-01-26', status: 'Performing', notes: 'Live trade' },
      { id: '#TX52607', asset: 'Bitcoin', type: 'Cryptocurrency', amount: 82.14, date: '2024-01-08', status: 'Declining', notes: 'Price drawdown' },
      { id: '#TX95867', asset: 'USDC', type: 'Stablecoin', amount: 1200.0, date: '2024-01-18', status: 'Idle', notes: 'Idle capital' },
      { id: '#TX63411', asset: 'AAPL', type: 'Equity', amount: 410.75, date: '2024-01-20', status: 'Performing', notes: 'Earnings momentum' },
      { id: '#TX72188', asset: 'GLD', type: 'ETF', amount: 160.5, date: '2024-01-12', status: 'Performing', notes: 'Rebalance' },
      { id: '#TX81132', asset: 'TSLA', type: 'Equity', amount: 300.25, date: '2024-01-02', status: 'Declining', notes: 'Volatility hedge' },
      { id: '#TX90221', asset: 'QQQ', type: 'ETF', amount: 285.9, date: '2024-01-29', status: 'Performing', notes: 'Momentum add' },
      { id: '#TX13215', asset: 'ADA', type: 'Cryptocurrency', amount: 92.5, date: '2024-01-17', status: 'Idle', notes: 'Waiting signal' },
      { id: '#TX82144', asset: 'SOL', type: 'Cryptocurrency', amount: 210.1, date: '2024-01-05', status: 'Performing', notes: 'Trend follow' },
      { id: '#TX44119', asset: 'SPY', type: 'ETF', amount: 510.0, date: '2023-12-28', status: 'Performing', notes: 'Year-end allocation' },
    ];

    const pillStyles = {
      Performing: 'bg-green-100 text-green-700',
      Declining: 'bg-red-100 text-red-700',
      Idle: 'bg-yellow-100 text-yellow-700',
      'Idle Capital': 'bg-yellow-100 text-yellow-700',
    };

    let chartInstance = null;
    let currentRange = 'monthly';
    let currentDateFilter = 'all';

    function formatCurrency(value = 0, currency = 'USD') {
      try {
        return value.toLocaleString('en-US', {
          style: 'currency',
          currency,
          minimumFractionDigits: 2,
          maximumFractionDigits: 2,
        });
      } catch (error) {
        return `$${Number(value || 0).toFixed(2)}`;
      }
    }

    function setBalanceCard(value = 0, currency = baseCurrency) {
      profileBalance = Number(value) || 0;
      baseCurrency = currency || 'USD';
      statsData[0].value = formatCurrency(profileBalance, baseCurrency);
      renderStats();
    }

    async function hydrateBalanceFromDemo(userId = '') {
      if (!userId) {
        setBalanceCard(profileBalance, baseCurrency);
        return;
      }
      try {
        const { data, error } = await supabase
          .from('demo_profiles')
          .select('balance, base_currency')
          .eq('id', userId)
          .maybeSingle();

        if (error) throw error;
        setBalanceCard(data?.balance ?? 0, data?.base_currency || 'USD');
      } catch (error) {
        console.warn('demo_profiles balance fetch failed; using fallback balance', error);
        setBalanceCard(profileBalance, baseCurrency);
      }
    }

    async function hydrateProfileFromLive() {
      try {
        const { data: userWrap } = await supabase.auth.getUser();
        const user = userWrap?.user;
        if (!user) {
          setGreetingName();
          setProfileName('Demo User');
          hydrateBalanceFromDemo();
          return;
        }

        currentUserId = user.id;

        const { data: profile } = await supabase
          .from('profiles')
          .select('first_name, last_name, avatar_url')
          .eq('id', user.id)
          .maybeSingle();

        const firstName = profile?.first_name || user.user_metadata?.first_name || fallbackFirstName;
        const lastName = profile?.last_name || user.user_metadata?.last_name || '';
        const fullName = [firstName, lastName].filter(Boolean).join(' ').trim();

        setGreetingName(firstName);
        setProfileName(fullName || firstName);

        const avatarUrl = profile?.avatar_url || user.user_metadata?.avatar_url;
        if (avatarUrl && profileAvatarEl) profileAvatarEl.src = avatarUrl;

        hydrateBalanceFromDemo(user.id);
      } catch (error) {
        console.warn('Profile hydration failed; using defaults', error);
      }
    }

    setGreetingName();
    hydrateProfileFromLive();

    const statsContainer = document.getElementById('stats-cards');
    const assetList = document.getElementById('asset-list');
    const performingCount = document.getElementById('performing-count');
    const decliningCount = document.getElementById('declining-count');
    const idleCount = document.getElementById('idle-count');
    const transactionRows = document.getElementById('transaction-rows');
    const transactionCards = document.getElementById('transaction-cards');
    const searchInput = document.getElementById('transaction-search');
    const dateFilter = document.getElementById('date-filter');
    const exportBtn = document.getElementById('export-csv');
    const modal = document.getElementById('transaction-modal');
    const modalTitle = document.getElementById('modal-title');
    const modalBody = document.getElementById('modal-body');
    const modalCloseBtns = [document.getElementById('close-modal'), document.getElementById('modal-close-btn')];
    const skeletonLayer = document.getElementById('dashboard-skeleton');
    const fundsModal = document.getElementById('funds-modal');
    const fundsOverlay = document.getElementById('funds-overlay');
    const fundsClose = document.getElementById('funds-close');
    const fundsAccount = document.getElementById('funds-account');
    const fundsAmount = document.getElementById('funds-amount');
    const fundsCancel = document.getElementById('funds-cancel');
    const fundsSubmit = document.getElementById('funds-submit');
    const toastStack = document.getElementById('toast-stack');

    function showToast(message, tone = 'ok') {
      if (!toastStack || !message) return;

      const iconMap = {
        ok: 'fa-check',
        warn: 'fa-triangle-exclamation',
        err: 'fa-circle-xmark',
      };

      const toneKey = ['ok', 'warn', 'err'].includes(tone) ? tone : 'ok';
      const toast = document.createElement('article');
      toast.className = 'toast-card';
      toast.dataset.tone = toneKey;

      toast.innerHTML = `
        <span class="toast-icon"><i class="fa-solid ${iconMap[toneKey]}"></i></span>
        <div class="toast-content"><p class="toast-message">${message}</p></div>
        <button class="toast-dismiss" aria-label="Dismiss notification"><i class="fa-solid fa-xmark"></i></button>
      `;

      const removeToast = () => {
        toast.classList.add('toast-card--leaving');
        setTimeout(() => toast.remove(), 320);
      };

      toast.querySelector('.toast-dismiss')?.addEventListener('click', removeToast);
      toastStack.appendChild(toast);
      setTimeout(removeToast, 4200);
    }

    function renderStats() {
      if (!statsContainer) return;
      statsContainer.innerHTML = statsData
        .map((item) => {
          const positive = item.changeDirection === 'up';
          const pillClass = positive ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700';
          const arrow = positive ? '↑' : '↓';
          const isBalanceCard = item.title === 'Total Balance';
          const addFundsCta = isBalanceCard
              ? `<div class="pt-2"><button data-add-funds class="btn btn-olive w-full justify-center text-sm">
                  <i class="fa-solid fa-plus text-xs"></i><span>Add funds</span>
                </button></div>`
              : '';
          return `
            <article class="bg-white rounded-xl stat-card p-5 space-y-3 border border-slate-100">
              <p class="text-sm font-semibold text-slate-500">${item.title}</p>
              <div class="flex items-center justify-between gap-3">
                <p class="text-[28px] md:text-[32px] font-bold text-slate-900">${item.value}</p>
                <span class="inline-flex items-center gap-1 rounded-full px-3 py-1 text-xs font-semibold ${pillClass}">${arrow} ${item.changePercent}%</span>
              </div>
              <p class="text-sm text-slate-500">${item.subtitle}</p>
              ${addFundsCta}
            </article>`;
        })
        .join('');

      attachAddFundsHandler();
    }

    function buildChart(rangeKey = 'monthly') {
      const ctx = document.getElementById('equity-chart')?.getContext('2d');
      if (!ctx) return;
      const data = equitySeries[rangeKey] || [];
      const labels = data.map((item) => {
        const date = new Date(item.date);
        return rangeKey === 'monthly' ? date.toLocaleString('default', { month: 'short' }) : item.date;
      });

      const equityDataPoints = data.map((item) => item.equity);
      const benchmarkDataPoints = data.map((item) => item.benchmark);

      if (chartInstance) chartInstance.destroy();

      chartInstance = new Chart(ctx, {
        type: 'line',
        data: {
          labels,
          datasets: [
            {
              label: 'Equity',
              data: equityDataPoints,
              borderColor: '#2563eb',
              backgroundColor: 'rgba(37, 99, 235, 0.12)',
              tension: 0.35,
              pointRadius: 0,
              borderWidth: 2.5,
              fill: true,
            },
            {
              label: 'Benchmark',
              data: benchmarkDataPoints,
              borderColor: '#cbd5e1',
              borderDash: [6, 6],
              tension: 0.35,
              pointRadius: 0,
              borderWidth: 2,
              fill: false,
            },
          ],
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { position: 'top', labels: { usePointStyle: true } },
            tooltip: {
              callbacks: {
                label: (ctx) => `${ctx.dataset.label}: ${ctx.parsed.y.toLocaleString('en-US', { style: 'currency', currency: 'USD', maximumFractionDigits: 0 })}`,
              },
            },
          },
          scales: {
            x: { grid: { display: false } },
            y: { grid: { color: 'rgba(148, 163, 184, 0.3)' }, ticks: { callback: (val) => `$${val}` } },
          },
        },
      });
    }

    function toggleRange(range) {
      currentRange = range;
      const buttons = document.querySelectorAll('#equity-toggle button');
      buttons.forEach((btn) => {
        const isActive = btn.dataset.range === range;
        btn.classList.toggle('bg-blue-600', isActive);
        btn.classList.toggle('text-white', isActive);
        btn.classList.toggle('shadow-sm', isActive);
      });
      buildChart(range);
    }

    function renderAssets() {
      performingCount.textContent = assetSummary.performing;
      decliningCount.textContent = assetSummary.declining;
      idleCount.textContent = assetSummary.idle;

      assetList.innerHTML = assetSummary.assets.slice(0, 3)
        .map((asset) => {
          const pill = pillStyles[asset.status] || 'bg-slate-100 text-slate-700';
          return `
            <div class="flex items-center justify-between gap-3 rounded-lg border border-slate-200 px-3 py-2.5">
              <div class="flex items-center gap-3">
                <div class="h-10 w-10 rounded-full bg-slate-100 text-slate-700 grid place-items-center text-sm font-semibold">${asset.symbol.slice(0, 3)}</div>
                <div>
                  <p class="font-semibold text-slate-900">${asset.name || asset.symbol}</p>
                  <p class="text-xs text-slate-500">${asset.type}</p>
                </div>
              </div>
              <span class="inline-flex items-center rounded-full px-3 py-1 text-xs font-semibold ${pill}">${asset.status}</span>
            </div>`;
        })
        .join('');
    }

    function formatAmount(value) {
      return value.toLocaleString('en-US', { style: 'currency', currency: 'USD', minimumFractionDigits: 2 });
    }

    function matchSearch(tx, term) {
      const haystack = `${tx.id} ${tx.asset} ${tx.type} ${tx.status} ${tx.notes}`.toLowerCase();
      return haystack.includes(term.toLowerCase());
    }

    function withinDate(tx) {
      if (currentDateFilter === 'all') return true;
      const txDate = new Date(tx.date);
      const cutoff = new Date();
      if (currentDateFilter === '30') cutoff.setDate(cutoff.getDate() - 30);
      if (currentDateFilter === '90') cutoff.setDate(cutoff.getDate() - 90);
      return txDate >= cutoff;
    }

    function filteredTransactions() {
      const term = searchInput.value.trim();
      return transactions.filter((tx) => (!term || matchSearch(tx, term)) && withinDate(tx));
    }

    function renderTable() {
      const rows = filteredTransactions();
      transactionRows.innerHTML = rows
        .map((tx) => {
          const pill = pillStyles[tx.status] || 'bg-slate-100 text-slate-700';
          return `
            <tr class="hover:bg-slate-50 cursor-pointer" data-id="${tx.id}">
              <td class="px-4 py-3 font-semibold text-slate-900">${tx.id}</td>
              <td class="px-4 py-3 text-slate-700">${tx.asset}</td>
              <td class="px-4 py-3 text-slate-700">${tx.type}</td>
              <td class="px-4 py-3 text-slate-700">${formatAmount(tx.amount)}</td>
              <td class="px-4 py-3 text-slate-700">${tx.date.replace(/-/g, '/')}</td>
              <td class="px-4 py-3"><span class="inline-flex rounded-full px-3 py-1 text-xs font-semibold ${pill}">${tx.status}</span></td>
              <td class="px-4 py-3 text-slate-500">${tx.notes}</td>
            </tr>`;
        })
        .join('');

      transactionCards.innerHTML = rows
        .map((tx) => {
          const pill = pillStyles[tx.status] || 'bg-slate-100 text-slate-700';
          return `
            <div class="rounded-lg border border-slate-200 bg-white p-4 shadow-sm space-y-2" data-id="${tx.id}">
              <div class="flex items-center justify-between gap-2">
                <div>
                  <p class="text-base font-semibold text-slate-900">${tx.asset}</p>
                  <p class="text-xs text-slate-500">${formatAmount(tx.amount)}</p>
                </div>
                <span class="inline-flex rounded-full px-3 py-1 text-xs font-semibold ${pill}">${tx.status}</span>
              </div>
              <div class="flex items-center justify-between text-xs text-slate-500">
                <span>${tx.id}</span>
                <span>${tx.date.replace(/-/g, '/')}</span>
              </div>
              <p class="text-sm text-slate-600">${tx.notes}</p>
            </div>`;
        })
        .join('');
    }

    function showModal(txId) {
      const tx = transactions.find((item) => item.id === txId);
      if (!tx) return;
      modalTitle.textContent = tx.asset;
      modalBody.innerHTML = `
        <div class="grid grid-cols-2 gap-3">
          <div><p class="text-xs text-slate-500">Transaction ID</p><p class="font-semibold text-slate-900">${tx.id}</p></div>
          <div><p class="text-xs text-slate-500">Type</p><p class="font-semibold text-slate-900">${tx.type}</p></div>
          <div><p class="text-xs text-slate-500">Amount</p><p class="font-semibold text-slate-900">${formatAmount(tx.amount)}</p></div>
          <div><p class="text-xs text-slate-500">Date</p><p class="font-semibold text-slate-900">${tx.date.replace(/-/g, '/')}</p></div>
          <div><p class="text-xs text-slate-500">Status</p><p class="font-semibold text-slate-900">${tx.status}</p></div>
          <div><p class="text-xs text-slate-500">Notes</p><p class="font-semibold text-slate-900">${tx.notes}</p></div>
        </div>`;
      modal.classList.remove('hidden');
    }

    function wireTableClicks() {
      transactionRows.addEventListener('click', (event) => {
        const row = event.target.closest('tr');
        if (row?.dataset.id) showModal(row.dataset.id);
      });
      transactionCards.addEventListener('click', (event) => {
        const card = event.target.closest('[data-id]');
        if (card?.dataset.id) showModal(card.dataset.id);
      });
    }

    function wireModal() {
      modalCloseBtns.forEach((btn) => btn?.addEventListener('click', () => modal.classList.add('hidden')));
      modal.addEventListener('click', (event) => {
        if (event.target === modal) modal.classList.add('hidden');
      });
      document.addEventListener('keydown', (event) => {
        if (event.key === 'Escape') modal.classList.add('hidden');
      });
    }

    function wireSearch() {
      searchInput.addEventListener('input', renderTable);
    }

    function wireDateFilter() {
      const options = ['all', '30', '90'];
      dateFilter.addEventListener('click', () => {
        const nextIndex = (options.indexOf(currentDateFilter) + 1) % options.length;
        currentDateFilter = options[nextIndex];
        const label = currentDateFilter === 'all' ? 'All dates' : `Last ${currentDateFilter} days`;
        dateFilter.textContent = label;
        renderTable();
      });
    }

    function wireExport() {
      exportBtn.addEventListener('click', () => {
        const rows = filteredTransactions();
        const header = ['Transaction ID', 'Asset', 'Type', 'Amount', 'Date', 'Status', 'Notes'];
        const csv = [header.join(',')].concat(
          rows.map((tx) => [tx.id, tx.asset, tx.type, tx.amount, tx.date, tx.status, tx.notes].map((v) => `"${v}"`).join(','))
        );
        const blob = new Blob([csv.join('\n')], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = 'transactions.csv';
        link.click();
      });
    }

    function wireRangeButtons() {
      document.querySelectorAll('#equity-toggle button').forEach((btn) => {
        btn.addEventListener('click', () => toggleRange(btn.dataset.range));
      });
    }

    function populateFundsAccount() {
      if (!fundsAccount) return;
      const label = profileNameEl?.textContent?.trim() || 'Demo account';
      const optionValue = currentUserId || 'demo-account';
      fundsAccount.innerHTML = '';
      const opt = document.createElement('option');
      opt.value = optionValue;
      opt.textContent = optionValue === 'demo-account' ? `${label} (local)` : label;
      fundsAccount.appendChild(opt);
    }

    function openFundsModal() {
      populateFundsAccount();
      fundsModal?.classList.remove('hidden');
      if (fundsAmount) {
        fundsAmount.value = '';
        fundsAmount.focus();
      }
    }

    function closeFundsModal() {
      fundsModal?.classList.add('hidden');
    }

    async function submitFunds() {
      if (!fundsAccount || !fundsAmount) return;

      const amount = Number.parseFloat(fundsAmount.value);
      if (!Number.isFinite(amount) || amount <= 0) {
        showToast('Enter a valid amount above 0.', 'warn');
        return;
      }

      const nextBalance = profileBalance + amount;
      setBalanceCard(nextBalance, baseCurrency);

      if (currentUserId) {
        try {
          const { data, error } = await supabase
            .from('demo_profiles')
            .update({ balance: nextBalance })
            .eq('id', currentUserId)
            .select('balance, base_currency')
            .maybeSingle();

          if (error) throw error;
          setBalanceCard(data?.balance ?? nextBalance, data?.base_currency || baseCurrency);
          showToast('Funds added successfully.', 'ok');
        } catch (error) {
          console.warn('Add funds failed', error);
          showToast('Unable to add funds right now. Please try again later.', 'err');
        }
      } else {
        console.warn('Add funds attempted without a signed-in user.');
        showToast('Demo balance updated locally.', 'ok');
      }

      closeFundsModal();
    }

    function attachAddFundsHandler() {
      const addFundsBtn = document.querySelector('[data-add-funds]');
      if (!addFundsBtn) return;
      addFundsBtn.addEventListener('click', openFundsModal);
    }

    function wireFundsModal() {
      fundsClose?.addEventListener('click', closeFundsModal);
      fundsOverlay?.addEventListener('click', closeFundsModal);
      fundsCancel?.addEventListener('click', closeFundsModal);
      fundsSubmit?.addEventListener('click', submitFunds);
    }

    function hideSkeleton() {
      if (!skeletonLayer) return;
      skeletonLayer.style.opacity = '0';
      setTimeout(() => skeletonLayer.remove(), 260);
    }

    function wireSidebar() {
      const sidebar = document.getElementById('ah-sidebar');
      const overlay = document.getElementById('ah-overlay');
      const mobileBtn = document.getElementById('ah-mobile-menu-btn');
      const collapseBtn = document.getElementById('ah-collapse');

      mobileBtn?.addEventListener('click', () => {
        sidebar?.classList.add('is-open');
        overlay?.classList.remove('hidden');
      });

      overlay?.addEventListener('click', () => {
        sidebar?.classList.remove('is-open');
        overlay?.classList.add('hidden');
      });

      collapseBtn?.addEventListener('click', () => {
        const layout = document.getElementById('layout');
        const isCollapsed = sidebar?.dataset.collapsed === 'true';
        const next = !isCollapsed;
        sidebar.dataset.collapsed = String(next);
        layout?.classList.toggle('is-collapsed', next);
      });
    }

    function init() {
      renderStats();
      toggleRange(currentRange);
      renderAssets();
      renderTable();
      wireTableClicks();
      wireModal();
      wireSearch();
      wireDateFilter();
      wireExport();
      wireRangeButtons();
      wireFundsModal();
      wireSidebar();
      hideSkeleton();
    }

    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>

</html>
