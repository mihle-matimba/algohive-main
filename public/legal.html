<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AlgoHive — Legal</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />

  <style>
    :root {
      --page: #0b1220;
      --bg: #ffffff;
      --muted: #64748b;
      --ink: #0f172a;
      --olive: #7e8d52;
      --brand: #f59e0b;
      --line: #e2e8f0;
    }

    html,
    body {
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      background: var(--bg);
      color: var(--ink);
      height: 100%;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: .5rem;
      height: 40px;
      padding: 0 .875rem;
      border-radius: 10px;
      border: 1px solid var(--line);
      font-weight: 600;
    }

    .input {
      height: 40px;
      border: 1px solid var(--line);
      border-radius: 10px;
      padding: 0 .75rem;
    }

    #layout {
      --sb: 220px;
      display: grid;
      grid-template-columns: var(--sb) 1fr;
      min-height: 100vh;
    }

    #layout.is-collapsed {
      --sb: 64px;
    }

    #ah-sidebar {
      transition: width .2s ease;
      width: var(--sb);
    }

    #ah-sidebar[data-collapsed="true"] .label,
    #ah-sidebar[data-collapsed="true"] .chevron {
      display: none;
    }

    #ah-sidebar[data-collapsed="true"] details>.sub {
      display: none !important;
    }

    #ah-sidebar[data-collapsed="true"] nav a,
    #ah-sidebar[data-collapsed="true"] details>summary {
      justify-content: center;
      gap: .25rem;
    }

    #ah-sidebar .footer {
      transition: all .2s ease;
    }

    #ah-sidebar[data-collapsed="true"] .footer {
      justify-content: center;
      flex-direction: column;
      gap: 12px;
    }

    .btn-collapse :is(svg, i) {
      transition: transform .25s ease;
    }

    #ah-sidebar[data-collapsed="true"] .btn-collapse :is(svg, i) {
      transform: rotate(180deg);
    }

    .btn-olive {
      background: var(--olive);
      color: #fff;
      border: 0;
    }

    .btn-olive:hover {
      filter: brightness(0.92);
    }

    .btn-olive:disabled {
      opacity: .6;
      cursor: not-allowed;
    }

    /* Active state for the links */
    .link-active {
        background-color: #f1f5f9;
        color: #0f172a;
    }
  </style>
</head>

<body class="min-h-screen overflow-x-hidden">
  <div id="layout">
    <!-- ===== Sidebar ===== -->
    <aside id="ah-sidebar" data-collapsed="false"
      class="border-r border-slate-200 h-[100vh] sticky top-0 bg-white flex flex-col overflow-hidden">
      <div class="px-4 py-4 flex items-center gap-3 border-b border-slate-200">
        <img src="https://static.wixstatic.com/media/ac771e_af06d86a7a1f4abd87e52e45f3bcbd96~mv2.png"
          alt="AlgoHive Logo" class="w-10 h-10 object-contain" />
        <div class="min-w-0">
          <div class="font-bold text-[15px] text-slate-900 label">AlgoHive</div>
          <div class="text-[11px] text-slate-500 label">Where Smart Capital Gathers</div>
        </div>
      </div>

      <nav id="main-nav" class="p-2 text-[14px] flex-1 overflow-y-auto">
        <a class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-slate-50 font-medium text-slate-900"
          href="/home.html" title="Home">
          <i class="fa-solid fa-house text-slate-500 w-4 shrink-0"></i><span class="label">Home</span>
        </a>

        <details class="group mt-1">
          <summary
            class="flex items-center justify-between px-3 py-2 rounded-lg hover:bg-slate-50 cursor-pointer font-medium text-slate-900">
            <span class="flex items-center gap-3">
              <i class="fa-regular fa-user w-4 text-slate-500"></i><span class="label">Portfolio</span>
            </span>
            <i class="fa-solid fa-chevron-down text-slate-400 group-open:rotate-180 transition-transform chevron"></i>
          </summary>
          <div class="ml-8 mt-1 flex flex-col sub">
            <a class="px-3 py-2 rounded-lg hover:bg-slate-50 flex items-center gap-2" href="/my-strategies.html"><i
                class="fa-solid fa-chart-pie w-4 text-slate-500"></i><span class="label">My Strategies</span></a>
           </div>
        </details>

        <details class="group mt-1">
          <summary
            class="flex items-center justify-between px-3 py-2 rounded-lg hover:bg-slate-50 cursor-pointer font-medium text-slate-900">
            <span class="flex items-center gap-3">
              <i class="fa-solid fa-link w-4 text-slate-500"></i><span class="label">Invest</span>
            </span>
            <i class="fa-solid fa-chevron-down text-slate-400 group-open:rotate-180 transition-transform chevron"></i>
          </summary>
          <div class="ml-8 mt-1 flex flex-col sub">
            <a class="px-3 py-2 rounded-lg hover:bg-slate-50 flex items-center gap-2" href="strategies.html"><i
                class="fa-solid fa-chart-line w-4 text-slate-500"></i><span class="label">OpenStrategies</span></a>
            <a class="px-3 py-2 rounded-lg hover:bg-slate-50 flex items-center gap-2" href="funds.html"><i
                class="fa-solid fa-coins w-4 text-slate-500"></i><span class="label">Funds</span></a>
          </div>
        </details>

        <a class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-slate-50" href="support.html"><i
            class="fa-solid fa-life-ring w-4 text-slate-500"></i><span class="label">Support</span></a>
        <a class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-slate-50 bg-slate-100" href="legal.html" aria-current="page"><i
            class="fa-solid fa-scale-balanced w-4 text-slate-500"></i><span class="label">Legal</span></a>
      </nav>

      <div class="p-3 border-t border-slate-200 footer flex items-center justify-between gap-2">
        <button id="ah-settings"
          class="btn btn-settings h-10 w-10 p-0 rounded-xl hover:bg-slate-100 border-slate-200" title="Settings" onclick="location.href='settings.html'">
          <i class="fa-solid fa-gear"></i>
        </button>

        <button id="ah-collapse"
          class="btn btn-collapse h-10 w-10 p-0 rounded-xl bg-slate-100 hover:bg-slate-200 border-0" title="Collapse">
          <i class="fa-solid fa-arrow-left"></i>
        </button>
      </div>
    </aside>

    <!-- ===== Main ===== -->
    <main class="flex-1 min-w-0">
      <!-- Top Header Bar -->
      <div class="flex items-center justify-between px-6 py-4 border-b border-slate-200 bg-white">
        <div class="flex items-center gap-3 flex-1 min-w-0 max-w-[460px]">
          <div class="relative w-full">
            <input class="input w-full pl-9" placeholder="Search" />
            <svg class="w-4 h-4 absolute left-3 top-1/2 -translate-y-1/2 text-slate-400" viewBox="0 0 24 24" fill="none"
              stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="11" cy="11" r="8" />
              <path d="m21 21-4.3-4.3" />
            </svg>
          </div>
        </div>

        <!-- Profile cluster -->
        <div class="flex items-center gap-3">
          <button
            class="relative h-10 w-10 rounded-full border border-slate-200 grid place-items-center hover:bg-slate-50"
            aria-label="Notifications">
            <i class="fa-regular fa-bell text-slate-500"></i>
            <span class="absolute -top-0.5 -right-0.5 h-2.5 w-2.5 rounded-full bg-orange-500 ring-2 ring-white"></span>
          </button>
          <img id="hdr-avatar"
            src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='36' height='36'><rect width='100%' height='100%' fill='%23f1f5f9'/></svg>"
            alt="Profile" class="w-9 h-9 rounded-full object-cover border border-slate-200" />
          <button id="hdr-profile-btn" class="flex items-center gap-2 text-slate-900 font-medium hover:text-slate-700">
            <span id="hdr-name">—</span>
            <i class="fa-solid fa-chevron-down text-slate-500 text-xs"></i>
          </button>
        </div>
      </div>

      <!-- ===== Legal Content ===== -->
      <section id="legal" class="px-6 py-8">
        <h1 class="text-2xl font-semibold text-slate-900">Policies and Legal Information</h1>
        <hr class="mt-6 mb-8 border-slate-200" />

        <div class="grid grid-cols-12 gap-8">
          <!-- Left: tabs -->
          <aside class="col-span-12 md:col-span-3">
            <nav id="legal-nav" class="space-y-1">
                <a href="https://aazofjsssobejhkyyiqv.supabase.co/storage/v1/object/public/AlgoHive/Legal%20Docs/AlgoHive%20Terms%20and%20Conditions.pdf" class="legal-link w-full block text-left px-4 py-2 rounded-lg text-slate-700 hover:bg-slate-50">Terms & Conditions</a>
                <a href="https://aazofjsssobejhkyyiqv.supabase.co/storage/v1/object/public/AlgoHive/Legal%20Docs/AlgoHive%20Privacy%20Policy.pdf" class="legal-link w-full block text-left px-4 py-2 rounded-lg text-slate-700 hover:bg-slate-50">Privacy Policy</a>
                <a href="https://aazofjsssobejhkyyiqv.supabase.co/storage/v1/object/public/AlgoHive/Legal%20Docs/AlgoHive%20Advertising%20Policy.pdf" class="legal-link w-full block text-left px-4 py-2 rounded-lg text-slate-700 hover:bg-slate-50">Advertising Policy</a>
                <a href="https://aazofjsssobejhkyyiqv.supabase.co/storage/v1/object/public/AlgoHive/Legal%20Docs/AlgoHive%20Risk%20Policy.pdf" class="legal-link w-full block text-left px-4 py-2 rounded-lg text-slate-700 hover:bg-slate-50">Risk Policy</a>
                <a href="https://aazofjsssobejhkyyiqv.supabase.co/storage/v1/object/public/AlgoHive/Legal%20Docs/AML%20&%20CTF.pdf" class="legal-link w-full block text-left px-4 py-2 rounded-lg text-slate-700 hover:bg-slate-50">Anti-Money Laundering & CTF</a>
            </nav>
          </aside>

          <!-- Right: iframe viewer -->
          <div class="col-span-12 md:col-span-9">
             <div class="card border border-slate-200 rounded-2xl p-1 h-[70vh]">
                <iframe id="legal-frame" name="legal-frame" class="w-full h-full border-0 rounded-xl"></iframe>
             </div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- ===== Profile Modal ===== -->
  <div id="profile-modal" class="fixed inset-0 z-[100] hidden">
    <div class="absolute inset-0 bg-black/40"></div>
    <div class="absolute right-6 top-20 w-64 rounded-2xl bg-white shadow-xl border border-slate-200 overflow-hidden">
      <div class="px-4 py-3 border-b border-slate-200">
        <div class="text-sm font-semibold text-slate-900">Account</div>
        <div id="pm-email" class="text-xs text-slate-500 truncate">—</div>
      </div>
      <div class="p-2">
        <a href="settings.html" id="pm-profile" class="w-full flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-slate-50">
          <i class="fa-regular fa-user text-slate-500 w-4"></i>
          <span>Profile settings</span>
        </a>
        <button id="pm-logout"
          class="w-full flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-slate-50 text-rose-700">
          <i class="fa-solid fa-right-from-bracket w-4"></i>
          <span>Log out</span>
        </button>
      </div>
    </div>
  </div>
  
  <script nonce="ALGOHIVE">
    // Sidebar collapse memory
    (function () {
      const layout = document.getElementById('layout');
      const aside = document.getElementById('ah-sidebar');
      const btn = document.getElementById('ah-collapse');
      const saved = localStorage.getItem('ah_collapsed') === 'true';
      if (saved) { aside.setAttribute('data-collapsed', 'true'); layout.classList.add('is-collapsed'); }
      btn?.addEventListener('click', () => {
        const isCollapsed = aside.getAttribute('data-collapsed') === 'true';
        if (!isCollapsed) aside.querySelectorAll('details[open]').forEach(d => d.removeAttribute('open'));
        aside.setAttribute('data-collapsed', String(!isCollapsed));
        layout.classList.toggle('is-collapsed', !isCollapsed);
        localStorage.setItem('ah_collapsed', String(!isCollapsed));
      });
    })();

    // Legal page iframe loader
    (function() {
        const links = document.querySelectorAll('.legal-link');
        const iframe = document.getElementById('legal-frame');

        if (!links.length || !iframe) return;

        function setActiveLink(clickedLink) {
            links.forEach(link => {
                link.classList.remove('link-active', 'font-semibold');
            });
            clickedLink.classList.add('link-active', 'font-semibold');
        }

        links.forEach(link => {
            link.addEventListener('click', function(event) {
                event.preventDefault();
                const url = this.getAttribute('href');
                iframe.src = url;
                setActiveLink(this);
            });
        });

        // Load the first link by default
        if (links.length > 0) {
            links[0].click();
        }
    })();
  </script>

  <script type="module" nonce="ALGOHIVE">
    import { supabase } from "/js/supabase.js";

    // ---------- toast banner ----------
    function banner(msg, tone = "warn") {
      let el = document.getElementById("banner");
      if (!el) {
        el = document.createElement("div");
        el.id = "banner";
        el.className = "fixed top-3 left-1/2 -translate-x-1/2 z-[200] px-4 py-2 rounded-lg shadow text-sm";
        document.body.appendChild(el);
      }
      el.className = "fixed top-3 left-1/2 -translate-x-1/2 z-[200] px-4 py-2 rounded-lg shadow text-sm";
      if (tone === "warn") el.classList.add("bg-amber-100", "text-amber-900");
      if (tone === "err") el.classList.add("bg-rose-100", "text-rose-900");
      if (tone === "ok") el.classList.add("bg-emerald-100", "text-emerald-900");
      el.textContent = msg;
      clearTimeout(el._t);
      el._t = setTimeout(() => el.remove(), 4000);
    }

     // ---------- profile helpers ----------
    async function ensureProfile(userId, email) {
      let { data, error } = await supabase.from("profiles").select("*").eq("id", userId).maybeSingle();
      if (error && error.code !== "PGRST116") throw error;
      if (data) return data;
      const up = await supabase.from("profiles").upsert({ id: userId, email, updated_at: new Date().toISOString() }, { onConflict: "id" }).select("*").single();
      if (up.error) throw up.error;
      return up.data;
    }

    // ---------- auth guard ----------
    const { data: { session } } = await supabase.auth.getSession();
    if (!session) {
      const next = encodeURIComponent(location.pathname + location.search + location.hash);
      location.replace(`/auth.html?tab=in&redirect=${next}`);
    }
    const { data: { user } } = await supabase.auth.getUser();

    // ---------- hydrate header ----------
    const row = await ensureProfile(user.id, user.email || null);
    
    // avatar + name
    const BLANK_AVATAR = "data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='64' height='64'><rect width='100%' height='100%' fill='%23f1f5f9'/></svg>";
    const hdrAvatar = document.getElementById("hdr-avatar");
    function setAvatarSrc(url) {
      const finalUrl = url ? (url + (url.includes("?") ? "&" : "?") + "v=" + Date.now()) : BLANK_AVATAR;
      if (hdrAvatar) hdrAvatar.src = finalUrl;
    }
    setAvatarSrc(row?.avatar_url);

    const fn = (row?.first_name || "").trim(), ln = (row?.last_name || "").trim();
    const fallback = user.email?.split("@")[0] || "User";
    document.getElementById("hdr-name").textContent = (fn || ln) ? `${fn} ${ln}`.trim() : fallback;


    // ---------- profile modal ----------
    const profileModal = document.getElementById("profile-modal");
    const hdrProfileBtn = document.getElementById("hdr-profile-btn");
    const pmEmail = document.getElementById("pm-email");
    const btnLogout = document.getElementById("pm-logout");
    function openProfileModal() { profileModal.classList.remove("hidden"); }
    function closeProfileModal() { profileModal.classList.add("hidden"); }
    hdrProfileBtn?.addEventListener("click", (e) => { e.preventDefault(); pmEmail.textContent = user?.email || "—"; openProfileModal(); });
    profileModal.addEventListener("click", (e) => { if (e.target === profileModal || e.target.classList.contains("bg-black/40")) closeProfileModal(); });
    window.addEventListener("keydown", (e) => { if (e.key === "Escape") closeProfileModal(); });
    btnLogout?.addEventListener("click", async () => { try { await supabase.auth.signOut(); location.replace("/auth.html?tab=in"); } catch { banner("Sorry, logout failed.", "err"); } });

  </script>

</body>
</html>

