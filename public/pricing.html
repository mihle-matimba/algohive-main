<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AlgoHive — Plans & Features</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />

  <style>
    :root{
      --page:#0b1220; --bg:#ffffff; --muted:#64748b; --ink:#0f172a;
      --olive:#7e8d52; --brand:#f59e0b; --line:#e2e8f0; --dark:#0f1629;
    }
    html,body{ font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif; background:var(--bg); color:var(--ink); height:100% }

    .btn{ display:inline-flex; align-items:center; justify-content:center; gap:.5rem; height:40px; padding:0 .875rem; border-radius:10px; border:1px solid var(--line); font-weight:600 }
    .btn-olive{ background:var(--olive); color:#fff; border:0 }
    .btn-olive:hover{ filter:brightness(.92) }
    .btn-olive:disabled{ opacity:.6; cursor:not-allowed }
    .input{ height:40px; border:1px solid var(--line); border-radius:10px; padding:0 .75rem }

    #layout{ --sb:220px; display:grid; grid-template-columns:var(--sb) 1fr; min-height:100vh }
    #layout.is-collapsed{ --sb:64px }
    #ah-sidebar{ transition:width .2s ease; width:var(--sb) }
    #ah-sidebar[data-collapsed="true"] .label, #ah-sidebar[data-collapsed="true"] .chevron{ display:none }
    #ah-sidebar[data-collapsed="true"] details>.sub{ display:none !important }
    #ah-sidebar[data-collapsed="true"] nav a, #ah-sidebar[data-collapsed="true"] details>summary{ justify-content:center; gap:.25rem }
    #ah-sidebar .footer{ transition:all .2s ease }
    #ah-sidebar[data-collapsed="true"] .footer{ justify-content:center; flex-direction:column; gap:12px }
    .btn-collapse :is(svg,i){ transition:transform .25s ease }
    #ah-sidebar[data-collapsed="true"] .btn-collapse :is(svg,i){ transform:rotate(180deg) }

    /* Active styles */
    .btn-active{ background:#f1f5f9 !important; color:var(--olive) !important; border:1px solid var(--olive) !important }
    .nav-active{ background:#f1f5f9; color:var(--olive); border:1px solid var(--olive) }

    /* Pricing helpers */
    .toggle .btn{ height:auto; padding:.375rem .75rem; border-radius:999px; font-weight:600; border:0 }
    .plan-card{ border:1px solid var(--line); border-radius:16px; background:#fff }
    .plan-card.dark{ background:var(--dark); color:#fff; border-color:#0b1220 }
    .plan-price{ font-size:44px; line-height:1; font-weight:800; letter-spacing:-.02em }
    .badge{ font-size:12px; padding:.125rem .5rem; border-radius:999px }
    .badge-pop{ background:#c7f28c; color:#0f1a07 }
    .check{ color:#16a34a }

    /* Disabled link look when gated */
    .link-disabled{ opacity:.5; pointer-events:none }
  </style>
</head>

<body class="min-h-screen overflow-x-hidden">
  <div id="layout">
    <!-- ===== Sidebar ===== -->
    <aside id="ah-sidebar" data-collapsed="false" class="border-r border-slate-200 h-[100vh] sticky top-0 bg-white flex flex-col overflow-hidden">
      <div class="px-4 py-4 flex items-center gap-3 border-b border-slate-200">
        <img src="https://static.wixstatic.com/media/ac771e_af06d86a7a1f4abd87e52e45f3bcbd96~mv2.png" alt="AlgoHive Logo" class="w-10 h-10 object-contain" />
        <div class="min-w-0">
          <div class="font-bold text-[15px] text-slate-900 label">AlgoHive</div>
          <div class="text-[11px] text-slate-500 label">ID: <span id="sidebar-acc">—</span></div>
        </div>
      </div>

      <nav id="main-nav" class="p-2 text-[14px] flex-1 overflow-y-auto">
        <a class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-slate-50 font-medium text-slate-900" href="/home.html" title="Home">
          <i class="fa-solid fa-house text-slate-500 w-4 shrink-0"></i><span class="label">Home</span>
        </a>

        <details class="group mt-1">
          <summary class="flex items-center justify-between px-3 py-2 rounded-lg hover:bg-slate-50 cursor-pointer font-medium text-slate-900">
            <span class="flex items-center gap-3">
              <i class="fa-regular fa-user w-4 text-slate-500"></i><span class="label">Portfolio</span>
            </span>
            <i class="fa-solid fa-chevron-down text-slate-400 group-open:rotate-180 transition-transform chevron"></i>
          </summary>
          <div class="ml-8 mt-1 flex flex-col sub">
            <a class="px-3 py-2 rounded-lg hover:bg-slate-50 flex items-center gap-2" href="#"><i class="fa-solid fa-chart-pie w-4 text-slate-500"></i><span class="label">Positions</span></a>
            <a class="px-3 py-2 rounded-lg hover:bg-slate-50 flex items-center gap-2" href="#"><i class="fa-regular fa-clipboard w-4 text-slate-500"></i><span class="label">Orders</span></a>
            <a class="px-3 py-2 rounded-lg hover:bg-slate-50 flex items-center gap-2" href="#"><i class="fa-solid fa-bars w-4 text-slate-500"></i><span class="label">Activity</span></a>
            <a class="px-3 py-2 rounded-lg hover:bg-slate-50 flex items-center gap-2" href="#"><i class="fa-solid fa-table w-4 text-slate-500"></i><span class="label">Balances</span></a>
            <a class="px-3 py-2 rounded-lg hover:bg-slate-50 flex items-center gap-2" href="#"><i class="fa-solid fa-hand-holding-dollar w-4 text-slate-500"></i><span class="label">Funding</span></a>
          </div>
        </details>

        <details class="group mt-1">
          <summary class="flex items-center justify-between px-3 py-2 rounded-lg hover:bg-slate-50 cursor-pointer font-medium text-slate-900">
            <span class="flex items-center gap-3">
              <i class="fa-solid fa-link w-4 text-slate-500"></i><span class="label">Invest</span>
            </span>
            <i class="fa-solid fa-chevron-down text-slate-400 group-open:rotate-180 transition-transform chevron"></i>
          </summary>
          <div class="ml-8 mt-1 flex flex-col sub">
            <a class="px-3 py-2 rounded-lg hover:bg-slate-50 flex items-center gap-2" href="#"><i class="fa-solid fa-chart-line w-4 text-slate-500"></i><span class="label">OpenStrategies</span></a>
            <a class="px-3 py-2 rounded-lg hover:bg-slate-50 flex items-center gap-2" href="#"><i class="fa-solid fa-coins w-4 text-slate-500"></i><span class="label">Funds</span></a>
          </div>
        </details>

        <!-- ACTIVE PAGE -->
        <a class="flex items-center gap-3 px-3 py-2 rounded-lg nav-active font-medium" href="#" aria-current="page">
          <i class="fa-regular fa-square-check w-4"></i><span class="label">Plans & Features</span>
        </a>

        <a class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-slate-50" href="#"><i class="fa-regular fa-comments w-4 text-slate-500"></i><span class="label">Community</span></a>
        <a class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-slate-50" href="#"><i class="fa-solid fa-life-ring w-4 text-slate-500"></i><span class="label">Support</span></a>
        <a class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-slate-50" href="/settings.html"><i class="fa-solid fa-gear w-4 text-slate-500"></i><span class="label">Settings</span></a>
        <a class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-slate-50" href="#"><i class="fa-solid fa-scale-balanced w-4 text-slate-500"></i><span class="label">Legal</span></a>
      </nav>

      <div class="p-3 border-t border-slate-200 footer flex items-center justify-between gap-2">
        <!-- keep gear “active” look OFF on this page -->
        <button id="ah-settings" class="btn h-10 w-10 p-0 rounded-xl border-0" title="Settings">
          <i class="fa-solid fa-gear"></i>
        </button>
        <button id="ah-collapse" class="btn btn-collapse h-10 w-10 p-0 rounded-xl bg-slate-100 hover:bg-slate-200 border-0" title="Collapse">
          <i class="fa-solid fa-arrow-left"></i>
        </button>
      </div>
    </aside>

    <!-- ===== Main ===== -->
    <main class="flex-1 min-w-0">
      <!-- Top Header Bar -->
      <div class="flex items-center justify-between px-6 py-4 border-b border-slate-200 bg-white">
        <div class="flex items-center gap-3 flex-1 min-w-0 max-w-[460px]">
          <div class="relative w-full">
            <input class="input w-full pl-9" placeholder="Search" />
            <svg class="w-4 h-4 absolute left-3 top-1/2 -translate-y-1/2 text-slate-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="11" cy="11" r="8" /><path d="m21 21-4.3-4.3" />
            </svg>
          </div>
        </div>

        <!-- Profile cluster -->
        <div class="flex items-center gap-3">
          <button class="relative h-10 w-10 rounded-full border border-slate-200 grid place-items-center hover:bg-slate-50" aria-label="Notifications">
            <i class="fa-regular fa-bell text-slate-500"></i>
            <span class="absolute -top-0.5 -right-0.5 h-2.5 w-2.5 rounded-full bg-orange-500 ring-2 ring-white"></span>
          </button>
          <img id="hdr-avatar" src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='36' height='36'><rect width='100%' height='100%' fill='%23f1f5f9'/></svg>" alt="Profile" class="w-9 h-9 rounded-full object-cover border border-slate-200" />
          <button id="hdr-profile-btn" class="flex items-center gap-2 text-slate-900 font-medium hover:text-slate-700">
            <span id="hdr-name">—</span>
            <i class="fa-solid fa-chevron-down text-slate-500 text-xs"></i>
          </button>
        </div>
      </div>

      <!-- ===== Pricing ===== -->
      <section id="pricing" class="px-6 py-10">
        <div class="flex items-center justify-between flex-wrap gap-3">
          <div>
            <h1 class="text-2xl font-semibold">Choose your plan</h1>
            <p class="text-sm text-slate-500">Simple monthly pricing. Switch to annual for savings.</p>
          </div>

          <!-- Toggle -->
          <div class="toggle inline-flex items-center gap-2 bg-slate-100 rounded-full p-1">
            <button id="btn-monthly" class="btn bg-white" aria-pressed="true">Monthly billing</button>
            <button id="btn-annual" class="btn">Annual billing</button>
          </div>
        </div>

        <!-- Cards -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-8">
          <!-- Basic -->
          <div class="plan-card p-6">
            <h3 class="text-lg font-semibold">Basic plan</h3>
            <div class="mt-2 flex items-end gap-2">
              <div class="plan-price" id="basic-price">$10</div>
              <div class="text-sm text-slate-500">per user / mo</div>
            </div>

            <div class="mt-5 grid gap-3">
              <button class="btn-olive rounded-xl h-11">Get started</button>
              <button class="btn h-11">Chat to sales</button>
            </div>

            <div class="mt-6 text-xs font-semibold text-slate-500 tracking-wide">FEATURES</div>
            <ul class="mt-3 space-y-2 text-[15px]">
              <li class="flex items-start gap-2"><i class="fa-solid fa-check mt-1 check"></i> Access to basic features</li>
              <li class="flex items-start gap-2"><i class="fa-solid fa-check mt-1 check"></i> Basic reporting & analytics</li>
              <li class="flex items-start gap-2"><i class="fa-solid fa-check mt-1 check"></i> Up to 10 individual users</li>
              <li class="flex items-start gap-2"><i class="fa-solid fa-check mt-1 check"></i> 20GB individual data each user</li>
              <li class="flex items-start gap-2"><i class="fa-solid fa-check mt-1 check"></i> Basic chat & email support</li>
            </ul>
          </div>

          <!-- Business (Popular) -->
          <div class="plan-card dark p-6 relative">
            <div class="absolute right-4 top-4 badge badge-pop">Popular</div>
            <h3 class="text-lg font-semibold">Business plan</h3>
            <div class="mt-2 flex items-end gap-2">
              <div class="plan-price" id="biz-price">$20</div>
              <div class="text-sm opacity-70">per user / mo</div>
            </div>

            <div class="mt-5 grid gap-3">
              <button class="btn-olive rounded-xl h-11">Get started</button>
              <button class="btn h-11 bg-white/10 border-white/20 text-white hover:bg-white/20">Chat to sales</button>
            </div>

            <div class="mt-6 text-xs font-semibold opacity-70 tracking-wide">FEATURES</div>
            <ul class="mt-3 space-y-2 text-[15px]">
              <li class="flex items-start gap-2"><i class="fa-solid fa-check mt-1 text-emerald-400"></i> 200+ integrations</li>
              <li class="flex items-start gap-2"><i class="fa-solid fa-check mt-1 text-emerald-400"></i> Advanced reporting & analytics</li>
              <li class="flex items-start gap-2"><i class="fa-solid fa-check mt-1 text-emerald-400"></i> Up to 20 individual users</li>
              <li class="flex items-start gap-2"><i class="fa-solid fa-check mt-1 text-emerald-400"></i> 40GB individual data each user</li>
              <li class="flex items-start gap-2"><i class="fa-solid fa-check mt-1 text-emerald-400"></i> Priority chat & email support</li>
            </ul>
          </div>

          <!-- Enterprise -->
          <div class="plan-card p-6">
            <h3 class="text-lg font-semibold">Enterprise plan</h3>
            <div class="mt-2 flex items-end gap-2">
              <div class="plan-price" id="ent-price">$40</div>
              <div class="text-sm text-slate-500">per user / mo</div>
            </div>

            <div class="mt-5 grid gap-3">
              <button class="btn-olive rounded-xl h-11">Get started</button>
              <button class="btn h-11">Chat to sales</button>
            </div>

            <div class="mt-6 text-xs font-semibold text-slate-500 tracking-wide">FEATURES</div>
            <ul class="mt-3 space-y-2 text-[15px]">
              <li class="flex items-start gap-2"><i class="fa-solid fa-check mt-1 check"></i> Advanced custom fields</li>
              <li class="flex items-start gap-2"><i class="fa-solid fa-check mt-1 check"></i> Audit log & data history</li>
              <li class="flex items-start gap-2"><i class="fa-solid fa-check mt-1 check"></i> Unlimited individual users</li>
              <li class="flex items-start gap-2"><i class="fa-solid fa-check mt-1 check"></i> Unlimited individual data</li>
              <li class="flex items-start gap-2"><i class="fa-solid fa-check mt-1 check"></i> Personalised + priority service</li>
            </ul>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- ===== Profile Modal ===== -->
  <div id="profile-modal" class="fixed inset-0 z-[100] hidden">
    <div class="absolute inset-0 bg-black/40"></div>
    <div class="absolute right-6 top-20 w-64 rounded-2xl bg-white shadow-xl border border-slate-200 overflow-hidden">
      <div class="px-4 py-3 border-b border-slate-200">
        <div class="text-sm font-semibold text-slate-900">Account</div>
        <div id="pm-email" class="text-xs text-slate-500 truncate">—</div>
      </div>
      <div class="p-2">
        <a href="/settings.html#basic" id="pm-profile" class="w-full flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-slate-50">
          <i class="fa-regular fa-user text-slate-500 w-4"></i>
          <span>Profile settings</span>
        </a>
        <button id="pm-logout" class="w-full flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-slate-50 text-rose-700">
          <i class="fa-solid fa-right-from-bracket w-4"></i>
          <span>Log out</span>
        </button>
      </div>
    </div>
  </div>

  <!-- ===== Behavior (collapse + pricing toggle) ===== -->
  <script>
    // Sidebar collapse memory
    (function () {
      const layout = document.getElementById('layout');
      const aside = document.getElementById('ah-sidebar');
      const btn = document.getElementById('ah-collapse');
      const saved = localStorage.getItem('ah_collapsed') === 'true';
      if (saved) { aside.setAttribute('data-collapsed', 'true'); layout.classList.add('is-collapsed'); }
      btn?.addEventListener('click', () => {
        const isCollapsed = aside.getAttribute('data-collapsed') === 'true';
        if (!isCollapsed) aside.querySelectorAll('details[open]').forEach(d => d.removeAttribute('open'));
        aside.setAttribute('data-collapsed', String(!isCollapsed));
        layout.classList.toggle('is-collapsed', !isCollapsed);
        localStorage.setItem('ah_collapsed', String(!isCollapsed));
      });
    })();

    // Monthly/Annual toggle (simple example: ~20% off annual)
    (function () {
      const btnM = document.getElementById('btn-monthly');
      const btnA = document.getElementById('btn-annual');
      const basic = document.getElementById('basic-price');
      const biz = document.getElementById('biz-price');
      const ent = document.getElementById('ent-price');

      function setMode(mode){
        const annual = mode === 'annual';
        btnM.setAttribute('aria-pressed', String(!annual));
        btnA.setAttribute('aria-pressed', String(annual));
        btnM.classList.toggle('bg-white', !annual);
        btnA.classList.toggle('bg-white', annual);
        basic.textContent = annual ? '$8'  : '$10';
        biz.textContent   = annual ? '$16' : '$20';
        ent.textContent   = annual ? '$32' : '$40';
      }
      btnM?.addEventListener('click', () => setMode('monthly'));
      btnA?.addEventListener('click', () => setMode('annual'));
      setMode('monthly');
    })();

    // Simple banner helper
    function banner(msg, tone = "warn") {
      let el = document.getElementById("banner");
      if (!el) {
        el = document.createElement("div");
        el.id = "banner";
        el.className = "fixed top-3 left-1/2 -translate-x-1/2 z-[200] px-4 py-2 rounded-lg shadow text-sm";
        document.body.appendChild(el);
      }
      el.className = "fixed top-3 left-1/2 -translate-x-1/2 z-[200] px-4 py-2 rounded-lg shadow text-sm";
      if (tone === "warn") { el.classList.add("bg-amber-100","text-amber-900"); }
      if (tone === "err")  { el.classList.add("bg-rose-100","text-rose-900"); }
      if (tone === "ok")   { el.classList.add("bg-emerald-100","text-emerald-900"); }
      el.textContent = msg;
      clearTimeout(el._t); el._t = setTimeout(() => el.remove(), 4000);
    }
  </script>

  <!-- ===== Supabase + dynamic profile / gating ===== -->
  <script type="module">
    import { supabase } from "/js/supabase.js";

    // --- Auth guard ---
    const { data:{ session } } = await supabase.auth.getSession();
    if (!session) {
      const next = encodeURIComponent(location.pathname + location.search + location.hash);
      location.replace(`/auth.html?tab=in&redirect=${next}`);
    }
    const { data:{ user } } = await supabase.auth.getUser();

    // --- Ensure profile row exists ---
    async function ensureProfile(userId, email) {
      let { data, error } = await supabase.from("profiles").select("*").eq("id", userId).maybeSingle();
      if (error && error.code !== "PGRST116") throw error;
      if (data) return data;
      const payload = { id: userId, email, updated_at: new Date().toISOString() };
      const up = await supabase.from("profiles").upsert(payload, { onConflict:"id" }).select("*").single();
      if (up.error) throw up.error;
      return up.data;
    }
    const row = await ensureProfile(user.id, user.email || null);

    // --- Hydrate header + sidebar bits ---
    const acct = row?.account_number || "949915944";
    document.getElementById("sidebar-acc").textContent = acct;

    const blankAvatar = "data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='64' height='64'><rect width='100%' height='100%' fill='%23f1f5f9'/></svg>";
    const avatarUrl = row?.avatar_url || blankAvatar;
    const hdrAvatar = document.getElementById("hdr-avatar");
    if (hdrAvatar) hdrAvatar.src = avatarUrl;

    const fn = (row?.first_name || "").trim(), ln = (row?.last_name || "").trim();
    const fallback = (user.email || "").split("@")[0] || "User";
    document.getElementById("hdr-name").textContent = (fn || ln) ? `${fn} ${ln}`.trim() : fallback;

    // --- Profile modal ---
    const hdrProfileBtn = document.getElementById("hdr-profile-btn");
    const modal = document.getElementById("profile-modal");
    const pmEmail = document.getElementById("pm-email");
    const btnLogout = document.getElementById("pm-logout");
    function openModal(){ modal.classList.remove("hidden") }
    function closeModal(){ modal.classList.add("hidden") }
    hdrProfileBtn?.addEventListener("click",(e)=>{ e.preventDefault(); pmEmail.textContent = user?.email || "—"; openModal(); });
    modal.addEventListener("click",(e)=>{ if(e.target === modal || e.target.classList.contains("bg-black/40")) closeModal(); });
    window.addEventListener("keydown",(e)=>{ if(e.key === "Escape") closeModal(); });
    btnLogout?.addEventListener("click", async () => {
      try { await supabase.auth.signOut(); location.replace("/auth.html?tab=in"); }
      catch { banner("Sorry, logout failed.","err"); }
    });

    // --- Gating (profile + kyc) ---
    const REQUIRED = ["first_name","last_name","phone","dob","id_number","nationality","country_residence"];
    function computeProfileComplete(r){ return REQUIRED.every(k => String(r?.[k] ?? "").trim().length > 0); }
    function resolveKycBoolean(r){
      const v = r?.kyc_status;
      if (typeof v === "boolean") return v;
      if (typeof v === "string") return ["verified","approved","done","passed","kyc_done"].includes(v.toLowerCase());
      return false;
    }
    let profileComplete = computeProfileComplete(row);
    let kycDone = resolveKycBoolean(row);

    function isGated(){ return !(profileComplete && kycDone); }
    function gateReason(){
      if (!profileComplete && !kycDone) return "Please finish Additional Info and complete KYC first.";
      if (!profileComplete) return "Please finish Additional Info first.";
      if (!kycDone) return "Please complete KYC first.";
      return "";
    }

    // Lock main nav (but keep current page usable)
    (function lockMainNav(){
      const mainNav = document.getElementById("main-nav");
      if (!mainNav) return;
      function preventNav(e){
        e.preventDefault();
        banner(gateReason(),"warn");
        const target = !profileComplete ? "/settings.html#extra" : "/settings.html#kyc";
        location.href = target;
      }
      mainNav.querySelectorAll('a[href]').forEach(a=>{
        const href = (a.getAttribute("href")||"").trim();
        const isCurrent = a.matches('.nav-active') || href === "#" || href === "";
        if (isGated() && !isCurrent) {
          a.classList.add("link-disabled");
          a.setAttribute("aria-disabled","true");
          a.title = "Locked until profile + KYC are complete";
          a.addEventListener("click", preventNav, { passive:false });
        }
      });
    })();
  </script>
</body>
</html>
