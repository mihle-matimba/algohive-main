<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AlgoHive | The Future of Algorithmic Investing</title> 
  
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet"> 
  
  <link rel="apple-touch-icon" href="/favicon.png">
  <link rel="icon" href="/favicon.png" sizes="any">

  <style>
    :root {
      --primary: #0A6847; /* Deep, premium green */
      --primary-light: #F7FBF9; /* Very light green background */
      --primary-accent: #16A34A; /* Brighter green for charts/highlights */
      --ink: #1D1D1F; /* Apple's primary text color */
      --ink-secondary: #525A67; /* Softer text color */
      --bg: #FFFFFF;
      --bg-offwhite: #F5F5F7; /* Apple's light background */
      --line: #E5E7EB; /* Standard border color */
      --radius-sm: 0.5rem; /* 8px */
      --radius-md: 1rem; /* 16px */
      --radius-lg: 1.5rem; /* 24px */
    }

    /* 1. Base Setup */
    html, body { 
      font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, sans-serif;
      background: var(--bg); 
      color: var(--ink);
      width: 100%;
      overflow-x: hidden;
      scroll-behavior: smooth;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    /* 2. Re-usable Components */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 0.9rem;
      padding: 0.75rem 1.5rem; /* 12px 24px */
      border-radius: var(--radius-md);
      transition: all 0.2s ease;
      cursor: pointer;
      transform: perspective(1px) translateZ(0);
      position: relative;
      overflow: hidden;
      border: 1px solid transparent;
    }
    .btn-primary {
      background: var(--primary);
      color: white;
    }
    .btn-primary:hover {
      background: #085239; /* Darker green */
    }
    .btn-secondary {
      background: var(--bg-offwhite);
      color: var(--ink);
      border-color: var(--line);
    }
    .btn-secondary:hover {
      background: #E8E8ED;
      border-color: #D1D1D6;
    }
    
    .glass-card {
      position: relative;
      background: rgba(255, 255, 255, 0.6);
      border: 1px solid rgba(255, 255, 255, 0.4);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border-radius: var(--radius-lg);
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    }

    .filter-tag {
      padding: 0.5rem 1rem;
      border-radius: var(--radius-sm);
      font-size: 0.875rem;
      font-weight: 500;
      color: var(--ink-secondary);
      background: white;
      border: 1px solid var(--line);
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .filter-tag:hover {
      background: var(--bg-offwhite);
      border-color: #D1D1D6;
    }
    .filter-tag.active {
      background: var(--primary);
      color: white;
      border-color: var(--primary);
    }

    /* 3. Performance Summary Box Styles */
    .ps-tile {
        border: 1px solid var(--line);
        border-radius: var(--radius-md);
        padding: 1rem; /* 16px */
        background: #fff
    }
    .ps-label {
        color: var(--ink-secondary);
        font-weight: 500;
        font-size: .85rem
    }
    .ps-value {
        font-weight: 600;
        font-size: 1.125rem; /* 18px */
        margin-top: 4px;
        color: var(--ink);
        transition: color 0.2s;
    }
    
    /* 4. Scroll Animations */
    [data-animate] {
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 0.6s ease-out, transform 0.6s ease-out;
    }
    [data-animate].is-visible {
      opacity: 1;
      transform: translateY(0);
    }
    
  </style>
</head>
<body class="antialiased">

  <header class="w-full sticky top-0 z-50 bg-white/80 backdrop-blur-lg border-b border-white/30 shadow-sm">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
      <nav class="flex items-center justify-between h-16">
        <a href="index.html" class="flex items-center gap-2">
          <img src="https://static.wixstatic.com/media/ac771e_af06d86a7a1f4abd87e52e45f3bcbd96~mv2.png" alt="AlgoHive logo" class="h-8 w-auto">
          <span class="text-lg font-semibold tracking-tight text-[var(--ink)]">AlgoHive</span>
        </a>

        <div class="hidden md:flex items-center gap-2">
          <a href="who-we-are.html" class="px-3 py-2 rounded-lg text-sm font-medium text-[var(--ink-secondary)] hover:text-[var(--ink)] hover:bg-black/5">Who We Are</a>
          <a href="how-we-work.html" class="px-3 py-2 rounded-lg text-sm font-medium text-[var(--ink-secondary)] hover:text-[var(--ink)] hover:bg-black/5">How We Work</a>
          <a href="#pricing" class="px-3 py-2 rounded-lg text-sm font-medium text-[var(--ink-secondary)] hover:text-[var(--ink)] hover:bg-black/5">Pricing</a>
          <a href="#faqs" class="px-3 py-2 rounded-lg text-sm font-medium text-[var(--ink-secondary)] hover:text-[var(--ink)] hover:bg-black/5">FAQs</a>
        </div>

        <div class="flex items-center gap-3">
          <a href="/auth.html?redirect=/home.html" class="btn btn-primary !py-2 !px-5 !text-sm">Login</a>
          <button id="hamburger-button" class="md:hidden p-2 rounded-lg hover:bg-black/5">
            <svg class="w-6 h-6 text-[var(--ink)]" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
          </button>
        </div>
      </nav>
    </div>
    <div id="mobile-menu" class="hidden md:hidden absolute top-full left-0 w-full bg-white shadow-lg border-t border-[var(--line)]">
      <div class="flex flex-col p-4 gap-2">
        <a href="who-we-are.html" class="block px-4 py-3 rounded-lg text-base font-medium text-[var(--ink)] hover:bg-black/5">Who We Are</a>
        <a href="how-we-work.html" class="block px-4 py-3 rounded-lg text-base font-medium text-[var(--ink)] hover:bg-black/5">How We Work</a>
        <a href="#pricing" class="block px-4 py-3 rounded-lg text-base font-medium text-[var(--ink)] hover:bg-black/5">Pricing</a>
        <a href="#faqs" class="block px-4 py-3 rounded-lg text-base font-medium text-[var(--ink)] hover:bg-black/5">FAQs</a>
      </div>
    </div>
  </header>

  <section class="relative overflow-hidden">
    <div class="absolute inset-x-0 -top-40 -z-10 transform-gpu overflow-hidden blur-3xl sm:-top-80" aria-hidden="true">
      <div class="relative left-[calc(50%-11rem)] aspect-[1155/678] w-[36.125rem] -translate-x-1/2 rotate-[30deg] bg-gradient-to-tr from-[var(--primary-accent)] to-[var(--primary)] opacity-10 sm:left-[calc(50%-30rem)] sm:w-[72.1875rem]" style="clip-path: polygon(74.1% 44.1%, 100% 61.6%, 97.5% 26.9%, 85.5% 0.1%, 80.7% 2%, 72.5% 32.5%, 60.2% 62.4%, 52.4% 68.1%, 47.5% 58.3%, 45.2% 34.5%, 27.5% 76.7%, 0.1% 64.9%, 17.9% 100%, 27.6% 76.8%, 76.1% 97.7%, 74.1% 44.1%)"></div>
    </div>
    
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 pt-24 pb-16 sm:pt-32 sm:pb-24">
      <div class="grid grid-cols-1 lg:grid-cols-12 gap-12 lg:gap-16 items-center">
        <div class="lg:col-span-6 text-center lg:text-left" data-animate>
          <span class="inline-flex items-center gap-2 rounded-full bg-[var(--primary-light)] px-4 py-1 text-sm font-medium text-[var(--primary)] border border-green-200/50">
            Beta Now Live
          </span>
          <h1 class="mt-6 text-5xl md:text-6xl lg:text-7xl font-extrabold tracking-tighter text-[var(--ink)]">
            Where Strategy
            <br />
            Meets <span class="text-[var(--primary)]">Capital.</span>
          </h1>
          <p class="mt-6 text-lg md:text-xl text-[var(--ink-secondary)] max-w-lg mx-auto lg:mx-0">
            Access institutional-grade algorithmic strategies. Built for performance, not fees.
          </p>
          <div class="mt-10 flex flex-wrap items-center justify-center lg:justify-start gap-4">
            <a href="/auth.html?redirect=/home.html" class="btn btn-primary">
              Get Started
            </a>
            <a href="#strategies" class="btn btn-secondary">
              Explore Strategies
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-4 h-4 ml-2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5 21 12l-7.5 7.5M21 12H3" />
              </svg>
            </a>
          </div>
        </div>

        <div class="lg:col-span-6" data-animate style="transition-delay: 150ms;">
          <div class="relative rounded-3xl overflow-hidden shadow-2xl shadow-black/10">
            <img src="https://static.wixstatic.com/media/ac771e_4647dc50bd7e4ab79b46054e1dc3c5d8~mv2.png" alt="Investor Dashboard" class="h-auto w-full object-cover"/>
            
            <div class="absolute bottom-4 left-4 right-4 grid grid-cols-3 gap-3">
              <div class="glass-card p-3">
                <p class="text-xs font-medium text-[var(--ink-secondary)]">Avg. Return (QTR)</p>
                <p class="text-lg font-bold text-[var(--ink)]">13%</p>
              </div>
              <div class="glass-card p-3">
                <p class="text-xs font-medium text-[var(--ink-secondary)]">Total Strategies</p>
                <p class="text-lg font-bold text-[var(--ink)]">25</p>
              </div>
              <div class="glass-card p-3 !bg-[var(--primary)] !text-white">
                <p class="text-xs font-medium text-white/80">Launch Countdown</p>
                <p class="text-base font-semibold tracking-tighter">
                  <span id="cdDays">--</span>d
                  <span id="cdHrs">--</span>h
                  <span id="cdMins">--</span>m
                  <span id="cdSecs">--</span>s
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section class="py-4 border-y border-[var(--line)]">
    <div class="tradingview-widget-container tv-ticker">
      <div class="tradingview-widget-container__widget"></div>
      <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-ticker-tape.js" async>
      {
        "symbols": [
          { "proName": "FOREXCOM:SPXUSD", "title": "S&P 500" },
          { "proName": "FOREXCOM:NSXUSD", "title": "US 100" },
          { "proName": "FX_IDC:EURUSD",   "title": "EUR/USD" },
          { "proName": "BITSTAMP:BTCUSD", "title": "Bitcoin" },
          { "proName": "BITSTAMP:ETHUSD", "title": "Ethereum" }
        ],
        "colorTheme": "light",
        "isTransparent": true,
        "displayMode": "adaptive",
        "showSymbolLogo": true,
        "locale": "en"
      }
      </script>
    </div>
  </section>
  
  <section id="strategies" class="py-20 lg:py-24 bg-[var(--bg-offwhite)]">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
      
      <div class="max-w-3xl mx-auto text-center" data-animate>
        <h2 class="text-4xl lg:text-5xl font-extrabold tracking-tighter text-[var(--ink)]">
          Find Your Edge.
        </h2>
        <p class="mt-4 text-lg text-[var(--ink-secondary)]">
          Browse strategies by asset class, risk profile, and performance. All data is live and transparent.
        </p>
      </div>
      
      <div id="strategyBar" class="mt-12 flex flex-col md:flex-row items-center gap-4" data-animate>
          <div class="text-sm font-semibold text-[var(--ink)]">Filters:</div>
          <div id="assetFilters" class="flex flex-wrap items-center gap-2">
              </div>

          <div class="ml-0 md:ml-auto flex items-center gap-2">
              <button class="filter-tag prd active" data-period="6M">6M</button>
              <button class="filter-tag prd" data-period="1Y">1Y</button>
              <button class="filter-tag prd" data-period="ALL">All</button>
          </div>
      </div>

      <div class="relative mt-10" data-animate>
          <article id="leftCard" class="swap-in rounded-3xl bg-white p-6 md:p-8 shadow-xl shadow-black/5 border border-[var(--line)]">
              <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-3 mb-6">
                  <div class="min-w-0">
                      <div class="flex items-center gap-2 text-xs text-[var(--ink-secondary)]">
                          <span id="period">All time</span>
                      </div>
                      <h3 id="stratName" class="text-3xl lg:text-4xl font-bold tracking-tight truncate text-[var(--primary)]">—</h3>
                      <div class="flex flex-wrap items-center gap-x-3 gap-y-1 mt-2 text-sm text-[var(--ink-secondary)]">
                          <span id="provider">—</span>
                          <span>•</span>
                          <span id="since">Live since —</span>
                          <span>•</span>
                          <span id="currency">USD</span>
                          <span class="inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium" id="risk">Risk —</span>
                          <span class="hidden" id="aum">AUM —</span>
                      </div>
                  </div>
                  <div class="flex items-center gap-3 text-sm font-medium">
                      <span class="inline-flex items-center gap-2"><span class="inline-block h-2.5 w-2.5 rounded-full" style="background:#556B2F"></span> Portfolio</span>
                  </div>
              </div>

              <div class="grid grid-cols-1 lg:grid-cols-12 gap-6 lg:gap-8">
                  <div class="lg:col-span-8 xl:col-span-9">
                      <div class="flex items-baseline justify-between gap-3 mb-3">
                          <div class="flex items-baseline gap-2">
                              <div class="text-3xl font-bold" id="eqValue">—</div>
                              <span id="eqDelta" class="text-lg font-medium">+0.0%</span>
                          </div>
                          <div class="text-xs text-[var(--ink-secondary)]">* return vs period start</div>
                      </div>

                      <div class="relative w-full h-[320px] overflow-hidden rounded-2xl border border-[var(--line)] bg-white">
                          <canvas id="equityChartCanvas" class="max-w-full"></canvas>
                      </div>
                  </div>

                  <div class="lg:col-span-4 xl:col-span-3">
                      <div id="eqMetrics" class="grid grid-cols-2 gap-3 text-sm">
                          <div class="ps-tile">
                              <div class="ps-label">Best Day</div>
                              <div id="mBestDay" class="ps-value">—</div>
                          </div>
                          <div class="ps-tile">
                              <div class="ps-label">Worst Day</div>
                              <div id="mWorstDay" class="ps-value">—</div>
                          </div>
                          <div class="ps-tile">
                              <div class="ps-label">Avg Daily Return</div>
                              <div id="mAvgDaily" class="ps-value">—</div>
                          </div>
                          <div class="ps-tile">
                              <div class="ps-label">Positive Days</div>
                              <div id="mPosDays" class="ps-value">—</div>
                          </div>
                          <div class="ps-tile">
                              <div class="ps-label">Trading Days</div>
                              <div id="mTradingDays" class="ps-value">—</div>
                          </div>
                          <div class="ps-tile">
                              <div class="ps-label">YTD</div>
                              <div id="mYTD" class="ps-value">—</div>
                          </div>
                      </div>
                      <p id="stratDesc" class="mt-4 text-sm leading-6 text-[var(--ink-secondary)]">—</p>
                  </div>
              </div>
          </article>
      </div>

      <p class="mt-8 text-center text-xs text-black/50" data-animate>
          Strategy stats are illustrative. Performance isn’t guaranteed. Fees apply to returns, not AUM.
      </p>
    </div>
  </section>

  <section id="lending" class="py-20 lg:py-24 bg-white">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 lg:gap-16 items-center">
        <div class="p-6 md:p-8 rounded-3xl bg-[var(--bg-offwhite)] border border-[var(--line)]" data-animate>
          <h3 class="text-2xl font-bold text-[var(--ink)]">Estimate your borrowing power</h3>
          
          <div class="mt-6 grid grid-cols-1 sm:grid-cols-2 gap-4">
            <label class="block">
              <span class="text-sm font-medium text-[var(--ink-secondary)]">Portfolio value (ZAR)</span>
              <div class="mt-1 flex items-center gap-2 rounded-xl border border-[var(--line)] bg-white px-3 py-2.5">
                <span class="text-gray-400">R</span>
                <input id="pv" type="number" min="10000" step="1000" value="250000"
                       class="w-full outline-none text-[var(--ink)] bg-transparent"/>
              </div>
            </label>

            <label class="block">
              <span class="text-sm font-medium text-[var(--ink-secondary)]">Term</span>
              <select id="term" class="mt-1 w-full rounded-xl border border-[var(--line)] bg-white px-3 py-2.5 text-[var(--ink)]">
                <option value="6">6 months</option>
                <option value="12" selected>12 months</option>
                <option value="24">24 months</option>
                <option value="36">36 months</option>
              </select>
            </label>

            <div class="sm:col-span-2">
              <div class="flex items-center justify-between">
                <span class="text-sm font-medium text-[var(--ink-secondary)]">Loan-to-Value (LTV)</span>
                <span id="ltvLabel" class="text-sm font-semibold text-[var(--ink)]">40%</span>
              </div>
              <input id="ltv" type="range" min="30" max="60" step="1" value="40"
                     class="mt-2 w-full accent-[var(--primary)]" />
            </div>
          </div>

          <div class="mt-6 grid grid-cols-1 md:grid-cols-3 gap-4">
            <div class="glass-card !rounded-xl p-4 ring-1 ring-white/30">
              <div class="text-xs text-[var(--ink-secondary)]">Est. Rate (APR)</div>
              <div id="aprOut" class="mt-1 text-2xl font-semibold text-[var(--ink)]">—</div>
            </div>
            <div class="glass-card !rounded-xl p-4 ring-1 ring-white/30">
              <div class="text-xs text-[var(--ink-secondary)]">Borrow Amount</div>
              <div id="borrowOut" class="mt-1 text-2xl font-semibold text-[var(--ink)]">—</div>
            </div>
            <div class="glass-card !rounded-xl p-4 ring-1 ring-white/30">
              <div class="text-xs text-[var(--ink-secondary)]">Monthly Payment</div>
              <div id="payOut" class="mt-1 text-2xl font-semibold text-[var(--ink)]">—</div>
            </div>
          </div>

          <div class="mt-6 pt-6 border-t border-[var(--line)] flex flex-wrap items-center gap-3">
            <button disabled class="btn btn-secondary !bg-gray-200 !text-gray-500 !border-gray-300 cursor-not-allowed">
                Application Coming Soon
            </button>
            <span class="text-xs text-[var(--ink-secondary)]">Illustrative only. Final terms subject to assessment.</span>
          </div>
        </div>
        
        <div data-animate style="transition-delay: 150ms;">
          <h2 class="text-4xl lg:text-5xl font-extrabold tracking-tighter text-[var(--ink)]">
            Unlock Your Portfolio's Value.
          </h2>
          <p class="mt-4 text-lg text-[var(--ink-secondary)]">
            Borrow against your assets without selling. Get liquidity when you need it while staying fully invested in the market.
          </p>
          <ul class="mt-6 space-y-3 text-[var(--ink)]">
            <li class="flex items-start gap-3">
              <svg class="w-5 h-5 text-[var(--primary-accent)] flex-shrink-0 mt-0.5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 1 0 0-16 8 8 0 0 0 0 16Zm3.857-9.809a.75.75 0 0 0-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 1 0-1.06 1.061l2.5 2.5a.75.75 0 0 0 1.137-.089l4-5.5Z" clip-rule="evenodd" /></svg>
              <div><span class="font-semibold">Stay Invested:</span> Don't disrupt your compounding growth just to access cash.</div>
            </li>
            <li class="flex items-start gap-3">
              <svg class="w-5 h-5 text-[var(--primary-accent)] flex-shrink-0 mt-0.5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 1 0 0-16 8 8 0 0 0 0 16Zm3.857-9.809a.75.75 0 0 0-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 1 0-1.06 1.061l2.5 2.5a.75.75 0 0 0 1.137-.089l4-5.5Z" clip-rule="evenodd" /></svg>
              <div><span class="font-semibold">Lower Cost:</span> Get competitive rates secured by your portfolio, often lower than unsecured loans.</div>
            </li>
            <li class="flex items-start gap-3">
              <svg class="w-5 h-5 text-[var(--primary-accent)] flex-shrink-0 mt-0.5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 1 0 0-16 8 8 0 0 0 0 16Zm3.857-9.809a.75.75 0 0 0-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 1 0-1.06 1.061l2.5 2.5a.75.75 0 0 0 1.137-.089l4-5.5Z" clip-rule="evenodd" /></svg>
              <div><span class="font-semibold">Flexible & Fast:</span> Streamlined digital process with flexible terms that fit your needs.</div>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </section>

  <section id="pricing" class="py-20 lg:py-24 bg-[var(--bg-offwhite)]">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
      <div class="max-w-3xl mx-auto text-center" data-animate>
        <h2 class="text-4xl lg:text-5xl font-extrabold tracking-tighter text-[var(--ink)]">
          Simple, Transparent Pricing.
        </h2>
        <p class="mt-4 text-lg text-[var(--ink-secondary)]">
          No AUM fees. No hidden costs. We only win when you do.
        </p>
      </div>
      
      <div class="mt-16 max-w-5xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-8 items-stretch">
        <div class="flex flex-col rounded-3xl bg-white border border-[var(--line)] shadow-lg shadow-black/5 p-8" data-animate>
          <h3 class="text-2xl font-bold text-[var(--primary)]">Silver</h3>
          <p class="mt-2 text-[var(--ink-secondary)]">Starter features for tracking and exploring.</p>
          <div class="mt-6">
            <span class="text-5xl font-extrabold tracking-tighter text-[var(--ink)]">R0</span>
            <span class="text-lg font-medium text-[var(--ink-secondary)]">/ month</span>
          </div>
          <ul class="mt-8 space-y-3 text-sm text-[var(--ink)]">
            <li class="flex gap-3">
              <svg class="w-5 h-5 text-[var(--primary-accent)] flex-shrink-0" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 1 0 0-16 8 8 0 0 0 0 16Zm3.857-9.809a.75.75 0 0 0-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 1 0-1.06 1.061l2.5 2.5a.75.75 0 0 0 1.137-.089l4-5.5Z" clip-rule="evenodd" /></svg>
              <span>Track <b>1 strategy</b>, no AUM fees</span>
            </li>
            <li class="flex gap-3">
              <svg class="w-5 h-5 text-[var(--primary-accent)] flex-shrink-0" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 1 0 0-16 8 8 0 0 0 0 16Zm3.857-9.809a.75.75 0 0 0-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 1 0-1.06 1.061l2.5 2.5a.75.75 0 0 0 1.137-.089l4-5.5Z" clip-rule="evenodd" /></svg>
              <span>Access to portfolio-linked credit</span>
            </li>
          </ul>
          <a href="auth.html" class="btn btn-secondary mt-auto w-full">
            Choose Silver
          </a>
        </div>
        
        <div class="flex flex-col rounded-3xl bg-[var(--ink)] text-white shadow-2xl shadow-black/10 p-8 ring-2 ring-[var(--primary)]" data-animate style="transition-delay: 150ms;">
          <h3 class="text-2xl font-bold text-yellow-400">Gold</h3>
          <p class="mt-2 text-white/70">For growing investors who want sharper insights.</p>
          <div class="mt-6">
            <span class="text-5xl font-extrabold tracking-tighter text-white">R299</span>
            <span class="text-lg font-medium text-white/70">/ month</span>
          </div>
          <ul class="mt-8 space-y-3 text-sm text-white/90">
            <li class="flex gap-3">
              <svg class="w-5 h-5 text-yellow-400 flex-shrink-0" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 1 0 0-16 8 8 0 0 0 0 16Zm3.857-9.809a.75.75 0 0 0-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 1 0-1.06 1.061l2.5 2.5a.75.75 0 0 0 1.137-.089l4-5.5Z" clip-rule="evenodd" /></svg>
              <span>Track up to <strong>6 strategies</strong> with no AUM fees</span>
            </li>
            <li class="flex gap-3">
              <svg class="w-5 h-5 text-yellow-400 flex-shrink-0" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 1 0 0-16 8 8 0 0 0 0 16Zm3.857-9.809a.75.75 0 0 0-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 1 0-1.06 1.061l2.5 2.5a.75.75 0 0 0 1.137-.089l4-5.5Z" clip-rule="evenodd" /></svg>
              <span>Day-ahead newsletter (news + events)</span>
            </li>
            <li class="flex gap-3">
              <svg class="w-5 h-5 text-yellow-400 flex-shrink-0" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 1 0 0-16 8 8 0 0 0 0 16Zm3.857-9.809a.75.75 0 0 0-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 1 0-1.06 1.061l2.5 2.5a.75.75 0 0 0 1.137-.089l4-5.5Z" clip-rule="evenodd" /></svg>
              <span><b>Premium</b> Wealth Tracker Tools</span>
            </li>
          </ul>
          <a href="auth.html" class="btn btn-primary bg-white text-[var(--ink)] hover:bg-gray-200 mt-auto w-full">
            Choose Gold
          </a>
        </div>
      </div>
    </div>
  </section>

  <section id="final-cta" class="py-20 lg:py-24 bg-white">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
      <div class="relative overflow-hidden rounded-3xl bg-gradient-to-r from-[var(--primary)] to-[#0A4D35] px-6 py-20 text-center shadow-2xl shadow-green-900/20" data-animate>
        <h2 class="text-4xl lg:text-5xl font-extrabold tracking-tighter text-white">
          Ready to Grow Your Capital?
        </h2>
        <p class="mt-4 text-lg text-green-100/80 max-w-xl mx-auto">
          Pick a strategy, track performance, and stay invested with smarter tools.
        </p>
        <div class="mt-10 flex flex-wrap items-center justify-center gap-4">
          <a href="/auth.html?redirect=/home.html"
             class="btn btn-primary bg-white text-[var(--ink)] hover:bg-gray-200">
            Create Your Account
          </a>
          <a href="#strategies"
             class="btn btn-secondary bg-transparent text-white border-white/40 hover:bg-white/10">
            View OpenStrategies
          </a>
        </div>
      </div>
    </div>
  </section>

  <section id="faqs" class="py-20 lg:py-24 bg-white">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
      <div class="max-w-3xl mx-auto text-center" data-animate>
        <h2 class="text-4xl lg:text-5xl font-extrabold tracking-tighter text-[var(--ink)]">
          Frequently Asked Questions
        </h2>
      </div>

      <div class="mt-16 max-w-4xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-4" data-animate>
        <details class="group py-4 border-b border-[var(--line)]">
          <summary class="flex cursor-pointer items-center justify-between gap-3 text-lg font-medium text-[var(--ink)]">
            What is AlgoHive?
            <svg class="w-5 h-5 text-[var(--ink-secondary)] group-open:rotate-180 transition-transform" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5" /></svg>
          </summary>
          <p class="mt-3 text-base text-[var(--ink-secondary)]">
            AlgoHive is a platform where you can discover, track and allocate to managed strategies across asset classes, paying only performance and transaction fees instead of AUM fees.
          </p>
        </details>
        
        <details class="group py-4 border-b border-[var(--line)]">
          <summary class="flex cursor-pointer items-center justify-between gap-3 text-lg font-medium text-[var(--ink)]">
            How do fees work?
            <svg class="w-5 h-5 text-[var(--ink-secondary)] group-open:rotate-180 transition-transform" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5" /></svg>
          </summary>
          <p class="mt-3 text-base text-[var(--ink-secondary)]">
            You only pay performance fees when strategies deliver returns. A small transaction fee applies when you allocate or rebalance. There are no AUM fees — we only win when you do.
          </p>
        </details>

        <details class="group py-4 border-b border-[var(--line)]">
          <summary class="flex cursor-pointer items-center justify-between gap-3 text-lg font-medium text-[var(--ink)]">
            Can I track multiple strategies?
            <svg class="w-5 h-5 text-[var(--ink-secondary)] group-open:rotate-180 transition-transform" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5" /></svg>
          </summary>
          <p class="mt-3 text-base text-[var(--ink-secondary)]">
            Yes. On the Silver (free) plan you can track one strategy. The Gold plan allows up to six.
          </p>
        </details>

        <details class="group py-4 border-b border-[var(--line)]">
          <summary class="flex cursor-pointer items-center justify-between gap-3 text-lg font-medium text-[var(--ink)]">
            Do you offer financial advice?
            <svg class="w-5 h-5 text-[var(--ink-secondary)] group-open:rotate-180 transition-transform" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5" /></svg>
          </summary>
          <p class="mt-3 text-base text-[var(--ink-secondary)]">
            Yes. Alongside our tools and data, you can book sessions with certified wealth advisors for personalised financial advice.
          </p>
        </details>
      </div>
    </div>
  </section>

  <footer class="bg-[var(--bg-offwhite)] border-t border-[var(--line)]">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-16">
      <div class="grid grid-cols-2 md:grid-cols-5 gap-8">
        <div class="col-span-2 md:col-span-2">
          <div class="flex items-center gap-2">
            <img src="https://static.wixstatic.com/media/ac771e_af06d86a7a1f4abd87e52e45f3bcbd96~mv2.png" class="h-8 w-auto" alt="AlgoHive">
            <span class="text-lg font-semibold text-[var(--ink)]">AlgoHive</span>
          </div>
          <p class="mt-3 text-sm text-[var(--ink-secondary)] max-w-xs">
            Ready-made strategies, tracked and managed. Built to grow your wealth, not fees.
          </p>
        </div>

        <div>
          <h4 class="text-sm font-semibold text-[var(--ink)]">Product</h4>
          <ul class="mt-3 space-y-2 text-sm">
            <li><a href="#strategies" class="text-[var(--ink-secondary)] hover:text-[var(--ink)]">Strategies</a></li>
            <li><a href="#pricing" class="text-[var(--ink-secondary)] hover:text-[var(--ink)]">Pricing</a></li>
            <li><a href="#lending" class="text-[var(--ink-secondary)] hover:text-[var(--ink)]">Portfolio Lending</a></li>
          </ul>
        </div>

        <div>
          <h4 class="text-sm font-semibold text-[var(--ink)]">Company</h4>
          <ul class="mt-3 space-y-2 text-sm">
            <li><a href="who-we-are.html" class="text-[var(--ink-secondary)] hover:text-[var(--ink)]">About</a></li>
            <li><a href="how-we-work.html" class="text-[var(--ink-secondary)] hover:text-[var(--ink)]">How we work</a></li>
            <li><a href="#faqs" class="text-[var(--ink-secondary)] hover:text-[var(--ink)]">FAQs</a></li>
          </ul>
        </div>
        
        <div>
          <h4 class="text-sm font-semibold text-[var(--ink)]">Legal</h4>
          <ul class="mt-3 space-y-2 text-sm">
            <li><a href="#" class="text-[var(--ink-secondary)] hover:text-[var(--ink)]">Terms</a></li>
            <li><a href="#" class="text-[var(--ink-secondary)] hover:text-[var(--ink)]">Privacy</a></li>
            <li><a href="#" class="text-[var(--ink-secondary)] hover:text-[var(--ink)]">Risk Policy</a></li>
            <li><a href="#" class="text-[var(--ink-secondary)] hover:text-[var(--ink)]">AML & CTF</a></li>
          </ul>
        </div>
      </div>

      <div class="mt-12 pt-8 border-t border-[var(--line)]">
        <p class="text-xs text-[var(--ink-secondary)]">
          © <span id="yr"></span> AlgoHive. All rights reserved. AlgoHive (FSP 55118) is a registered Financial Services Provider. All asset classes carry investment risks, including the potential loss of capital. Past performance is not indicative of future results.
        </p>
      </div>
    </div>
  </footer>
  
<script nonce="ALGOHIVE">
  // Global scripts for all pages
  document.getElementById('yr').textContent = new Date().getFullYear();

  // Hamburger Menu Toggle
  const hamburgerButton = document.getElementById('hamburger-button');
  const mobileMenu = document.getElementById('mobile-menu');
  hamburgerButton.addEventListener('click', () => {
    mobileMenu.classList.toggle('hidden');
  });

  // Countdown Timer
  (function(){
    const target = new Date('2025-10-21T21:00+02:00');
    const daysEl  = document.getElementById('cdDays');
    const hrsEl   = document.getElementById('cdHrs');
    const minsEl  = document.getElementById('cdMins');
    const secsEl  = document.getElementById('cdSecs');

    if (!daysEl) return; // Exit if elements aren't on this page

    function update(){
      const now = new Date();
      let ms = target - now;
      if (ms <= 0){
        daysEl.textContent = '0'; hrsEl.textContent = '00';
        minsEl.textContent = '00'; secsEl.textContent = '00';
        if(interval) clearInterval(interval);
        return;
      }
      const d = Math.floor(ms / (1000*60*60*24));
      ms -= d * (1000*60*60*24);
      const h = Math.floor(ms / (1000*60*60));
      ms -= h * (1000*60*60);
      const m = Math.floor(ms / (1000*60));
      ms -= m * (1000*60);
      const s = Math.floor(ms / 1000);

      daysEl.textContent = d;
      hrsEl.textContent  = String(h).padStart(2, '0');
      minsEl.textContent = String(m).padStart(2, '0');
      secsEl.textContent = String(s).padStart(2, '0');
    }
    update();
    const interval = setInterval(update, 1000);
  })();

  // Scroll Animations
  (function() {
    const animatedEls = document.querySelectorAll('[data-animate]');
    if (!animatedEls.length) return;

    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('is-visible');
          observer.unobserve(entry.target);
        }
      });
    }, { threshold: 0.1 });

    animatedEls.forEach(el => observer.observe(el));
  })();
</script>

<script type="module" nonce="ALGOHIVE">
  // --- Supabase ---
  const SUPABASE_URL = "https://aazofjsssobejhkyyiqv.supabase.co";
  const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFhem9manNzc29iZWpoa3l5aXF2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgxMTI1NDUsImV4cCI6MjA3MzY4ODU0NX0.guYlxaV5RwTlTVFoUhpER0KWEIGPay8svLsxMwyRUyM";
  
  // ***** THIS IS THE KEY FIX *****
  // Access createClient from the global `window.supabase` object loaded by the CDN script
  const { createClient } = window.supabase; 
  const db = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  // --- DOM helpers ---
  const $  = (s)=>document.querySelector(s);
  const $$ = (s)=>document.querySelectorAll(s);

  // ***** MODIFIED: Updated els object for new HTML structure *****
  const els = {
    stratName: $('#stratName'), provider: $('#provider'), since: $('#since'),
    currency: $('#currency'), risk: $('#risk'), aum: $('#aum'), period: $('#period'),
    eqValue: $('#eqValue'), eqDelta: $('#eqDelta'),
    mBestDay: $('#mBestDay'), mWorstDay: $('#mWorstDay'), mAvgDaily: $('#mAvgDaily'),
    mPosDays: $('#mPosDays'), mTradingDays: $('#mTradingDays'), mYTD: $('#mYTD'),
    equityChartCanvas: $('#equityChartCanvas'), 
    stratDesc: $('#stratDesc'), leftCard: $('#leftCard'),
    assetFilters: $('#assetFilters'), periodButtons: $$('.prd')
  };

  // --- State ---
  let STRATEGIES = [];
  let selectedAsset = 'All';
  let selectedPeriod = '6M'; // Default to 6M to match active button
  let activeStrategyIndex = 0;
  let chart; // Global var for Chart.js instance
  
  // Date formatter for chart hover
  const chartDateFmt = new Intl.DateTimeFormat('en-GB', { month: 'short', day: 'numeric', year: '2-digit' });

  // --- Formatters ---
  const fmtPct = (v, dp=1) => (v==null || isNaN(+v)) ? '—' : `${+v>=0?'+':''}${(+v).toFixed(dp)}%`;
  const fmtInt = (v) => (v==null || isNaN(+v)) ? '—' : String(Math.round(+v));

  // --- Fetch (matches your exact schema) ---
  async function fetchStrategies() {
    const { data, error } = await db
      .from('strategies')
      .select(`
        id, name, creator, inception_date, risk_level, aum, currency,
        strategy_description, asset_universe,
        strategy_metrics:strategy_metrics!strategy_metrics_strategy_id_fkey (
          asof_date, perf_summary, calendar_returns,
           series_6m, series_1y, series_all,
           series_ytd,
          live_equity, live_equity_ts, latest_eod_equity, latest_eod_date,
          portfolio_holdings, asset_allocation
        )
      `)
      .order('name', { ascending: true });

    if (error) {
      console.error(error);
      $('#stratName').textContent = 'Error loading strategies.';
      return [];
    }

    return (data || []).map(s => {
      const m = s.strategy_metrics || {};
      const ps = m.perf_summary || {};
      const num = (x)=> (x==null || x==='') ? null : Number(x);
      
      return {
        id: s.id,
        name: s.name || 'Unnamed Strategy',
        provider: s.creator || 'AlgoHive Quant',
        inception_date: s.inception_date || null,
        since: s.inception_date ? `Live since ${new Date(s.inception_date).toLocaleDateString('en-CA')}` : '—',
        risk: s.risk_level || '',
        aum: (num(s.aum)!=null) ? `R${(num(s.aum)/1_000_000).toFixed(1)}m` : '—',
        currency: s.currency || 'USD',
        desc: s.strategy_description || 'No description provided.',
        asset: s.asset_universe || 'Other',

        // Time series (jsonb arrays)
        series_6m: Array.isArray(m.series_6m) ? m.series_6m : [],
        series_1y: Array.isArray(m.series_1y) ? m.series_1y : [],
        series_all: Array.isArray(m.series_all) ? m.series_all : [],
        series_ytd: Array.isArray(m.series_ytd) ? m.series_ytd : [],

        // --- Data for the 6-pack, matching strategy.html logic ---
        bestDay:     fmtPct(num(ps.best_day_pct), 2),
        worstDay:    fmtPct(num(ps.worst_day_pct), 2),
        avgDaily:    fmtPct(num(ps.avg_daily_return_pct), 2),
        posDaysPct:  (ps?.positive_days_pct == null || isNaN(ps.positive_days_pct)) ? '—' : `${Number(ps.positive_days_pct).toFixed(0)}%`,
        tradingDays: fmtInt(num(ps.total_days)),
        ytd:         fmtPct(num(ps.ytd_return_pct), 2) // This is the correct, pre-calculated YTD
      };
    });
  }

  // ***** CHART.JS FUNCTIONS (Copied from strategy.html) *****
  
  // Helper to draw rounded rect path for tooltip
  function roundRectPath(ctx, x, y, w, h, r) {
      const radius = Math.min(r, h / 2, w / 2);
      ctx.moveTo(x + radius, y);
      ctx.lineTo(x + w - radius, y);
      ctx.quadraticCurveTo(x + w, y, x + w, y + radius);
      ctx.lineTo(x + w, y + h - radius);
      ctx.quadraticCurveTo(x + w, y + h, x + w - radius, y + h);
      ctx.lineTo(x + radius, y + h);
      ctx.quadraticCurveTo(x, y + h, x, y + h - radius);
      ctx.lineTo(x, y + radius);
      ctx.quadraticCurveTo(x, y, x + radius, y);
  }
  
  // Custom plugin for vertical seek line + hover pill
  const seekPlugin = {
      id: 'seekPlugin',
      afterDraw(chart, args, opts) {
          const { ctx, chartArea, tooltip } = chart;
          if (!tooltip || !tooltip._active || !tooltip._active.length) return;

          const activePoint = tooltip._active[0];
          const x = activePoint.element.x;
          const y = activePoint.element.y;

          if (x < chartArea.left || x > chartArea.right) return;
          const { top, bottom } = chartArea;
          ctx.save();
          ctx.setLineDash([4, 4]);
          ctx.strokeStyle = '#000';
          ctx.lineWidth = 1;
          ctx.beginPath();
          ctx.moveTo(x, top);
          ctx.lineTo(x, bottom);
          ctx.stroke();
          ctx.setLineDash([]);
          const triSize = 5;
          ctx.fillStyle = '#000';
          ctx.beginPath();
          ctx.moveTo(x, top - triSize);
          ctx.lineTo(x - triSize, top);
          ctx.lineTo(x + triSize, top);
          ctx.closePath();
          ctx.fill();
          ctx.beginPath();
          ctx.moveTo(x, bottom + triSize);
          ctx.lineTo(x - triSize, bottom);
          ctx.lineTo(x + triSize, bottom);
          ctx.closePath();
          ctx.fill();
          ctx.beginPath();
          ctx.arc(x, y, 5, 0, Math.PI * 2);
          ctx.fillStyle = '#fff';
          ctx.fill();
          ctx.lineWidth = 2;
          ctx.strokeStyle = '#1e293b';
          ctx.stroke();

          const meta = window.__pfHoverMeta || {};
          const idx = activePoint.index;
          const dateLabel = (meta.labels && meta.labels[idx]) ? meta.labels[idx] : '';
          const valLabel = (meta.values && meta.values[idx] != null) ? meta.values[idx] : '—';
          
          const pillText = `${dateLabel}  ${valLabel}`;
          ctx.font = '600 12px Inter, system-ui, sans-serif';
          ctx.textBaseline = 'middle';
          const textW = ctx.measureText(pillText).width;
          const padX = 10, padY = 6;
          const pillW = textW + padX * 2, pillH = 28;
          const pillMargin = 8;
          const areaWidth = chartArea.right - chartArea.left;
          const areaHeight = chartArea.bottom - chartArea.top;
          let pillX = x - pillW / 2;
          const minPillX = chartArea.left + pillMargin;
          const maxPillX = chartArea.right - pillW - pillMargin;

          if (minPillX > maxPillX) {
              pillX = chartArea.left + (areaWidth - pillW) / 2;
              pillX = Math.max(chartArea.left, Math.min(pillX, chartArea.right - pillW));
          } else {
              if (pillX < minPillX) pillX = minPillX;
              if (pillX > maxPillX) pillX = maxPillX;
          }
          let pillY = y - pillH - 10;
          const minPillY = chartArea.top + pillMargin;
          const maxPillY = chartArea.bottom - pillH - pillMargin;

          if (minPillY > maxPillY) {
              pillY = chartArea.top + (areaHeight - pillH) / 2;
              pillY = Math.max(chartArea.top, Math.min(pillY, chartArea.bottom - pillH));
          } else {
              if (pillY < minPillY) {
                  const belowY = y + 10;
                  const roomBelow = belowY + pillH <= chartArea.bottom - pillMargin;
                  pillY = roomBelow ? Math.min(Math.max(belowY, minPillY), maxPillY) : minPillY;
              }
              if (pillY > maxPillY) pillY = maxPillY;
          }
          ctx.fillStyle = '#000';
          ctx.beginPath();
          roundRectPath(ctx, pillX, pillY, pillW, pillH, 14);
          ctx.fill();

          const pctIsPos = valLabel.startsWith('+');
          ctx.fillStyle = pctIsPos ? '#4ade80' : (valLabel.startsWith('—') || valLabel === '0.00%') ? '#fff' : '#f87171';
          ctx.textAlign = 'center';
          const textCenter = pillX + pillW / 2;
          ctx.fillText(pillText, textCenter, pillY + pillH / 2);
          ctx.restore();
      }
  };
  
  // Global var for hover plugin
  window.__pfHoverMeta = { labels: [], values: [] };

  function initChart() {
      const ctx = els.equityChartCanvas?.getContext('2d');
      if (!ctx) return;

      const gradient = ctx.createLinearGradient(0, 0, 0, 320);
      gradient.addColorStop(0, 'rgba(85,107,47,0.35)'); // #556B2F
      gradient.addColorStop(1, 'rgba(85,107,47,0.06)'); // #556B2F

      chart = new Chart(ctx, {
          type: 'line',
          data: {
              labels: [],
              datasets: [{
                  data: [],
                  tension: .35,
                  borderWidth: 2,
                  borderColor: '#556B2F', // Dark olive green
                  backgroundColor: gradient,
                  fill: true,
                  pointRadius: 0,
                  pointHitRadius: 20 
              }]
          },
          options: {
              responsive: true,
              maintainAspectRatio: false,
              interaction: { mode: 'index', intersect: false },
              plugins: {
                  legend: { display: false },
                  tooltip: { enabled: false }
              },
              scales: {
                  x: { display: true, ticks: { maxTicksLimit: 6, color: '#94a3b8' }, grid: { display: false } },
                  y: { display: true, ticks: { color: '#94a3b8', maxTicksLimit: 5, callback: v => v } }
              }
          },
          plugins: [seekPlugin] // Enable the hover plugin
      });
  }

  // --- Chart Drawing Function ---
  function drawChart(equityVals, dates){
      if (!chart) return; 
      
      const pct = (n,dp=1)=>`${n>=0?'+':''}${n.toFixed(dp)}%`;
      const base = (equityVals && equityVals.length > 0) ? equityVals[0] : 100;
      const lastPct = ((equityVals.at(-1) || base) - base) / base * 100;
      
      // Update main value
      els.eqValue.textContent = pct(lastPct, 2); 
      els.eqValue.style.color = lastPct >= 0 ? 'var(--primary-accent)' : '#dc2626';
      
      // Hide delta
      els.eqDelta.textContent = ''; 
      els.eqDelta.classList.add('hidden');

      // Update chart instance
      const chartLabels = dates.map(d => chartDateFmt.format(new Date(d)));
      chart.data.labels = chartLabels;
      chart.data.datasets[0].data = equityVals; // Plot the CUMULATIVE level

      // Update Y-axis ticks to show relative %
      chart.options.scales.y.ticks.callback = v => {
          const relPct = ((v - base) / base) * 100;
          return pct(relPct, 0);
      };

      // Update hover metadata
      window.__pfHoverMeta = {
          labels: chartLabels,
          values: equityVals.map(v => pct(((v - base) / base) * 100, 2))
      };
      
      chart.update();
  }

  // --- Series selection (Core Logic) ---
  function periodSeries(s, period){
    let raw=[];
    switch (period){ // Use the passed-in period
      case '6M': raw=s.series_6m; break;
      case '1Y': raw=s.series_1y; break;
      case 'ALL': raw=s.series_all; break;
      case 'YTD': raw=s.series_ytd; break; 
      default: raw=s.series_6m; break;
    }
    
    if (!Array.isArray(raw) || raw.length===0){
      return { eq:[100], dates:[ new Date(s.inception_date || Date.now()) ] };
    }

    const first = raw[0] || {};
    if ('ts' in first && 'equity' in first){
      const base = Number(first.equity)||1;
      const eq = raw.map(p=> 100*((Number(p.equity)||0)/base) );
      const dates = raw.map(p=> new Date(p.ts));
      return { eq, dates };
    }

    const labelToDate = (label)=>{
      if (!label) return null;
      const [mon,yr] = label.split(' ');
      const mi = new Date(Date.parse(`${mon} 1, 2000`)).getMonth();
      const d = new Date(Number(yr), mi+1, 0);
      return isNaN(d.getTime()) ? null : d;
    };

    const rows = raw.map(r=>{
      const d = r.date ? new Date(r.date) : labelToDate(r.label);
      const pct = (r.pct==null)?0:Number(r.pct); // Correct cumulative calculation
      return d ? { d, pct } : null;
    }).filter(Boolean);

    if (!rows.length) return { eq:[100], dates:[ new Date(s.inception_date || Date.now()) ] };
    
    const eq = rows.reduce((arr, r)=>{ arr.push(arr.at(-1)*(1+(r.pct||0))); return arr; }, [100]);
    const start = new Date(rows[0].d); start.setDate(start.getDate()-1);
    const dates = [start, ...rows.map(r=>r.d)];
    return { eq, dates };
  }

  // --- Render Function ---
  function render(){
    const list = STRATEGIES.filter(x=> selectedAsset==='All' || x.asset===selectedAsset );
    if (!list.length){
      els.stratName.textContent = `No strategies found for "${selectedAsset}"`;
      ['provider','since','currency','risk','aum','period','mBestDay','mWorstDay','mAvgDaily','mPosDays','mTradingDays','mYTD','stratDesc'].forEach(k=>els[k]&&(els[k].textContent='—'));
      drawChart([],[]); updateNav(0,0); markActive(); return;
    }
    if (activeStrategyIndex>=list.length) activeStrategyIndex=0;

    const s = list[activeStrategyIndex];
    
    // Get the correct data series based on the *selectedPeriod*
    const { eq, dates } = periodSeries(s, selectedPeriod); 

    els.stratName.textContent = s.name;
    els.provider.textContent  = s.provider;
    els.since.textContent     = s.since;
    els.currency.textContent  = s.currency || 'USD';
    
    if (s.aum && s.aum !== 'R0.0m' && s.aum !== '—') {
      els.aum.textContent = s.aum;
      els.aum.classList.remove('hidden');
    } else {
      els.aum.classList.add('hidden');
    }
    
    els.stratDesc.textContent = s.desc;

    const r = (s.risk||'').toLowerCase();
    els.risk.textContent = s.risk || '—';
    els.risk.className = 'inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium ' +
      (r.includes('very high') ? 'bg-red-100 text-red-800' :
       r.includes('high') ? 'bg-red-50 text-red-700' :
       (r.includes('med') || r.includes('moderate'))  ? 'bg-amber-50 text-amber-700' :
       r.includes('conservative') ? 'bg-green-50 text-green-700' :
                            'bg-slate-100 text-slate-700');

    // Populate the 6-pack
    els.mBestDay.textContent = s.bestDay;
    els.mWorstDay.textContent = s.worstDay;
    els.mAvgDaily.textContent = s.avgDaily;
    els.mPosDays.textContent = s.posDaysPct;
    els.mTradingDays.textContent = s.tradingDays;
    els.mYTD.textContent = s.ytd; // Use the direct pre-fetched value
    
    // Colorize the summary box
    const red = '#dc2626';
    const green = 'var(--primary-accent)'; // #16A34A
    const defaultColor = 'var(--ink)';

    els.mBestDay.style.color = (s.bestDay && s.bestDay.startsWith('+')) ? green : defaultColor;
    els.mWorstDay.style.color = (s.worstDay && s.worstDay.startsWith('-')) ? red : defaultColor;
    els.mAvgDaily.style.color = (s.avgDaily && s.avgDaily.startsWith('-')) ? red : (s.avgDaily && s.avgDaily.startsWith('+')) ? green : defaultColor;
    els.mPosDays.style.color = defaultColor;
    els.mTradingDays.style.color = defaultColor;
    els.mYTD.style.color = (s.ytd && s.ytd.startsWith('-')) ? red : (s.ytd && s.ytd.startsWith('+')) ? green : defaultColor;

    els.period.textContent = selectedPeriod==='ALL' ? 'All time' : selectedPeriod;

    drawChart(eq, dates); // Update the Chart.js instance

    els.leftCard.classList.remove('swap-in'); void els.leftCard.offsetWidth; els.leftCard.classList.add('swap-in');

    updateNav(activeStrategyIndex, list.length);
    markActive();
  }

  function renderAssetFilters(){
    const assets = ['All', ...new Set(STRATEGIES.map(s=>s.asset).filter(Boolean))];
    els.assetFilters.innerHTML = assets.map(a=>`
      <button class="filter-tag asset-tag ${a === 'All' ? 'active' : ''}" data-asset="${a}">${a}</button>
    `).join('');
    $$('.asset-tag').forEach(b=>{
      b.addEventListener('click', ()=>{ 
        selectedAsset=b.dataset.asset; 
        $$('.asset-tag').forEach(btn => btn.classList.remove('active'));
        b.classList.add('active');
        activeStrategyIndex=0; 
        render(); 
      });
    });
  }

  function updateNav(i,n){ /* Navigation buttons removed */ }
  function markActive(){ 
     els.periodButtons.forEach(b=>b.classList.toggle('active', b.dataset.period===selectedPeriod)); 
  }

  // --- Init ---
  async function main(){
    initChart(); // Initialize the chart structure
    STRATEGIES = await fetchStrategies();
    if (STRATEGIES.length){ renderAssetFilters(); render(); }
    else { $('#stratName').textContent = 'No strategies available.'; updateNav(0,0); }

    els.periodButtons.forEach(b=> b.addEventListener('click', ()=>{ 
      selectedPeriod=b.dataset.period||'ALL'; 
      render(); 
    }));
  }
  main();
</script>


</body> 
</html>
