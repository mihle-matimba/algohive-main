<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AlgoHive – Dashboard (Dynamic)</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"/>

  <style>
    :root{ --bg:#fff; --line:#e2e8f0; --ink:#0f172a; --olive:#556B2F }
    html,body{ font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif; background:var(--bg); color:var(--ink) }
    .card{ background:#fff; border:1px solid var(--line); border-radius:12px }
    .btn{ display:inline-flex; align-items:center; justify-content:center; gap:.5rem; height:40px; padding:0 .875rem; border-radius:10px; border:1px solid var(--line); font-weight:600 }
    .input{ height:40px; border:1px solid var(--line); border-radius:10px; padding:0 .75rem }
    .tab{ height:36px; border-radius:8px; padding:0 .75rem }
    .tab-active{ background:#111827; color:#fff }
    #layout{ --sb:220px; display:grid; grid-template-columns:var(--sb) 1fr; min-height:100vh }
    #layout.is-collapsed{ --sb:64px }
    #ah-sidebar{ transition:width .2s ease; width:var(--sb) }
    #ah-sidebar[data-collapsed="true"] .label, #ah-sidebar[data-collapsed="true"] .chevron{ display:none }
    #ah-sidebar details .sub{ transition:height .2s ease }
    #ah-sidebar[data-collapsed="true"] details>.sub{ display:none !important }
    #ah-sidebar .footer{ transition:all .2s ease }
    #ah-sidebar[data-collapsed="true"] .btn-collapse :is(svg,i){ transform:rotate(180deg) }
    .ps-tile{ border:1px solid #e5e7eb; border-radius:14px; padding:14px 16px; background:#fff }
    .ps-label{ color:#64748b; font-weight:500; font-size:.85rem }
    .ps-value{ font-weight:600; font-size:1rem; margin-top:2px }
    @keyframes ah-spin{ to{ transform:rotate(360deg) } }
    .spin i{ animation:ah-spin .8s linear infinite }
    .cal-grid{ display:grid; grid-auto-rows:minmax(36px,auto) }
    .cal-cell{ font-size:12px; font-weight:600; border-radius:10px; border:1px solid #e5e7eb; display:flex; align-items:center; justify-content:center }
    .cal-head{ font-size:12px; font-weight:600; color:#64748b; display:flex; align-items:center }
  </style>
</head>

<body class="min-h-screen overflow-x-hidden">
  <div id="layout">
    <!-- ===== Sidebar ===== -->
    <aside id="ah-sidebar" data-collapsed="false" class="border-r border-slate-200 h-[100vh] sticky top-0 bg-white flex flex-col overflow-hidden">
      <div class="px-4 py-4 flex items-center gap-3 border-b border-slate-200">
        <img src="https://static.wixstatic.com/media/ac771e_af06d86a7a1f4abd87e52e45f3bcbd96~mv2.png" alt="AlgoHive Logo" class="w-10 h-10 object-contain"/>
        <div class="min-w-0">
          <div class="font-bold text-[15px] text-slate-900 label">AlgoHive</div>
          <div class="text-[11px] text-slate-500 label">ID: <span id="sidebar-acc">—</span></div>
        </div>
      </div>

      <nav class="p-2 text-[14px] flex-1 overflow-y-auto">
        <a class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-slate-50 font-medium text-slate-900 bg-slate-100" href="#" title="Home">
          <i class="fa-solid fa-house text-slate-500 w-4 shrink-0"></i><span class="label">Home</span>
        </a>

        <details class="group mt-1">
          <summary class="flex items-center justify-between px-3 py-2 rounded-lg hover:bg-slate-50 cursor-pointer font-medium text-slate-900">
            <span class="flex items-center gap-3"><i class="fa-regular fa-user w-4 text-slate-500"></i><span class="label">Portfolio</span></span>
            <i class="fa-solid fa-chevron-down text-slate-400 group-open:rotate-180 transition-transform chevron"></i>
          </summary>
          <div class="ml-8 mt-1 flex flex-col sub">
            <a class="px-3 py-2 rounded-lg hover:bg-slate-50 flex items-center gap-2" href="#" title="Positions"><i class="fa-solid fa-chart-pie w-4 text-slate-500"></i><span class="label">Positions</span></a>
            <a class="px-3 py-2 rounded-lg hover:bg-slate-50 flex items-center gap-2" href="#" title="Orders"><i class="fa-regular fa-clipboard w-4 text-slate-500"></i><span class="label">Orders</span></a>
            <a class="px-3 py-2 rounded-lg hover:bg-slate-50 flex items-center gap-2" href="#" title="Activity"><i class="fa-solid fa-bars w-4 text-slate-500"></i><span class="label">Activity</span></a>
            <a class="px-3 py-2 rounded-lg hover:bg-slate-50 flex items-center gap-2" href="#" title="Balances"><i class="fa-solid fa-table w-4 text-slate-500"></i><span class="label">Balances</span></a>
            <a class="px-3 py-2 rounded-lg hover:bg-slate-50 flex items-center gap-2" href="#" title="Funding"><i class="fa-solid fa-hand-holding-dollar w-4 text-slate-500"></i><span class="label">Funding</span></a>
          </div>
        </details>

        <details class="group mt-1">
          <summary class="flex items-center justify-between px-3 py-2 rounded-lg hover:bg-slate-50 cursor-pointer font-medium text-slate-900">
            <span class="flex items-center gap-3"><i class="fa-solid fa-link w-4 text-slate-500"></i><span class="label">Invest</span></span>
            <i class="fa-solid fa-chevron-down text-slate-400 group-open:rotate-180 transition-transform chevron"></i>
          </summary>
          <div class="ml-8 mt-1 flex flex-col sub">
            <a class="px-3 py-2 rounded-lg hover:bg-slate-50 flex items-center gap-2" href="strategies.html" title="OpenStrategies"><i class="fa-solid fa-chart-line w-4 text-slate-500"></i><span class="label">OpenStrategies</span></a>
            <a class="px-3 py-2 rounded-lg hover:bg-slate-50 flex items-center gap-2" href="#" title="Funds"><i class="fa-solid fa-coins w-4 text-slate-500"></i><span class="label">Funds</span></a>
          </div>
        </details>

        <a class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-slate-50" href="pricing.html" title="Plans & Features"><i class="fa-regular fa-square-check w-4 text-slate-500"></i><span class="label">Plans & Features</span></a>
        <a class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-slate-50" href="#" title="Community"><i class="fa-regular fa-comments w-4 text-slate-500"></i><span class="label">Community</span></a>
        <a class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-slate-50" href="#" title="Support"><i class="fa-solid fa-life-ring w-4 text-slate-500"></i><span class="label">Support</span></a>
        <a class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-slate-50" href="#" title="Legal"><i class="fa-solid fa-scale-balanced w-4 text-slate-500"></i><span class="label">Legal</span></a>
      </nav>

      <div class="p-3 border-t border-slate-200 footer flex items-center justify-between gap-2">
        <a id="ah-settings" class="btn h-10 w-10 p-0 rounded-xl bg-slate-100 hover:bg-slate-200 border-0" href="settings.html" title="Settings"><i class="fa-solid fa-gear"></i></a>
        <button id="ah-collapse" class="btn h-10 w-10 p-0 rounded-xl bg-slate-100 hover:bg-slate-200 border-0" title="Collapse"><i class="fa-solid fa-arrow-left"></i></button>
      </div>
    </aside>

    <!-- ===== Main ===== -->
    <main class="flex-1 min-w-0">
      <!-- Header -->
      <div class="flex items-center justify-between px-6 py-4 border-b border-slate-200 bg-white">
        <div class="flex items-center gap-3 flex-1 min-w-0 max-w-[460px]">
          <div class="relative w-full">
            <input class="input w-full pl-9" placeholder="Search"/>
            <svg class="w-4 h-4 absolute left-3 top-1/2 -translate-y-1/2 text-slate-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
          </div>
        </div>

        <div class="flex items-center gap-3">
          <button class="relative h-10 w-10 rounded-full border border-slate-200 grid place-items-center hover:bg-slate-50" aria-label="Notifications">
            <i class="fa-regular fa-bell text-slate-500"></i>
            <span class="absolute -top-0.5 -right-0.5 h-2.5 w-2.5 rounded-full bg-orange-500 ring-2 ring-white"></span>
          </button>
          <img id="hdr-avatar" src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='36' height='36'><rect width='100%' height='100%' fill='%23f1f5f9'/></svg>" alt="Profile" class="w-9 h-9 rounded-full object-cover border border-slate-200"/>
          <button id="hdr-profile-btn" class="flex items-center gap-2 text-slate-900 font-medium hover:text-slate-700"><span id="hdr-name">—</span><i class="fa-solid fa-chevron-down text-slate-500 text-xs"></i></button>
      </div>
      </div>

      <!-- GRID -->
      <div class="px-6 py-6 grid grid-cols-12 gap-6 min-w-0">
        <!-- Portfolio -->
        <section id="portfolio-card" class="card border border-slate-200 shadow-none col-span-12 lg:col-span-9 min-w-0">
          <div class="flex items-center justify-between px-5 py-4 border-b border-slate-200">
            <div>
              <h3 class="font-normal text-slate-800">Your portfolio</h3>
              <div class="mt-1 text-sm text-slate-500" id="pf-updated">—</div>
            </div>
            <div class="flex items-center gap-2">
              <button data-range="1D" class="tab tab-active text-[13px]">1D</button>
              <button data-range="1M" class="tab text-[13px]">1M</button>
              <button data-range="1Y" class="tab text-[13px]">1Y</button>
              <button data-range="ALL" class="tab text-[13px]">All</button>
              <button id="pf-refresh" class="ml-2 h-9 w-9 rounded-lg border border-slate-200 hover:bg-slate-50 grid place-items-center" title="Refresh"><i class="fa-solid fa-rotate-right"></i></button>
            </div>
          </div>
          <div class="px-5 pt-4">
            <div class="flex items-baseline gap-3">
              <div class="text-2xl font-bold" id="pf-value">—</div>
              <div class="text-lg font-normal" id="pf-change" data-sign="-">—</div>
            </div>
          </div>
          <div class="px-2 pb-4 pt-2">
            <div class="h-[260px]"><canvas id="pf-chart" class="max-w-full"></canvas></div>
            <div class="px-3 mt-1 text-[12px] text-slate-400 flex justify-between select-none"><span>10 AM</span><span>11 AM</span><span>2 PM</span><span>4 PM</span></div>
          </div>
        </section>

        <!-- Right column -->
        <aside class="col-span-12 lg:col-span-3 lg:row-span-5 grid gap-6 lg:sticky lg:top-4 self-start min-w-0">
          <!-- Allocation Flow -->
          <div class="card p-5 border border-slate-200">
            <div class="flex items-center justify-between mb-3">
              <h3 class="text-base font-medium text-slate-900">Allocate to Strategy</h3>
              <span class="text-xs text-emerald-700 bg-emerald-50 border border-emerald-200 px-2 py-0.5 rounded-full">Demo</span>
            </div>

            <div class="grid grid-cols-2 gap-3">
              <div class="col-span-2">
                <label class="block text-xs text-slate-500 mb-1.5" for="alloc-name">Strategy</label>
                <input id="alloc-name" class="h-9 w-full rounded-lg border border-slate-200 px-3 text-sm bg-slate-50" value="Nasdaq Momentum" disabled/>
              </div>
              <div>
                <label class="block text-xs text-slate-500 mb-1.5" for="alloc-price">Unit Price (USD)</label>
                <input id="alloc-price" type="number" step="0.01" value="100.00" class="h-9 w-full rounded-lg border border-slate-200 px-3 text-sm bg-slate-50" disabled/>
              </div>
              <div>
                <label class="block text-xs text-slate-500 mb-1.5" for="alloc-units">Units</label>
                <input id="alloc-units" type="number" min="1" value="10" class="h-9 w-full rounded-lg border border-slate-200 px-3 text-sm"/>
              </div>
            </div>

            <div class="mt-3 rounded-lg border border-slate-200 p-3 flex items-center justify-between">
              <div class="text-xs text-slate-500">Total</div>
              <div id="alloc-total" class="text-base font-semibold text-slate-900">$1,000.00</div>
            </div>

            <div class="mt-3 flex items-center justify-end gap-2">
              <button id="alloc-btn" class="btn bg-[var(--olive)] text-white border-none hover:opacity-90">
                <i class="fa-solid fa-circle-plus"></i> Allocate
              </button>
            </div>

            <div id="alloc-toast" class="hidden mt-3 rounded-lg border border-emerald-200 bg-emerald-50 p-3 text-emerald-800 text-sm">
              <i class="fa-solid fa-check mr-2"></i>
              Allocation submitted for <span id="toast-strat">—</span>: <span id="toast-units">—</span> unit(s) @ <span id="toast-price">—</span>.
            </div>
          </div>

          <!-- Asset class allocation -->
          <div class="card p-5 border border-slate-200">
            <div class="flex items-center justify-between mb-3">
              <h3 class="text-base font-medium text-slate-900">Asset class allocation</h3>
              <span class="text-xs text-slate-500">Total = 100%</span>
            </div>
            <div class="space-y-4" id="asset-allocation"></div>
          </div>

          <!-- Strategy Description (new) -->
          <div class="card p-5 border border-slate-200">
            <h3 class="text-base font-medium text-slate-900 mb-2">Strategy Description</h3>
            <div id="strategy-desc" class="text-sm text-slate-700">
              <div class="font-semibold" id="desc-name">Nasdaq Momentum</div>
              <p class="mt-1">Rules-based trend strategy focused on large-cap tech, rebalanced monthly. Targets steady compounding with capped drawdowns via trailing stops.</p>
              <ul class="list-disc pl-5 mt-2 text-slate-600">
                <li>Universe: NDX-100</li>
                <li>Risk: 10–12% vol target</li>
                <li>Stops: 12% trailing</li>
              </ul>
            </div>
          </div>
        </aside>

        <!-- Performance Summary -->
        <section class="col-span-12 lg:col-span-9 min-w-0">
          <div class="card p-6 rounded-2xl border border-slate-200">
            <h3 class="text-lg font-medium text-slate-900 mb-5">Performance Summary</h3>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-4">
              <div class="ps-tile"><div class="ps-label">Best Day</div><div id="ps-best" class="ps-value">+4.25%</div></div>
              <div class="ps-tile"><div class="ps-label">Worst Day</div><div id="ps-worst" class="ps-value">-2.67%</div></div>
              <div class="ps-tile"><div class="ps-label">Avg Daily Return</div><div id="ps-avg" class="ps-value">+0.12%</div></div>
              <div class="ps-tile"><div class="ps-label">Positive Days</div><div id="ps-pos" class="ps-value">61%</div></div>
              <div class="ps-tile"><div class="ps-label">Trading Days</div><div id="ps-days" class="ps-value">245</div></div>
              <div class="ps-tile"><div class="ps-label">CAGR (sim.)</div><div id="ps-cagr" class="ps-value">+7.8%</div></div>
            </div>

            <!-- Calendar Returns -->
            <div class="mt-6">
              <div class="flex items-center justify-between mb-2">
                <div class="text-sm font-semibold text-slate-900">Calendar Returns</div>
                <div class="flex items-center gap-3 text-xs">
                  <span class="inline-block w-5 h-3 rounded" id="legNeg"></span><span class="text-slate-500">Negative</span>
                  <span class="inline-block w-5 h-3 rounded" id="legNeu"></span><span class="text-slate-500">Flat</span>
                  <span class="inline-block w-5 h-3 rounded" id="legPos"></span><span class="text-slate-500">Positive</span>
                </div>
              </div>
              <div class="overflow-x-auto">
                <div id="calendarReturns" class="cal-grid"></div>
              </div>
            </div>
          </div>
        </section>

        <!-- Current holdings -->
        <section class="col-span-12 lg:col-span-9 min-w-0">
          <div class="card p-6 rounded-2xl border border-slate-200">
            <div class="flex items-center justify-between mb-5">
              <h3 class="text-lg font-medium text-slate-900">Current holdings</h3>
              <div class="flex gap-2">
                <button id="hold-prev" class="h-9 w-9 rounded-lg border border-slate-200 grid place-items-center hover:bg-slate-50" aria-label="Previous"><i class="fa-solid fa-chevron-left text-slate-500"></i></button>
                <button id="hold-next" class="h-9 w-9 rounded-lg border border-slate-200 grid place-items-center hover:bg-slate-50" aria-label="Next"><i class="fa-solid fa-chevron-right text-slate-500"></i></button>
              </div>
            </div>
            <div id="hold-track" class="flex gap-4 overflow-x-auto no-scrollbar snap-x"></div>
          </div>
        </section>

        <!-- Top Positions + Recent Orders (as before) -->
        <section class="col-span-12 lg:col-span-9 min-w-0">
          <div class="card rounded-2xl border border-slate-200 p-6">
            <div class="flex items-center justify-between">
              <h3 class="text-lg font-medium text-slate-900">Top Positions</h3>
              <a href="#" class="text-sm text-slate-500 hover:text-slate-700">View All</a>
            </div>
            <div class="mt-4 overflow-x-auto">
              <table class="w-full text-sm">
                <thead><tr class="text-slate-500"><th class="py-3 text-left font-normal">Asset</th><th class="py-3 text-left font-normal">Price</th><th class="py-3 text-left font-normal">Qty</th><th class="py-3 text-left font-normal">Market Value</th><th class="py-3 text-left font-normal">Total P/L ($)</th><th class="py-3 text-center font-normal"> </th></tr></thead>
                <tbody class="divide-y divide-slate-100">
                  <tr class="hover:bg-slate-50"><td class="py-3"><a class="hover:underline" href="#">AAPL</a></td><td class="py-3">$255.46</td><td class="py-3">399</td><td class="py-3">$101,928.54</td><td class="py-3 text-green-600">+$1,121.19</td><td class="py-3 text-center"></td></tr>
                  <tr class="hover:bg-slate-50"><td class="py-3"><a class="hover:underline" href="#">NVDA</a></td><td class="py-3">$178.19</td><td class="py-3">301</td><td class="py-3">$53,635.19</td><td class="py-3 text-red-600">-$343.50</td><td class="py-3 text-center"></td></tr>
                </tbody>
              </table>
            </div>
          </div>
        </section>
      </div>

      <!-- Charts -->
      <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
      <script>
        // Tiles + allocation bars
        (() => {
          const holdings = [
            { ticker:'AAPL', name:'Apple, Inc', price:1232.00, pct:11.01, bg:'#111827' },
            { ticker:'PYPL', name:'PayPal, Inc', price:965.00, pct:-9.05, bg:'#2563eb' },
            { ticker:'TSLA', name:'Tesla, Inc', price:1232.00, pct:11.01, bg:'#dc2626' },
            { ticker:'AMZN', name:'Amazon.com', price:2567.99, pct:11.01, bg:'#d97706' },
            { ticker:'NVDA', name:'NVIDIA Corp', price:876.12, pct:2.44, bg:'#16a34a' },
            { ticker:'MSFT', name:'Microsoft', price:412.33, pct:-1.32, bg:'#0ea5e9' },
          ];
          const track = document.getElementById('hold-track');
          const fmt = v => `$${v.toLocaleString('en-US',{minimumFractionDigits:2, maximumFractionDigits:2})}`;
          const chip = p => `<span class="px-2.5 py-1 rounded-full text-xs font-normal ${p>=0?'bg-green-100 text-green-700':'bg-red-100 text-red-700'}">${p>=0?'↑':'↓'} ${Math.abs(p).toFixed(2)}%</span>`;
          const logo = (t,bg) => `<div class="w-10 h-10 rounded-full flex items-center justify-center text-white font-normal" style="background:${bg}">${t[0]}</div>`;
          track.innerHTML = holdings.map(h=>`
            <article class="min-w-[280px] max-w-[280px] snap-start bg-white border border-slate-200 rounded-2xl p-5 flex justify-between items-center">
              <div class="flex items-center gap-3">${logo(h.ticker,h.bg)}
                <div><div class="text-sm font-normal">${h.ticker}</div><div class="text-xs text-slate-500">${h.name}</div></div>
              </div>
              <div class="text-right"><div class="text-lg font-normal">${fmt(h.price)}</div><div class="mt-2">${chip(h.pct)}</div></div>
            </article>`).join('');
          const CARD_W = 284;
          document.getElementById('hold-prev').onclick = () => track.scrollBy({ left: -CARD_W, behavior:'smooth' });
          document.getElementById('hold-next').onclick = () => track.scrollBy({ left: CARD_W, behavior:'smooth' });

          const alloc = [{label:'Stocks',pct:56,color:'#111827'},{label:'ETFs',pct:22,color:'#2563eb'},{label:'Crypto',pct:17,color:'#16a34a'},{label:'Cash',pct:5,color:'#f59e0b'}];
          const wrap = document.getElementById('asset-allocation');
          wrap.innerHTML = alloc.map(i=>`
            <div>
              <div class="flex items-center justify-between mb-1.5"><span class="text-sm text-slate-700">${i.label}</span><span class="text-sm font-medium">${i.pct}%</span></div>
              <div class="h-2.5 w-full rounded-full bg-slate-100 overflow-hidden"><div class="h-full rounded-full" style="width:${i.pct}%; background:${i.color}"></div></div>
            </div>`).join('');
        })();

        // Allocation flow math + toast
        (function(){
          const nameEl  = document.getElementById('alloc-name');
          const priceEl = document.getElementById('alloc-price');
          const unitsEl = document.getElementById('alloc-units');
          const totalEl = document.getElementById('alloc-total');
          const btn     = document.getElementById('alloc-btn');
          const toast   = document.getElementById('alloc-toast');
          const tStrat  = document.getElementById('toast-strat');
          const tUnits  = document.getElementById('toast-units');
          const tPrice  = document.getElementById('toast-price');

          const fmtUSD = n => '$' + (Number(n)||0).toLocaleString(undefined,{minimumFractionDigits:2, maximumFractionDigits:2});
          function refresh(){ totalEl.textContent = fmtUSD((Number(priceEl.value)||0) * (Number(unitsEl.value)||0)); }
          unitsEl.addEventListener('input', refresh); refresh();

          btn.addEventListener('click', () => {
            tStrat.textContent = (nameEl.value || '—');
            tUnits.textContent = Number(unitsEl.value||0).toLocaleString();
            tPrice.textContent = fmtUSD(priceEl.value||0);
            toast.classList.remove('hidden');
            setTimeout(()=> toast.classList.add('hidden'), 3500);
          });
        })();

        // Portfolio mini line
        (function(){
          const ctxEl = document.getElementById('pf-chart'); if(!ctxEl) return;
          const ctx = ctxEl.getContext('2d');
          const gradient = ctx.createLinearGradient(0,0,0,260);
          gradient.addColorStop(0,'rgba(85,107,47,0.35)');
          gradient.addColorStop(1,'rgba(85,107,47,0.06)');
          const chart = new Chart(ctx,{ type:'line', data:{ labels:Array.from({length:30},(_,i)=>i+1), datasets:[{ data:Array.from({length:30},()=>0), tension:.35, borderWidth:2, borderColor:'#556B2F', backgroundColor:gradient, fill:true, pointRadius:0 }] },
            options:{ responsive:true, maintainAspectRatio:false, plugins:{ legend:{display:false}, tooltip:{displayColors:false} }, scales:{ x:{display:false}, y:{display:true, ticks:{color:'#94a3b8', maxTicksLimit:3}} } }});
          document.getElementById('pf-updated').textContent = new Date().toLocaleString('en-ZA',{month:'long',day:'2-digit',hour:'2-digit',minute:'2-digit'})+' SAST';
          document.getElementById('pf-value').textContent = '$0.00';
          const chg=document.getElementById('pf-change'); chg.textContent='+0.00%'; chg.style.color='#16a34a';
          document.getElementById('pf-refresh').addEventListener('click', (e)=>{ e.currentTarget.classList.add('spin'); setTimeout(()=> e.currentTarget.classList.remove('spin'), 600); });
        })();

        // Calendar Returns
        (function(){
          const R = {
            2019:{Jan:0.5, Feb:0.3, Mar:0.8, Apr:1.1, May:-0.9, Jun:0.6, Jul:0.8, Aug:0.9, Sep:-0.4, Oct:1.0, Nov:0.7, Dec:0.9, YTD:6.0},
            2020:{Jan:0.4, Feb:-2.2, Mar:-6.3, Apr:3.7, May:2.1, Jun:1.0, Jul:1.1, Aug:1.4, Sep:0.7, Oct:0.9, Nov:1.1, Dec:1.2, YTD:4.8},
            2021:{Jan:0.9, Feb:0.7, Mar:0.8, Apr:1.2, May:0.5, Jun:0.4, Jul:0.8, Aug:1.0, Sep:0.9, Oct:-0.8, Nov:1.0, Dec:0.9, YTD:8.0},
            2022:{Jan:1.0, Feb:-0.9, Mar:0.8, Apr:1.2, May:0.5, Jun:-2.2, Jul:0.9, Aug:2.1, Sep:-0.5, Oct:1.5, Nov:0.6, Dec:1.1, YTD:5.8},
            2023:{Jan:0.7, Feb:0.9, Mar:-0.7, Apr:1.3, May:2.0, Jun:0.4, Jul:1.2, Aug:0.8, Sep:1.5, Oct:-0.8, Nov:1.1, Dec:0.9, YTD:9.0},
            2024:{Jan:1.0, Feb:0.6, Mar:0.5, Apr:0.9, May:0.8, Jun:0.9, Jul:0.3, Aug:0.5, Sep:1.0, Oct:0.7, Nov:0.8, Dec:0.9, YTD:8.6}
          };
          const months=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec','YTD'];
          const years=Object.keys(R).map(Number).sort((a,b)=>a-b);
          const grid=document.getElementById('calendarReturns'); if(!grid) return;
          grid.style.gridTemplateColumns = `120px repeat(${years.length}, minmax(72px,1fr))`;
          const corner=document.createElement('div'); corner.className='cal-head'; grid.appendChild(corner);
          years.forEach(y=>{ const h=document.createElement('div'); h.className='cal-head justify-center'; h.textContent=y; grid.appendChild(h); });
          const color = (v)=> v==null?'#e5e7eb': v>=1.5?'#bbf7d0': v>0?'#dcfce7': v===0?'#f1f5f9': v>-1?'#fee2e2':'#fecaca';
          months.forEach(m=>{
            const ml=document.createElement('div'); ml.className='cal-head'; ml.textContent=m; grid.appendChild(ml);
            years.forEach(y=>{
              const v=R[y]?.[m]; const c=document.createElement('div'); c.className='cal-cell'; c.style.background=color(v); c.textContent=(v||v===0)?`${v>0?'+':''}${v.toFixed(1)}%`:'—'; grid.appendChild(c);
            });
          });
          document.getElementById('legNeg').style.background='#fecaca';
          document.getElementById('legNeu').style.background='#f1f5f9';
          document.getElementById('legPos').style.background='#dcfce7';
        })();
      </script>
    </main>
  </div>

  <!-- Profile Modal -->
  <div id="profile-modal" class="fixed inset-0 z-[100] hidden">
    <div class="absolute inset-0 bg-black/40"></div>
    <div class="absolute right-6 top-20 w-64 rounded-2xl bg-white shadow-xl border border-slate-200 overflow-hidden">
      <div class="px-4 py-3 border-b border-slate-200">
        <div class="text-sm font-semibold text-slate-900">Account</div>
        <div id="pm-email" class="text-xs text-slate-500 truncate">—</div>
      </div>
      <div class="p-2">
        <a id="pm-profile" href="/settings.html#basic" class="w-full flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-slate-50">
          <i class="fa-regular fa-user text-slate-500 w-4"></i><span>Profile settings</span>
        </a>
        <button id="pm-logout" class="w-full flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-slate-50 text-rose-700">
          <i class="fa-solid fa-right-from-bracket w-4"></i><span>Log out</span>
        </button>
      </div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/js/all.min.js" defer></script>

  <!-- Sidebar collapse memory -->
  <script>
    (function(){
      const layout=document.getElementById('layout'); const aside=document.getElementById('ah-sidebar'); const btn=document.getElementById('ah-collapse');
      const saved=localStorage.getItem('ah_collapsed')==='true'; if(saved){ aside.setAttribute('data-collapsed','true'); layout.classList.add('is-collapsed'); }
      btn.addEventListener('click',()=>{ const isCollapsed=aside.getAttribute('data-collapsed')==='true';
        if(!isCollapsed) aside.querySelectorAll('details[open]').forEach(d=>d.removeAttribute('open'));
        aside.setAttribute('data-collapsed', String(!isCollapsed)); layout.classList.toggle('is-collapsed', !isCollapsed);
        localStorage.setItem('ah_collapsed', String(!isCollapsed)); layout.offsetHeight; window.dispatchEvent(new Event('resize')); });
    })();
  </script>

  <!-- Supabase profile load (name, avatar, masked account) -->
  <script type="module">
    import { supabase } from "/js/supabase.js";
    const $ = (q, el=document)=> el.querySelector(q);
    const maskId = (uuid)=> uuid ? `••• ${String(uuid).slice(-4)}` : '—';

    (function wireProfileMenu(){
      const pm = $('#profile-modal'); const btn = $('#hdr-profile-btn'); const logoutBtn = $('#pm-logout');
      btn?.addEventListener('click', ()=> pm?.classList.toggle('hidden'));
      pm?.addEventListener('click', (e)=>{ if(e.target===pm) pm.classList.add('hidden'); });
      logoutBtn?.addEventListener('click', async ()=>{ await supabase.auth.signOut(); location.replace('/auth.html?tab=in'); });
    })();

    (async ()=>{
      const { data:{ session } } = await supabase.auth.getSession();
      if(!session) return;
      const { data:{ user } } = await supabase.auth.getUser();

      let profile=null;
      try{
        const { data, error } = await supabase.from('profiles')
          .select('full_name, first_name, last_name, avatar_url')
          .eq('id', user.id).maybeSingle();
        if(!error) profile=data;
      }catch{}

      const bestName = [
        profile?.full_name,
        [profile?.first_name, profile?.last_name].filter(Boolean).join(' '),
        user?.user_metadata?.full_name,
        [user?.user_metadata?.first_name, user?.user_metadata?.last_name].filter(Boolean).join(' '),
        user?.user_metadata?.name
      ].find(s=>s&&String(s).trim()) || '—';

      $('#hdr-name').textContent = bestName;
      $('#pm-email').textContent = bestName;

      const avatarUrl = profile?.avatar_url || user?.user_metadata?.avatar_url;
      const img = $('#hdr-avatar');
      if(avatarUrl){ img.src = avatarUrl; }
      else{
        const initial = (bestName.match(/[A-Za-z]/)?.[0] || '?').toUpperCase();
        const svg = encodeURIComponent(`<svg xmlns='http://www.w3.org/2000/svg' width='72' height='72'>
          <rect width='100%' height='100%' rx='8' ry='8' fill='#111827'/>
          <text x='50%' y='54%' text-anchor='middle' dominant-baseline='middle' font-family='Inter' font-size='36' fill='#fff'>${initial}</text>
        </svg>`);
        img.src = `data:image/svg+xml;utf8,${svg}`;
      }

      try{
        const { data:accts } = await supabase.from('investment_accounts')
          .select('id,status,updated_at').eq('profile_id', user.id)
          .order('status',{ascending:true}).order('updated_at',{ascending:false});
        const active = accts?.find(a=>a.status==='ACTIVE') || accts?.[0] || null;
        const badge = $('#sidebar-acc'); if(badge){ badge.textContent = maskId(active?.id); badge.title=active?.id||''; }
      }catch{}
    })();
  </script>
</body>
</html>
