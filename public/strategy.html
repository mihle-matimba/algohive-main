<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AlgoHive — Dashboard (100vh, Split Layout)</title>

  <!-- Tailwind + Fonts + Icons -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>

  <style>
    :root{ --olive:#556B2F; --olive-700:#3e4f23; --olive-100:#ecf4e6; --page:#f7f8fb }
    html,body{ height:100%; overflow:hidden; font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif; background:var(--page); color:#0f172a }
    .card{ @apply bg-white rounded-2xl shadow-sm border border-black/10; }
    .pill{ @apply inline-flex items-center justify-center gap-2 rounded-full border border-black/10 bg-white px-3 py-1.5 text-xs font-medium; }
    .pill-muted{ @apply inline-flex items-center gap-2 rounded-full bg-emerald-50 text-emerald-700 px-2.5 py-1 text-[11px] font-medium; }
    .muted{ @apply text-slate-500; }
    /* Calendar Returns */
    .cal-grid{ display:grid; grid-auto-rows:minmax(36px,auto); }
    .cal-cell{ @apply text-[12px] md:text-sm font-medium rounded-lg border border-black/5 flex items-center justify-center; }
    .cal-head{ @apply text-xs md:text-sm font-semibold text-slate-500; }
    .tooltip{ position:absolute; pointer-events:none; transform:translate(-50%,-110%); }
  </style>
</head>
<body>
  <div id="app" class="h-[100svh] w-full flex overflow-hidden">

    <!-- MAIN SCROLL AREA (left content + right rail + settings column) -->
    <main class="flex-1 min-w-0 overflow-y-auto overflow-x-hidden">
      <div class="mx-auto max-w-7xl px-4 md:px-6 py-6">
        <!-- Greeting -->
        <header class="mb-4 flex items-start justify-between gap-3">
          <div>
            <h1 class="text-3xl md:text-4xl font-extrabold tracking-tight">Good <span id="greetTime">afternoon</span>, <span id="greetName">Mihle Matimba</span></h1>
            <p class="muted mt-1">Your strategy-driven performance, risk and activity at a glance.</p>
          </div>
          <!-- profile quick card -->
          <div class="hidden md:flex items-center gap-3 card p-2">
            <img id="avatar" class="h-10 w-10 rounded-full object-cover bg-slate-100" alt="Profile" src=""/>
            <div class="min-w-0">
              <div id="quickName" class="text-sm font-semibold truncate">Mihle Matimba</div>
              <div id="quickEmail" class="text-xs muted truncate">—</div>
            </div>
            <button id="openSettingsBtn" class="pill"><i class="fa-solid fa-gear"></i> Settings</button>
          </div>
        </header>

        <!-- Split grid: main canvas + right rail + settings column -->
        <div class="grid grid-cols-1 xl:grid-cols-4 gap-4">
          <!-- LEFT: MAIN CANVAS (2 cols) -->
          <section class="xl:col-span-2 space-y-4">
            <!-- Equity Curve block -->
            <div class="card p-4">
              <div class="flex items-start justify-between gap-3">
                <div>
                  <div class="font-semibold">Equity Curve — <span class="muted">—</span></div>
                  <div class="text-2xl md:text-3xl font-extrabold mt-1">No data found <span class="pill-muted">—</span></div>
                </div>
                <!-- kept for later wiring -->
                <div id="rangeSeg" role="tablist" aria-label="Time range" class="inline-flex rounded-full border border-black/10 bg-white p-1">
                  <button class="px-3 py-1.5 text-xs font-medium rounded-full" role="tab" data-range="1M" aria-selected="true">1M</button>
                  <button class="px-3 py-1.5 text-xs font-medium rounded-full" role="tab" data-range="3M">3M</button>
                  <button class="px-3 py-1.5 text-xs font-medium rounded-full" role="tab" data-range="6M">6M</button>
                  <button class="px-3 py-1.5 text-xs font-medium rounded-full" role="tab" data-range="YTD">YTD</button>
                  <button class="px-3 py-1.5 text-xs font-medium rounded-full" role="tab" data-range="1Y">1Y</button>
                  <button class="px-3 py-1.5 text-xs font-medium rounded-full" role="tab" data-range="3Y">3Y</button>
                </div>
              </div>

              <!-- Chart placeholder -->
              <div class="mt-4">
                <div class="h-64 md:h-72 w-full rounded-xl border border-black/10 bg-white grid place-items-center muted">
                  No data found
                </div>
                <div class="mt-4 flex justify-end">
                  <button class="pill"><i class="fa-solid fa-plus"></i> Add Benchmark</button>
                </div>
              </div>
            </div>

            <!-- NEW: Allocation Flow -->
            <div class="card p-4">
              <div class="flex items-center justify-between gap-3">
                <div class="font-semibold">Allocate to Strategy</div>
                <span class="pill-muted"><i class="fa-solid fa-circle-info"></i> Demo flow</span>
              </div>

              <div class="mt-3 grid grid-cols-1 sm:grid-cols-2 gap-3">
                <div>
                  <label class="text-xs muted">Strategy</label>
                  <select id="allocStrategy" class="mt-1 w-full rounded-xl border border-black/10 px-3 py-2 text-sm">
                    <option value="Nasdaq Momentum">Nasdaq Momentum</option>
                    <option value="USDJPY Hedge">USDJPY Hedge</option>
                    <option value="ZA Equities Long-Only">ZA Equities Long-Only</option>
                  </select>
                </div>
                <div>
                  <label class="text-xs muted">Unit Price</label>
                  <div class="mt-1 flex items-center gap-2">
                    <span class="text-sm font-semibold">USD</span>
                    <input id="unitPrice" type="number" step="0.01" value="100.00" class="w-full rounded-xl border border-black/10 px-3 py-2 text-sm">
                  </div>
                </div>
                <div>
                  <label class="text-xs muted">Units</label>
                  <input id="unitsWanted" type="number" min="1" value="10" class="mt-1 w-full rounded-xl border border-black/10 px-3 py-2 text-sm">
                </div>
                <div>
                  <label class="text-xs muted">Total (excl. fees)</label>
                  <div class="mt-1 text-xl font-extrabold" id="allocTotal">USD 1,000.00</div>
                </div>
              </div>

              <div class="mt-3 grid grid-cols-1 sm:grid-cols-3 gap-3">
                <div class="rounded-xl border border-black/10 p-3">
                  <div class="text-xs muted">Mgmt Fee</div>
                  <div class="font-semibold" id="mgmtFee">—</div>
                </div>
                <div class="rounded-xl border border-black/10 p-3">
                  <div class="text-xs muted">Perf Fee</div>
                  <div class="font-semibold" id="perfFee">—</div>
                </div>
                <div class="rounded-xl border border-black/10 p-3">
                  <div class="text-xs muted">Est. First Charge</div>
                  <div class="font-semibold" id="estFirstCharge">—</div>
                </div>
              </div>

              <div class="mt-4 flex items-center justify-between">
                <div class="flex items-center gap-2">
                  <label class="text-xs muted">Funding Method</label>
                  <select id="fundingMethod" class="ml-2 rounded-full border border-black/10 px-3 py-1.5 text-xs">
                    <option>Wire / EFT</option>
                    <option>Card</option>
                    <option>Internal Cash</option>
                  </select>
                </div>
                <div class="flex items-center gap-2">
                  <button id="allocBtn" class="pill bg-[var(--olive-100)] text-[var(--olive-700)] hover:shadow"><i class="fa-solid fa-circle-plus"></i> Allocate</button>
                </div>
              </div>

              <!-- tiny confirm toast -->
              <div id="allocToast" class="hidden mt-3 rounded-xl border border-emerald-200 bg-emerald-50 p-3 text-emerald-800 text-sm">
                <i class="fa-solid fa-check mr-2"></i> Allocation submitted for <span id="toastStrategy">—</span> • <span id="toastUnits">—</span> units at <span id="toastPrice">—</span>.
              </div>
            </div>

            <!-- Performance Summary + Calendar Returns -->
            <div class="card p-4">
              <div class="font-semibold mb-3">Performance Summary — <span class="muted">Calendar Returns</span></div>

              <!-- Headers -->
              <div class="overflow-x-auto">
                <div id="calendarReturns" class="cal-grid"></div>
                <div class="mt-3 flex items-center gap-3 text-xs">
                  <span class="inline-block w-5 h-3 rounded" id="legNeg"></span> <span class="muted">Negative</span>
                  <span class="inline-block w-5 h-3 rounded" id="legNeu"></span> <span class="muted">Flat</span>
                  <span class="inline-block w-5 h-3 rounded" id="legPos"></span> <span class="muted">Positive</span>
                </div>
              </div>
            </div>
          </section>

          <!-- MIDDLE RIGHT RAIL (1 col) -->
          <aside class="space-y-4">
            <!-- My Strategies -->
            <div class="card p-4">
              <div class="flex items-center justify-between">
                <div class="font-semibold">My Strategies</div>
                <a class="text-sm font-medium text-[var(--olive-700)] hover:underline" href="#">View OpenStrategies</a>
              </div>
              <div class="mt-3 h-28 rounded-xl border border-black/10 grid place-items-center muted">No data found</div>
            </div>

            <!-- Balance -->
            <div class="card p-4">
              <div class="grid grid-cols-2 gap-3">
                <div class="rounded-xl border border-black/10 p-3">
                  <div class="text-xs muted">Total Balance</div>
                  <div class="text-xl font-bold">—</div>
                </div>
                <div class="rounded-xl border border-black/10 p-3">
                  <div class="text-xs muted">Cash Available</div>
                  <div class="text-xl font-bold">—</div>
                </div>
              </div>
            </div>

            <!-- Strategy Rating -->
            <div class="card p-4">
              <div class="font-semibold">Strategy Rating — <span class="muted">—</span></div>
              <div class="mt-2 grid grid-cols-3 gap-3 items-center">
                <div class="col-span-1 muted text-sm">No data found</div>
                <div class="col-span-2">
                  <div class="text-2xl font-extrabold">No data found</div>
                  <div class="muted text-sm">Overall rating performance</div>
                  <div class="pill-muted mt-2"><i class="fa-solid fa-minus"></i> From last year</div>
                </div>
              </div>
            </div>

            <!-- Financial Health -->
            <div class="card p-4">
              <div class="flex items-center justify-between">
                <div class="font-semibold">Financial Health</div>
                <a class="text-sm font-medium text-[var(--olive-700)] hover:underline" href="#">View Financial Tracker</a>
              </div>
              <div class="mt-3 space-y-3">
                <div>
                  <div class="text-xs muted">Health Score</div>
                  <div class="flex items-center gap-2 mt-1">
                    <span class="h-2 flex-1 rounded-full bg-slate-200 overflow-hidden"><span class="block w-1/5 h-full bg-emerald-400"></span></span>
                    <span class="text-sm muted">No data</span>
                  </div>
                </div>
                <div class="rounded-xl border border-black/10 p-3 grid grid-cols-2 gap-3">
                  <div>
                    <div class="text-xs muted">Income</div>
                    <div class="font-semibold">—</div>
                  </div>
                  <div>
                    <div class="text-xs muted">Expenses</div>
                    <div class="font-semibold">—</div>
                  </div>
                </div>
              </div>
            </div>
          </aside>

          <!-- FAR RIGHT: SETTINGS COLUMN (toggle) -->
          <aside id="settingsCol" class="space-y-4 hidden xl:block">
            <div class="card p-4">
              <div class="flex items-center justify-between">
                <div class="font-semibold">Profile</div>
                <button class="pill" id="closeSettingsBtn"><i class="fa-solid fa-xmark"></i> Close</button>
              </div>
              <div class="mt-3 flex items-center gap-3">
                <img id="avatarBig" class="h-16 w-16 rounded-2xl object-cover bg-slate-100" alt="Avatar" src=""/>
                <div>
                  <div id="profileName" class="text-lg font-bold">Mihle Matimba</div>
                  <div id="profileEmail" class="muted text-sm">—</div>
                </div>
              </div>
              <div class="mt-3">
                <label class="text-xs muted">Update photo</label>
                <input id="avatarInput" type="file" accept="image/*" class="mt-1 block w-full text-sm" />
              </div>
            </div>

            <div class="card p-4">
              <div class="font-semibold">Account Settings</div>
              <div class="mt-3 space-y-3">
                <div>
                  <label class="text-xs muted">Display Name</label>
                  <input id="nameInput" class="mt-1 w-full rounded-xl border border-black/10 px-3 py-2 text-sm" placeholder="Your name"/>
                </div>
                <div>
                  <label class="text-xs muted">Timezone</label>
                  <select id="tzSelect" class="mt-1 w-full rounded-xl border border-black/10 px-3 py-2 text-sm">
                    <option value="Africa/Johannesburg">Africa/Johannesburg (SAST)</option>
                    <option value="UTC">UTC</option>
                    <option value="America/New_York">America/New_York</option>
                    <option value="Europe/London">Europe/London</option>
                  </select>
                </div>
                <div class="flex items-center justify-between">
                  <span class="text-sm">Dark Mode</span>
                  <label class="inline-flex items-center cursor-pointer">
                    <input id="darkToggle" type="checkbox" class="sr-only">
                    <span class="w-10 h-6 bg-slate-200 rounded-full p-1 flex items-center"><span class="w-4 h-4 bg-white rounded-full transition"></span></span>
                  </label>
                </div>
                <div class="flex items-center justify-between">
                  <span class="text-sm">Email Notifications</span>
                  <label class="inline-flex items-center cursor-pointer">
                    <input id="emailToggle" type="checkbox" class="sr-only" checked>
                    <span class="w-10 h-6 bg-slate-200 rounded-full p-1 flex items-center"><span class="w-4 h-4 bg-white rounded-full transition"></span></span>
                  </label>
                </div>
                <button class="pill w-full justify-center"><i class="fa-regular fa-floppy-disk"></i> Save</button>
              </div>
            </div>
          </aside>
        </div>
      </div>
    </main>
  </div>

  <script>
    // Greeting logic
    (function(){
      const name = 'Mihle Matimba'; // replace from auth when wired
      const hour = new Date().getHours();
      const greet = hour < 12 ? 'morning' : hour < 17 ? 'afternoon' : 'evening';
      document.getElementById('greetTime').textContent = greet;
      document.getElementById('greetName').textContent = name;
      document.getElementById('quickName').textContent = name;
      document.getElementById('profileName').textContent = name;
    })();

    // Avatar fallbacks
    function initialsSVG(name){
      const initials = (name||'GU').split(' ').map(s=>s[0]?.toUpperCase()).slice(0,2).join('') || 'GU';
      const svg = `<svg xmlns='http://www.w3.org/2000/svg' width='96' height='96'>
        <rect width='100%' height='100%' fill='#ecf4e6'/>
        <text x='50%' y='54%' dominant-baseline='middle' text-anchor='middle' font-size='36' font-family='Inter' fill='#3e4f23'>${initials}</text>
      </svg>`;
      return 'data:image/svg+xml;utf8,' + encodeURIComponent(svg);
    }
    const fallback = initialsSVG('Mihle Matimba');
    ['avatar','avatarBig'].forEach(id=>{ const el=document.getElementById(id); if(el) el.src = fallback; });

    // Open/close settings column
    const settingsCol = document.getElementById('settingsCol');
    document.getElementById('openSettingsBtn')?.addEventListener('click', ()=> settingsCol.classList.remove('hidden'));
    document.getElementById('closeSettingsBtn')?.addEventListener('click', ()=> settingsCol.classList.add('hidden'));

    // Avatar uploader preview (local only)
    document.getElementById('avatarInput')?.addEventListener('change', (e)=>{
      const file = e.target.files?.[0];
      if(!file) return;
      const url = URL.createObjectURL(file);
      const small = document.getElementById('avatar');
      const big = document.getElementById('avatarBig');
      if(small) small.src = url;
      if(big) big.src = url;
    });

    // Dark mode toggle (demo)
    const darkToggle = document.getElementById('darkToggle');
    if(darkToggle){
      darkToggle.addEventListener('change', ()=>{
        document.documentElement.classList.toggle('dark');
        document.body.style.background = darkToggle.checked ? '#0b0f14' : 'var(--page)';
      });
    }

    // Segmented control styling
    const seg = document.getElementById('rangeSeg');
    function styleSeg(btn){
      seg.querySelectorAll('button').forEach(b=>{
        b.classList.remove('bg-[var(--olive-100)]','text-[var(--olive-700)]','shadow');
        b.setAttribute('aria-selected','false');
      });
      btn.classList.add('bg-[var(--olive-100)]','text-[var(--olive-700)]','shadow');
      btn.setAttribute('aria-selected','true');
    }
    if(seg){
      const first = seg.querySelector('button[data-range="1M"]');
      if(first) styleSeg(first);
      seg.querySelectorAll('button').forEach(b=> b.addEventListener('click', ()=> styleSeg(b)));
    }

    // ===== Allocation Flow Logic =====
    const fmt = (n)=> 'USD ' + (Number(n)||0).toLocaleString(undefined,{minimumFractionDigits:2, maximumFractionDigits:2});
    function refreshAlloc(){
      const price = parseFloat(document.getElementById('unitPrice').value||0);
      const units = parseFloat(document.getElementById('unitsWanted').value||0);
      const total = price * units;
      document.getElementById('allocTotal').textContent = fmt(total);
      // Example fee placeholders (can wire real fee schedule later)
      document.getElementById('mgmtFee').textContent = '1.0% p.a.';
      document.getElementById('perfFee').textContent = '20% over HWM';
      document.getElementById('estFirstCharge').textContent = fmt(0);
    }
    ['unitPrice','unitsWanted'].forEach(id=> document.getElementById(id).addEventListener('input', refreshAlloc));
    refreshAlloc();

    document.getElementById('allocBtn').addEventListener('click', ()=>{
      const strat = document.getElementById('allocStrategy').value;
      const price = parseFloat(document.getElementById('unitPrice').value||0);
      const units = parseFloat(document.getElementById('unitsWanted').value||0);
      document.getElementById('toastStrategy').textContent = strat;
      document.getElementById('toastUnits').textContent = units.toLocaleString();
      document.getElementById('toastPrice').textContent = fmt(price);
      const toast = document.getElementById('allocToast');
      toast.classList.remove('hidden');
      setTimeout(()=> toast.classList.add('hidden'), 3500);
    });

    // ===== Calendar Returns (Months as rows, Years as cols) =====
    const returns = {
      2019:{Jan:0.5, Feb:0.3, Mar:0.8, Apr:1.1, May:-0.9, Jun:0.6, Jul:0.8, Aug:0.9, Sep:-0.4, Oct:1.0, Nov:0.7, Dec:0.9, YTD:6.0},
      2020:{Jan:0.4, Feb:-2.2, Mar:-6.3, Apr:3.7, May:2.1, Jun:1.0, Jul:1.1, Aug:1.4, Sep:0.7, Oct:0.9, Nov:1.1, Dec:1.2, YTD:4.8},
      2021:{Jan:0.9, Feb:0.7, Mar:0.8, Apr:1.2, May:0.5, Jun:0.4, Jul:0.8, Aug:1.0, Sep:0.9, Oct:-0.8, Nov:1.0, Dec:0.9, YTD:8.0},
      2022:{Jan:1.0, Feb:-0.9, Mar:0.8, Apr:1.2, May:0.5, Jun:-2.2, Jul:0.9, Aug:2.1, Sep:-0.5, Oct:1.5, Nov:0.6, Dec:1.1, YTD:5.8},
      2023:{Jan:0.7, Feb:0.9, Mar:-0.7, Apr:1.3, May:2.0, Jun:0.4, Jul:1.2, Aug:0.8, Sep:1.5, Oct:-0.8, Nov:1.1, Dec:0.9, YTD:9.0},
      2024:{Jan:1.0, Feb:0.6, Mar:0.5, Apr:0.9, May:0.8, Jun:0.9, Jul:0.3, Aug:0.5, Sep:1.0, Oct:0.7, Nov:0.8, Dec:0.9, YTD:8.6}
    };
    const months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec','YTD'];
    const years = Object.keys(returns).map(y=>Number(y)).sort((a,b)=>a-b);

    const grid = document.getElementById('calendarReturns');
    // Build grid template: first col = month labels
    grid.style.gridTemplateColumns = `120px repeat(${years.length}, minmax(72px,1fr))`;
    // Top-left empty cell
    const corner = document.createElement('div');
    corner.className = 'cal-head flex items-center';
    corner.textContent = '';
    grid.appendChild(corner);
    // Year headers
    years.forEach(y=>{
      const h = document.createElement('div');
      h.className = 'cal-head flex items-center justify-center';
      h.textContent = y;
      grid.appendChild(h);
    });
    // Month rows
    months.forEach(m=>{
      const ml = document.createElement('div');
      ml.className = 'cal-head flex items-center';
      ml.textContent = m;
      grid.appendChild(ml);
      years.forEach(y=>{
        const v = returns[y]?.[m];
        const cell = document.createElement('div');
        cell.className = 'cal-cell';
        cell.textContent = (v||v===0) ? `${v>0?'+':''}${v.toFixed(1)}%` : '—';
        // color scale
        const c = (val)=>{
          if(val==null) return '#e5e7eb';
          if(val >= 1.5) return '#bbf7d0';  // light green
          if(val > 0)   return '#dcfce7';  // pale green
          if(val === 0) return '#f1f5f9';
          if(val > -1)  return '#fee2e2';  // pale red
          return '#fecaca';                // deeper red
        };
        cell.style.background = c(v);
        grid.appendChild(cell);
      });
    });
    // legend chips
    document.getElementById('legNeg').style.background = '#fecaca';
    document.getElementById('legNeu').style.background = '#f1f5f9';
    document.getElementById('legPos').style.background = '#dcfce7';
  </script>
</body>
</html>
