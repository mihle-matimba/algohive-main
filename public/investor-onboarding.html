<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Investor Onboarding | AlgoHive</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com" nonce="ALGOHIVE"></script>

  <!-- Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>

  <style>
    :root{
      --page:#0b1220; --bg:#0a0f1a; --muted:#8a94a7; --ink:#0f172a; --olive:#7e8d52; --brand:#f59e0b; --line:#e2e8f0;
    }

    /* page backdrop */
    body{
      background:
        radial-gradient(1200px 800px at 10% -10%, rgba(126,141,82,.15), transparent 60%),
        radial-gradient(1200px 800px at 100% 0%, rgba(255,255,255,.06), transparent 55%),
        #0b1220;
      color:#0f172a;
    }

    /* hide scrollbars, keep scrollable */
    html, body{ overflow:auto; scrollbar-width:none; -ms-overflow-style:none }
    html::-webkit-scrollbar, body::-webkit-scrollbar{ display:none }

    /* tokens */
    .text-ink{ color:var(--ink) }
    .text-muted{ color:var(--muted) }
    .border-line{ border-color:var(--line) }
    .btn-olive{ background:var(--olive); color:#fff }
    .btn-olive:hover{ filter:brightness(.92) }

    /* glass card */
    .glass{
      background:linear-gradient(180deg, rgba(255,255,255,.75), rgba(255,255,255,.6));
      backdrop-filter: blur(10px);
      border:1px solid rgba(255,255,255,.4);
      box-shadow: 0 10px 40px rgba(6,12,23,.25);
    }

    /* hero */
    .hero{
      background:
        radial-gradient(1200px 600px at 50% -10%, rgba(126,141,82,.25), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,0));
    }

    /* steps */
    .step-dot{
      width:36px; height:36px; border-radius:9999px;
      display:grid; place-items:center; font-weight:700;
      background:rgba(255,255,255,.75); border:1px solid rgba(255,255,255,.6);
      color:#0b1220;
    }
    .step-dot.active{ background:var(--olive); color:#fff; border-color:transparent }
    .step-line{ height:2px; background:rgba(255,255,255,.5) }
    .step-line.filled{ background:var(--olive) }

    /* progress */
    .progress-track{ height:8px; background:rgba(255,255,255,.2); border-radius:9999px; }
    .progress-bar{ height:8px; background:var(--olive); border-radius:9999px; transition:width .45s cubic-bezier(.2,.8,.2,1) }

    /* inputs */
    .field{
      transition: box-shadow .25s ease, transform .08s ease;
      border:1px solid #e6e9ef; background:#fbfcfe;
    }
    .field:focus{
      outline: none;
      box-shadow: 0 0 0 4px rgba(126,141,82,.15), 0 8px 24px rgba(6,12,23,.10);
      transform: translateY(-1px);
      border-color: var(--olive);
    }
    .error-message{ color:#ef4444; font-size:.875rem; margin-top:.25rem }
    .error-input{ border-color:#ef4444 !important; box-shadow:0 0 0 3px rgba(239,68,68,.15) }

    /* cards hover */
    .feature-card{ transition: transform .25s ease, box-shadow .25s ease }
    .feature-card:hover{ transform: translateY(-6px); box-shadow: 0 18px 40px rgba(6,12,23,.18) }

    /* summary */
    .summary-row{ display:flex; justify-content:space-between; margin-bottom:.5rem }
    .summary-label{ font-weight:600; color:#4b5563 }
    .summary-value{ font-weight:800; color:var(--olive) }
    .premium-badge{ background:var(--brand); color:#fff; padding:.25rem .5rem; border-radius:.375rem; font-size:.75rem; font-weight:700; margin-left:.5rem }

    /* toast */
    .success-toast{ position:fixed; bottom:20px; right:20px; background:#10b981; color:#fff; padding:14px 16px; border-radius:10px; box-shadow:0 6px 24px rgba(0,0,0,.2); display:flex; align-items:center; gap:8px; z-index:1000; animation:slideIn .25s ease-out }
    @keyframes slideIn{ from{ transform:translateX(18px); opacity:.4 } to{ transform:translateX(0); opacity:1 } }

    /* loader */
    .loading-spinner{ border:3px solid rgba(255,255,255,.35); border-radius:9999px; border-top:3px solid #fff; width:20px; height:20px; animation:spin 1s linear infinite }
    @keyframes spin{ to{ transform: rotate(360deg) } }

    /* step container visibility */
    .form-step{ display:none }
    .form-step.active{ display:block; animation:fadeIn .45s ease }
    @keyframes fadeIn{ from{opacity:0; transform:translateY(10px)} to{opacity:1; transform:none} }

    /* doc link */
    .document-link{ font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace }
  </style>
</head>
<body class="min-h-screen">

  <!-- Top nav -->
  <header class="sticky top-0 z-40 backdrop-blur supports-[backdrop-filter]:bg-white/60 bg-white/80 border-b border-white/60">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <img src="https://static.wixstatic.com/shapes/ac771e_e60a2d47ce2d4afb858cb00c0e618c9e.svg" alt="AlgoHive" class="w-8 h-8">
        <span class="text-white/90 font-semibold tracking-tight">AlgoHive Investor Portal</span>
      </div>
      <div class="hidden md:flex items-center gap-2">
        <span class="px-2 py-1 rounded bg-white/10 text-white/80 text-xs border border-white/20">Secure</span>
      </div>
    </div>

    <!-- Global progress -->
    <div class="px-4 sm:px-6 lg:px-8 pb-3">
      <div class="max-w-7xl mx-auto">
        <div class="progress-track">
          <div id="progressBar" class="progress-bar" style="width:25%"></div>
        </div>
      </div>
    </div>
  </header>

  <!-- Hero -->
  <section class="hero">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
      <!-- Stepper -->
      <div class="glass rounded-2xl p-5 md:p-6 mb-8">
        <div class="flex items-center gap-3 md:gap-4">
          <div id="dot1" class="step-dot active">1</div>
          <div id="line1" class="step-line flex-1"></div>
          <div id="dot2" class="step-dot">2</div>
          <div id="line2" class="step-line flex-1"></div>
          <div id="dot3" class="step-dot">3</div>
          <div id="line3" class="step-line flex-1"></div>
          <div id="dot4" class="step-dot">4</div>
        </div>
      </div>

      <!-- Step 1 -->
      <div id="step1" class="form-step active">
        <div class="grid lg:grid-cols-2 gap-6">
          <div class="glass rounded-2xl p-8 md:p-10">
            <div class="w-20 h-20 rounded-2xl grid place-items-center mb-6"
                 style="background: color-mix(in oklab, var(--olive) 18%, white);">
              <i class="fas fa-seedling text-white text-3xl"></i>
            </div>
            <h1 class="text-4xl md:text-5xl font-extrabold text-white mb-5 leading-tight">
              Invest in <span class="text-[var(--olive)]">AlgoHive</span>
            </h1>
            <p class="text-white/80 text-lg leading-relaxed">
              Thanks for choosing to invest. A few quick steps to confirm your details, sign, and get payment instructions.
            </p>

            <div class="mt-8 flex flex-wrap items-center gap-3">
              <button data-next class="btn-olive px-6 py-3 rounded-xl font-semibold shadow-lg shadow-[rgba(126,141,82,.25)] hover:shadow-[rgba(126,141,82,.35)] transition">
                Get Started <i class="fas fa-arrow-right ml-2"></i>
              </button>
              <span class="text-white/60 text-sm">Secure &amp; encrypted â€¢ ~4 mins</span>
            </div>
          </div>

          <div class="grid gap-6">
            <div class="feature-card glass rounded-2xl p-6">
              <div class="flex items-start gap-4">
                <div class="w-12 h-12 rounded-lg bg-white/70 grid place-items-center">
                  <i class="fas fa-shield-alt text-[var(--olive)]"></i>
                </div>
                <div>
                  <div class="text-white font-semibold">Bank-grade security</div>
                  <div class="text-white/70 text-sm mt-1">Your data and funds are protected with strict controls.</div>
                </div>
              </div>
            </div>

            <div class="feature-card glass rounded-2xl p-6">
              <div class="flex items-start gap-4">
                <div class="w-12 h-12 rounded-lg bg-white/70 grid place-items-center">
                  <i class="fas fa-chart-line text-[var(--olive)]"></i>
                </div>
                <div>
                  <div class="text-white font-semibold">Proven strategies</div>
                  <div class="text-white/70 text-sm mt-1">Access track records and performance transparently.</div>
                </div>
              </div>
            </div>

            <div class="feature-card glass rounded-2xl p-6">
              <div class="flex items-start gap-4">
                <div class="w-12 h-12 rounded-lg bg-white/70 grid place-items-center">
                  <i class="fas fa-headset text-[var(--olive)]"></i>
                </div>
                <div>
                  <div class="text-white font-semibold">Human support</div>
                  <div class="text-white/70 text-sm mt-1">Investor relations on standby if you need a hand.</div>
                </div>
              </div>
            </div>

          </div>
        </div>
      </div>

      <!-- Step 2 -->
      <div id="step2" class="form-step">
        <div class="glass rounded-2xl p-8 md:p-10">
          <div class="flex items-center justify-between gap-3">
            <h2 class="text-2xl md:text-3xl font-bold text-white">Investment Details</h2>
            <span class="px-3 py-1 rounded-lg bg-white/20 text-white text-xs border border-white/25">Step 2 of 4</span>
          </div>

          <form id="investmentForm" class="mt-8 grid gap-6">
            <div class="grid md:grid-cols-2 gap-6">
              <div>
                <label class="text-white/80 text-sm font-medium mb-2 block">Full Name <span class="text-rose-400">*</span></label>
                <input id="fullName" type="text" placeholder="John Smith" class="field w-full rounded-xl px-4 py-3"/>
                <div id="fullNameError" class="error-message hidden">Please enter your full name</div>
              </div>
              <div>
                <label class="text-white/80 text-sm font-medium mb-2 block">Email Address <span class="text-rose-400">*</span></label>
                <input id="email" type="email" placeholder="john@example.com" class="field w-full rounded-xl px-4 py-3"/>
                <div id="emailError" class="error-message hidden">Please enter a valid email address</div>
              </div>
            </div>

            <div>
              <label class="text-white/80 text-sm font-medium mb-2 block">Investment Amount (ZAR) <span class="text-rose-400">*</span></label>
              <div class="flex">
                <span class="rounded-l-xl bg-white/70 text-ink px-4 grid place-items-center border border-r-0 border-white/70">R</span>
                <input id="investmentAmount" type="number" min="300000" step="300000" value="300000" class="field rounded-r-xl w-full px-4 py-3"/>
              </div>
              <div id="amountError" class="error-message hidden">Minimum investment is R4.12</div>
              <p class="text-white/70 text-sm mt-2">Current share price: <span class="font-semibold text-white">R4.12</span> per share</p>
            </div>

            <div class="rounded-2xl bg-white/60 p-5 border border-white/70">
              <div class="text-white font-semibold text-lg mb-3">Investment Summary</div>
              <div class="summary-row"><span class="summary-label text-white/80">Investment Amount:</span><span id="summaryAmount" class="summary-value">R4.12</span></div>
              <div class="summary-row"><span class="summary-label text-white/80">Number of Shares:</span><span id="summaryShares" class="summary-value">1</span></div>
              <div class="summary-row"><span class="summary-label text-white/80">Risk Premium Shares:</span><span id="summaryPremiumShares" class="summary-value">70,929 <span class="premium-badge">FREE</span></span></div>
              <div class="summary-row"><span class="summary-label text-white/80">Total Shares:</span><span id="summaryTotalShares" class="summary-value">70,930</span></div>
              <div class="summary-row"><span class="summary-label text-white/80">Share Price:</span><span class="summary-value">R4.12</span></div>
            </div>

            <div class="rounded-2xl bg-white/60 p-5 border border-white/70">
              <div class="flex items-center gap-3 mb-3">
                <div class="w-10 h-10 rounded-lg bg-[var(--olive)]/20 text-[var(--olive)] grid place-items-center">
                  <i class="fas fa-file-signature"></i>
                </div>
                <h3 class="text-white font-semibold text-lg">Document Signing</h3>
              </div>

              <div class="rounded-lg border border-emerald-200/60 bg-emerald-50/70 p-4 mb-4">
                <div class="text-emerald-900 font-medium">How to sign:</div>
                <ul class="mt-2 text-emerald-900/90 text-sm space-y-1">
                  <li>Copy the DocuSeal link</li>
                  <li>Open it in a new tab</li>
                  <li>Complete all signatures</li>
                  <li>Return here and confirm</li>
                </ul>
              </div>

              <div class="flex items-stretch">
                <div id="documentLink" class="document-link flex-1 bg-white/80 border border-white/70 rounded-l-lg px-3 py-2 overflow-hidden text-ellipsis whitespace-nowrap">
                  https://docuseal.com/s/ZpCdfN4CnyQQrU
                </div>
                <button type="button" id="copyLinkButton" class="btn-olive rounded-r-lg px-4 text-sm font-semibold">
                  <i class="fas fa-copy mr-2"></i> Copy
                </button>
              </div>

              <div class="mt-4 flex items-start gap-3">
                <input id="docConfirmation" type="checkbox" class="mt-1 h-4 w-4 rounded border-white/70 text-[var(--olive)] focus:ring-[var(--olive)]"/>
                <div>
                  <label for="docConfirmation" class="text-white font-medium">I confirm Iâ€™ve completed signing the Investment Agreements</label>
                  <p class="text-white/70 text-sm">Please complete signing before proceeding</p>
                </div>
              </div>
              <div id="docError" class="error-message hidden mt-2">You must confirm the documents to proceed</div>
            </div>

            <div class="flex items-center justify-between pt-2">
              <button type="button" data-prev class="px-5 py-3 rounded-xl font-semibold bg-white/20 text-white hover:bg-white/30 border border-white/30 transition">
                <i class="fas fa-arrow-left mr-2"></i> Back
              </button>
              <button type="button" id="proceedBtn" class="btn-olive px-6 py-3 rounded-xl font-semibold shadow-lg shadow-[rgba(126,141,82,.25)] hover:shadow-[rgba(126,141,82,.35)] transition">
                Proceed to Payment <i class="fas fa-arrow-right ml-2"></i>
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- Step 3 -->
      <div id="step3" class="form-step">
        <div class="glass rounded-2xl p-8 md:p-10">
          <div class="flex items-center justify-between gap-3">
            <h2 class="text-2xl md:text-3xl font-bold text-white">Bank Transfer Details</h2>
            <span class="px-3 py-1 rounded-lg bg-white/20 text-white text-xs border border-white/25">Step 3 of 4</span>
          </div>

          <div class="mt-6 rounded-2xl bg-white/60 p-6 border border-white/70">
            <div class="flex flex-wrap items-center justify-between gap-3">
              <span class="text-ink font-semibold">Total Amount Due</span>
              <span id="paymentTotal" class="text-3xl font-extrabold text-[var(--olive)]">R300,000</span>
            </div>
          </div>

          <div class="grid md:grid-cols-2 gap-6 mt-8">
            <div class="rounded-2xl bg-white/60 p-6 border border-white/70">
              <h3 class="text-ink font-semibold text-lg mb-4">Bank Transfer Instructions</h3>
              <div class="space-y-3">
                <div class="flex items-center justify-between"><span class="text-muted text-sm">Bank Name</span><span class="text-ink font-semibold">Capitec Bank</span></div>
                <div class="flex items-center justify-between"><span class="text-muted text-sm">Account Name</span><span class="text-ink font-semibold">AlgoHive Business Account</span></div>
                <div class="flex items-center justify-between"><span class="text-muted text-sm">Account Number</span><span class="text-ink font-semibold">1053 0458 83</span></div>
                <div class="flex items-center justify-between"><span class="text-muted text-sm">Branch Code</span><span class="text-ink font-semibold">470010</span></div>
                <div class="flex items-center justify-between"><span class="text-muted text-sm">Reference</span><span id="bankReference" class="text-ink font-semibold">INV-<span id="emailRef">[Your Email]</span></span></div>
              </div>
              <p class="text-muted text-sm mt-4">Use the reference above. EFTs typically clear in 1â€“2 business days.</p>

              <button id="downloadPdfBtn" class="mt-6 w-full btn-olive px-5 py-3 rounded-xl font-semibold shadow hover:shadow-lg transition">
                <i class="fas fa-download mr-2"></i> Download Bank Confirmation PDF
              </button>
            </div>

            <div class="rounded-2xl bg-white/40 p-6 border border-white/60">
              <div class="h-full rounded-xl border border-dashed border-white/60 bg-gradient-to-br from-white/30 to-white/10 p-6 flex flex-col items-start justify-between">
                <div>
                  <div class="text-ink font-semibold mb-1">What happens next?</div>
                  <p class="text-muted text-sm">Weâ€™ll verify your payment and email a receipt. Youâ€™ll get access within 24 hours of clearance.</p>
                </div>
                <div class="mt-6 flex gap-3 w-full">
                  <button type="button" data-prev class="flex-1 px-5 py-3 rounded-xl font-semibold bg-white/50 text-ink hover:bg-white/70 transition">
                    <i class="fas fa-arrow-left mr-2"></i> Back
                  </button>
                  <button type="button" id="completePaymentBtn" class="flex-1 btn-olive px-5 py-3 rounded-xl font-semibold shadow hover:shadow-lg transition">
                    Iâ€™ve Completed Payment <i class="fas fa-check ml-2"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>

        </div>
      </div>

      <!-- Step 4 -->
      <div id="step4" class="form-step">
        <div class="glass rounded-2xl p-8 md:p-10">
          <div class="text-center max-w-2xl mx-auto">
            <div class="w-24 h-24 rounded-full bg-emerald-100 grid place-items-center mx-auto mb-6">
              <i class="fas fa-check text-emerald-600 text-4xl"></i>
            </div>
            <h2 class="text-3xl md:text-4xl font-extrabold text-white mb-3">Thank You for Your Investment!</h2>
            <p class="text-white/80 text-lg">
              Your investment of <span id="confirmationAmount" class="font-bold text-[var(--olive)]">R4.12</span> for
              <span id="confirmationShares" class="font-bold text-[var(--olive)]">1</span> shares plus
              <span id="confirmationPremiumShares" class="font-bold text-[var(--olive)]">70,929</span> Risk Premium shares has been received.
            </p>
            <p class="text-white mt-2">Total shares: <span id="confirmationTotalShares" class="font-extrabold text-[var(--olive)]">70,930</span></p>

            <div class="mt-8 rounded-2xl bg-white/70 p-6 border border-white/80">
              <div class="text-ink font-semibold mb-2">Your Transaction ID</div>
              <div id="finalTransactionId" class="document-link text-center text-xl bg-white/80 border border-white/80 rounded-lg px-4 py-3">INV-ABC123</div>
              <p class="text-muted text-sm mt-2">Keep this ID for your records.</p>
            </div>

            <div class="mt-8 flex flex-col sm:flex-row items-center justify-center gap-3">
              <button id="downloadPdfBtn2" class="btn-olive px-5 py-3 rounded-xl font-semibold shadow hover:shadow-lg transition">
                <i class="fas fa-download mr-2"></i> Download PDF Again
              </button>
              <button id="resetBtn" class="px-5 py-3 rounded-xl font-semibold bg-white/20 text-white hover:bg-white/30 border border-white/25 transition">
                <i class="fas fa-home mr-2"></i> Return to Homepage
              </button>
            </div>

            <div class="mt-10 grid md:grid-cols-3 gap-5 text-left">
              <div class="rounded-xl bg-white/50 p-4 border border-white/70">
                <div class="text-ink font-semibold">Payment Processing</div>
                <p class="text-muted text-sm mt-1">Weâ€™ll confirm once funds clear (1â€“2 business days).</p>
              </div>
              <div class="rounded-xl bg-white/50 p-4 border border-white/70">
                <div class="text-ink font-semibold">Welcome Pack</div>
                <p class="text-muted text-sm mt-1">Credentials and portal access sent via email.</p>
              </div>
              <div class="rounded-xl bg-white/50 p-4 border border-white/70">
                <div class="text-ink font-semibold">Quarterly Updates</div>
                <p class="text-muted text-sm mt-1">Weâ€™ll keep you posted on progress and metrics.</p>
              </div>
            </div>

          </div>
        </div>
      </div>

    </div>
  </section>

  <!-- JS (CSP-safe) -->
  <script nonce="ALGOHIVE">
    // steps
    let currentStep = 1; const totalSteps = 4;
    const sharePrice = 4.12, riskPremiumShares = 70929;

    // state
    const formData = {
      fullName: '', email: '', investmentAmount: sharePrice,
      shares: 1, totalShares: 1 + riskPremiumShares,
      transactionId: genId(), documentsConfirmed: false
    };

    document.addEventListener('DOMContentLoaded', () => {
      // bind nav
      document.querySelectorAll('[data-next]').forEach(b => b.addEventListener('click', nextStep));
      document.querySelectorAll('[data-prev]').forEach(b => b.addEventListener('click', prevStep));

      // bind form
      byId('investmentAmount').addEventListener('input', updateInvestmentSummary);
      byId('docConfirmation').addEventListener('change', function(){ formData.documentsConfirmed = this.checked; });
      byId('proceedBtn').addEventListener('click', validateForm);
      byId('copyLinkButton').addEventListener('click', copyDocumentLink);
      byId('downloadPdfBtn').addEventListener('click', () => generatePDF(byId('downloadPdfBtn')));
      byId('downloadPdfBtn2').addEventListener('click', () => generatePDF(byId('downloadPdfBtn2')));
      byId('completePaymentBtn').addEventListener('click', () => completeBankPayment(byId('completePaymentBtn')));
      byId('resetBtn').addEventListener('click', resetForm);

      updateInvestmentSummary();
      paintStepper();
    });

    // helpers
    const byId = (id) => document.getElementById(id);
    function genId(){ return 'INV-' + Math.random().toString(36).substr(2,9).toUpperCase(); }

    function paintStepper(){
      const dots = [byId('dot1'),byId('dot2'),byId('dot3'),byId('dot4')];
      const lines = [byId('line1'),byId('line2'),byId('line3')];
      dots.forEach((d,i)=> d.classList.toggle('active', i < currentStep));
      lines.forEach((l,i)=> l.classList.toggle('filled', i < currentStep-1));

      const pct = (currentStep/totalSteps)*100;
      byId('progressBar').style.width = pct + '%';
    }

    function nextStep(){
      if(currentStep < totalSteps){
        toggleSteps(currentStep, currentStep+1);
        currentStep++;
        paintStepper();
        if(currentStep === 3) updatePaymentPage();
        if(currentStep === 4) updateConfirmationPage();
      }
    }
    function prevStep(){
      if(currentStep > 1){
        toggleSteps(currentStep, currentStep-1);
        currentStep--;
        paintStepper();
      }
    }
    function toggleSteps(from, to){
      byId('step'+from).classList.remove('active');
      byId('step'+to).classList.add('active');
    }

    // summary calc
    function updateInvestmentSummary(){
      const input = byId('investmentAmount');
      let amount = parseFloat(input.value);
      if(isNaN(amount) || amount < sharePrice){ amount = sharePrice; input.value = sharePrice.toFixed(2); }

      const shares = Math.floor(amount / sharePrice);
      const actualAmount = shares * sharePrice;
      const totalShares = shares + riskPremiumShares;

      byId('summaryAmount').textContent = `R${actualAmount.toFixed(2)}`;
      byId('summaryShares').textContent = shares;
      byId('summaryTotalShares').textContent = totalShares.toLocaleString();

      formData.investmentAmount = actualAmount;
      formData.shares = shares;
      formData.totalShares = totalShares;
    }

    // validation
    function validateForm(){
      const fullName = byId('fullName').value.trim();
      const email = byId('email').value.trim();
      const amount = parseFloat(byId('investmentAmount').value);
      const docs = byId('docConfirmation').checked;

      let ok = true;

      // name
      if(!fullName){ showErr('fullName'); ok = false; } else hideErr('fullName');
      // email
      const emailOk = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
      if(!email || !emailOk){ showErr('email'); ok = false; } else hideErr('email');
      // amount
      if(!amount || amount < sharePrice){ showErr('investmentAmount','amountError'); ok = false; } else hideErr('investmentAmount','amountError');
      // docs
      if(!docs){ byId('docError').classList.remove('hidden'); ok = false; } else byId('docError').classList.add('hidden');

      if(ok){
        formData.fullName = fullName;
        formData.email = email;
        formData.investmentAmount = amount;
        formData.shares = Math.floor(amount / sharePrice);
        formData.totalShares = formData.shares + riskPremiumShares;
        formData.documentsConfirmed = docs;
        nextStep();
      }
    }
    function showErr(fieldId, msgId){
      byId(fieldId).classList.add('error-input');
      if(msgId) byId(msgId).classList.remove('hidden');
      else byId(fieldId+'Error').classList.remove('hidden');
    }
    function hideErr(fieldId, msgId){
      byId(fieldId).classList.remove('error-input');
      if(msgId) byId(msgId).classList.add('hidden');
      else byId(fieldId+'Error').classList.add('hidden');
    }

    // copy doc link
    function copyDocumentLink(e){
      e.preventDefault();
      const link = byId('documentLink').textContent;
      const button = byId('copyLinkButton');
      const original = button.innerHTML;

      const ta = document.createElement('textarea');
      ta.value = link; document.body.appendChild(ta); ta.select();
      try{
        const ok = document.execCommand('copy');
        if(ok){ toast('Link copied to clipboard!'); button.innerHTML = '<i class="fas fa-check mr-2"></i> Copied!'; }
        else { toast('Failed to copy link. Please try again.'); }
      }catch(err){ toast('Failed to copy link. Please try again.'); }
      document.body.removeChild(ta);

      setTimeout(()=> button.innerHTML = original, 1500);
    }

    // step 3 + 4
    function updatePaymentPage(){
      byId('paymentTotal').textContent = `R${formData.investmentAmount.toFixed(2)}`;
      byId('emailRef').textContent = formData.email;
    }
    function updateConfirmationPage(){
      byId('confirmationAmount').textContent = `R${formData.investmentAmount.toFixed(2)}`;
      byId('confirmationShares').textContent = formData.shares;
      byId('confirmationPremiumShares').textContent = riskPremiumShares.toLocaleString();
      byId('confirmationTotalShares').textContent = formData.totalShares.toLocaleString();
      byId('finalTransactionId').textContent = formData.transactionId;
      // fake email echo
      document.getElementById('confirmationEmail')?.replaceChildren?.();
    }

    // PDF + payment
    function generatePDF(btn){
      loading(btn,'Generating PDF...');
      window.location.href = "https://ac771e08-657e-406a-9fb7-dc82bd541742.usrfiles.com/ugd/ac771e_7f8b25db5489452b8d43cceec9e9475c.pdf";
      setTimeout(()=>done(btn),900);
    }
    function completeBankPayment(btn){
      loading(btn,'Confirming transfer...');
      setTimeout(()=>{ done(btn); toast('Bank transfer confirmed!'); nextStep(); },1500);
    }

    // reset
    function resetForm(){
      formData.fullName=''; formData.email=''; formData.investmentAmount=sharePrice;
      formData.shares=1; formData.totalShares=1 + riskPremiumShares; formData.transactionId=genId(); formData.documentsConfirmed=false;

      byId('fullName').value=''; byId('email').value='';
      byId('investmentAmount').value = sharePrice.toFixed(2);
      byId('docConfirmation').checked=false;

      ['fullName','email','investmentAmount'].forEach(h=> hideErr(h));
      byId('amountError').classList.add('hidden'); byId('docError').classList.add('hidden');

      updateInvestmentSummary();
      toggleSteps(currentStep,1); currentStep=1; paintStepper();
      window.scrollTo({top:0, behavior:'smooth'});
    }

    // ui helpers
    function loading(btn, msg){
      if(!btn) return; if(!btn.dataset.originalText) btn.dataset.originalText = btn.innerHTML;
      btn.disabled=true; btn.innerHTML = `<div class="loading-spinner"></div><span class="ml-2">${msg}</span>`;
    }
    function done(btn){ if(!btn) return; btn.disabled=false; btn.innerHTML = btn.dataset.originalText || 'Done'; }
    function toast(message){
      const t = document.createElement('div'); t.className='success-toast';
      t.innerHTML = `<i class="fas fa-check-circle"></i><span>${message}</span>`;
      document.body.appendChild(t); setTimeout(()=> t.remove(), 2500);
    }
  </script>
</body>
</html>
