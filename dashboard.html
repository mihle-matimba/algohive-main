<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AlgoHive — Dashboard</title>

  <!-- Tailwind + Fonts + Icons -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>

  <style>
    :root { --olive:#556B2F; --olive-700:#3e4f23; --olive-100:#ecf4e6; --page-bg:#f9fafb; }
    html,body{font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:var(--page-bg);color:#0f172a}
    .card{background:#fff;border:1px solid #e5e7eb;border-radius:1rem;box-shadow:0 1px 2px rgba(0,0,0,.04)}
    .chip{display:inline-flex;align-items:center;border-radius:9999px;padding:.2rem .55rem;font-size:.74rem;font-weight:600}
    .glass{backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px);background:rgba(255,255,255,.65);border-bottom:1px solid rgba(229,231,235,.9)}
    .num{font-variant-numeric:tabular-nums}
    .tab-btn{border:1px solid #e5e7eb;border-radius:.6rem;padding:.35rem .7rem;font-size:.85rem;background:#fff}
    .tab-btn.active{background:var(--olive);border-color:var(--olive);color:#fff}
    .aside-rail{width:340px}
    @media (max-width:1024px){.aside-rail{width:auto}}

    /* Equity tooltip */
    .eq-tip{position:absolute;pointer-events:none;background:#111827;color:#fff;font-size:.75rem;border-radius:.5rem;padding:.35rem .5rem;box-shadow:0 10px 25px rgba(0,0,0,.12)}
    .spark{height:30px;width:120px}
  </style>
</head>
<body>
  <div class="min-h-screen flex">
    <!-- GLOBAL MENU (partial) -->
    <div id="sidebarMount" data-menu="/partials/menu.html"></div>

    <!-- MAIN -->
    <main class="flex-1 min-h-screen">
      <!-- Topbar -->
      <section class="glass sticky top-0 z-10">
        <div class="max-w-7xl mx-auto px-6 py-4 flex items-center gap-3">
          <div>
            <div id="greet" class="text-xl font-semibold">Dashboard</div>
            <p class="text-xs text-slate-600 -mt-1">Your portfolio, performance, risk and latest activity at a glance.</p>
          </div>
          <div class="ml-auto flex items-center gap-2">
            <div class="hidden md:flex items-center border rounded-full px-3 h-10 bg-white">
              <i class="fa-solid fa-magnifying-glass mr-2 text-gray-500"></i>
              <input id="search" placeholder="Search anything…" class="outline-none text-sm w-56"/>
            </div>
            <button class="border rounded-lg h-10 px-3 bg-white"><i class="fa-solid fa-file-arrow-down mr-2"></i>Export</button>
          </div>
        </div>
      </section>

      <!-- Content -->
      <section class="max-w-7xl mx-auto px-6 py-6 grid grid-cols-1 lg:grid-cols-12 gap-6">

        <!-- LEFT COLUMN -->
        <div class="lg:col-span-8 xl:col-span-9 space-y-6">

          <!-- EQUITY CURVE (hero) -->
          <div class="card p-5">
            <div class="flex flex-wrap items-center justify-between gap-3 mb-3">
              <div>
                <div class="text-sm text-slate-600">Equity Curve</div>
                <div class="flex items-center gap-2">
                  <div id="eqValue" class="text-2xl font-semibold num">R —</div>
                  <span id="eqDelta" class="chip bg-green-50 text-green-700">+0.0%</span>
                </div>
              </div>
              <div class="flex gap-2" id="eqTabs">
                <button class="tab-btn active" data-range="1M">1M</button>
                <button class="tab-btn" data-range="3M">3M</button>
                <button class="tab-btn" data-range="6M">6M</button>
                <button class="tab-btn" data-range="YTD">YTD</button>
                <button class="tab-btn" data-range="1Y">1Y</button>
                <button class="tab-btn" data-range="3Y">3Y</button>
              </div>
            </div>

            <!-- FIVE METRICS (top of the card) -->
            <div id="eqMetrics" class="mb-4 grid grid-cols-2 sm:grid-cols-5 gap-3 text-sm">
              <div class="p-3 border rounded-xl">
                <div class="text-slate-500 text-xs">Return</div>
                <div id="mRet" class="font-semibold">—</div>
              </div>
              <div class="p-3 border rounded-xl">
                <div class="text-slate-500 text-xs">Max Drawdown</div>
                <div id="mDD" class="font-semibold">—</div>
              </div>
              <div class="p-3 border rounded-xl">
                <div class="text-slate-500 text-xs">Sharpe (sim.)</div>
                <div id="mSharpe" class="font-semibold">—</div>
              </div>
              <div class="p-3 border rounded-xl">
                <div class="text-slate-500 text-xs">Win Rate</div>
                <div id="mWin" class="font-semibold">—</div>
              </div>
              <div class="p-3 border rounded-xl">
                <div class="text-slate-500 text-xs">Volatility</div>
                <div id="mVol" class="font-semibold">—</div>
              </div>
            </div>

            <div id="eqWrap" class="relative w-full h-[320px] overflow-hidden rounded-xl border bg-white">
              <svg id="eqSvg" viewBox="0 0 900 320" class="w-full h-full"></svg>
              <div id="eqTip" class="eq-tip hidden"></div>
            </div>
          </div>

          <!-- Subscribed Strategies (container) -->
          <div class="card p-5">
            <div class="flex items-center justify-between mb-3">
              <div class="font-semibold">Subscribed Strategies</div>
              <a href="/open-strategies.html" class="text-sm text-[var(--olive-700)] hover:underline">Manage</a>
            </div>
            <div id="subsWrap" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3"></div>
          </div>

          <!-- Popular Assets -->
          <div class="card">
            <div class="px-5 py-4 border-b flex items-center justify-between">
              <div class="font-semibold">Popular Assets</div>
              <div class="text-xs text-slate-500">Based on your subs + watchlist</div>
            </div>
            <div class="divide-y" id="popularAssets"></div>
          </div>
        </div>

        <!-- RIGHT COLUMN -->
        <aside class="lg:col-span-4 xl:col-span-3 space-y-6 aside-rail">

          <!-- Portfolio Rating (black → olive gradient) + account dropdown -->
          <div class="card p-5">
            <div class="flex items-center justify-between mb-3">
              <div class="font-semibold">Portfolio Rating</div>
              <select id="acctSel" class="border rounded-lg text-sm px-2 py-1">
                <option value="all">All accounts</option>
                <option value="ibkr">IBKR Pro · U1234567</option>
                <option value="paper">Paper · DU7654321</option>
              </select>
            </div>
            <div class="flex items-center gap-4">
              <svg id="ratingGauge" viewBox="0 0 160 160" class="h-36 w-36"></svg>
              <div>
                <div id="ratingText" class="text-lg font-semibold">—</div>
                <div class="text-xs text-slate-500">Overall rating performance</div>
                <div class="mt-2">
                  <span id="ratingDeltaChip" class="chip bg-green-50 text-green-700">+0.0%</span>
                  <span class="text-xs text-slate-500 ml-1">From last year</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Asset Allocation (replaces Last Investments) -->
          <div class="card">
            <div class="px-5 py-4 border-b font-semibold">Asset Allocation</div>
            <div id="allocBars" class="p-5 space-y-4"></div>
          </div>

        </aside>
      </section>
    </main>
  </div>

  <script>
  /* =================== MENU PARTIAL =================== */
  async function loadMenu(){
    const mount=document.getElementById('sidebarMount');
    const url=(mount.getAttribute('data-menu')||'/partials/menu.html').trim();
    const res=await fetch(url,{cache:'no-store'});
    if(!res.ok) throw new Error('Failed to load '+url);
    mount.outerHTML=await res.text();
  }
  function buildMenu(activeKey='dashboard'){
    const navContainer=document.getElementById('navContainer');
    if(!navContainer) return;
    const menu=[{section:"Menu",items:[
      {key:"dashboard",label:"Dashboard",icon:"fa-gauge",href:"/dashboard.html"},
      {key:"open-strategies",label:"Open Strategies",icon:"fa-cubes",href:"/open-strategies.html"},
      {key:"portfolio",label:"My Portfolio",icon:"fa-chart-line",href:"/portfolio.html"},
      {key:"funding",label:"Funding",icon:"fa-wallet",href:"/funding.html"},
      {key:"reports",label:"Reports",icon:"fa-file-invoice",href:"/reports.html"},
      {key:"news",label:"News & Insights",icon:"fa-newspaper",href:"/news.html"},
      {key:"alerts",label:"Notifications",icon:"fa-bell",href:"/alerts.html"},
    ]},{section:"General",items:[
      {key:"settings",label:"Settings",icon:"fa-gear",href:"/settings.html"},
      {key:"help",label:"Help Desk",icon:"fa-circle-question",href:"/help.html"},
      {key:"integration",label:"Integration",icon:"fa-plug",href:"/integrations.html"},
      {key:"feedback",label:"Feedback",icon:"fa-comment-dots",href:"/feedback.html"},
    ]}];
    function group(sec){
      const g=document.createElement('div'); g.className='mb-2';
      const header=document.createElement('button'); header.className='w-full flex items-center justify-between px-2 py-1'; header.setAttribute('aria-expanded','true');
      const title=document.createElement('div'); title.className='section-title'; title.textContent=sec.section;
      const right=document.createElement('div'); right.className='label'; right.innerHTML='<i class="fa-solid fa-chevron-up chev text-xs"></i>';
      const body=document.createElement('div'); body.className='group-body';
      const list=document.createElement('nav'); list.className='space-y-1 px-0.5';
      sec.items.forEach(it=>{ const a=document.createElement('a'); a.href=it.href; a.className='sidebar-link'; a.title=it.label;
        if(it.key===activeKey) a.classList.add('active');
        a.innerHTML=`<i class="fa-solid ${it.icon}"></i><span class="label">${it.label}</span>`; list.appendChild(a); });
      body.appendChild(list); header.append(title,right); g.append(header,body);
      requestAnimationFrame(()=>{ body.style.maxHeight=body.scrollHeight+'px'; });
      header.addEventListener('click',()=>{ const exp=header.getAttribute('aria-expanded')==='true';
        header.setAttribute('aria-expanded',String(!exp));
        const chev=header.querySelector('.chev');
        if(exp){ body.style.maxHeight='0px'; chev.classList.add('rot'); } else { body.style.maxHeight=body.scrollHeight+'px'; chev.classList.remove('rot'); }});
      return g;
    }
    navContainer.innerHTML=''; menu.forEach(s=>navContainer.appendChild(group(s)));

    const sidebar=document.getElementById('sidebar');
    const collapseBtn=document.getElementById('collapseBtn'); let collapsed=false;
    collapseBtn?.addEventListener('click',()=>{collapsed=!collapsed; sidebar.classList.toggle('is-collapsed',collapsed);
      collapseBtn.innerHTML=collapsed?'<i class="fa-solid fa-angles-right text-sm"></i>':'<i class="fa-solid fa-angles-left text-sm"></i>';
      try{sessionStorage.setItem('ah_sidebar_collapsed',collapsed?'1':'0');}catch(e){};});
    try{ if(sessionStorage.getItem('ah_sidebar_collapsed')==='1'){collapsed=true; sidebar.classList.add('is-collapsed'); if(collapseBtn) collapseBtn.innerHTML='<i class="fa-solid fa-angles-right text-sm"></i>';}}catch(e){}
  }

  /* =================== UTIL =================== */
  const fmtMoney=v=> new Intl.NumberFormat('en-ZA',{style:'currency',currency:'ZAR',maximumFractionDigits:0}).format(v);
  const greetLine=()=>{const h=new Date().getHours();const t=h<12?'Good morning':(h<18?'Good afternoon':'Good evening');return `${t}, Mihle`;};

  function sparkSvg(series, color='#0f172a'){
    const w=120,h=30,pad=3,min=Math.min(...series),max=Math.max(...series),rng=(max-min)||1;
    const step=(w-2*pad)/(series.length-1);
    let d='';
    series.forEach((v,i)=>{const x=pad+i*step;const y=h-pad-( (v-min)/rng )*(h-2*pad); d+=(i?'L':'M')+x.toFixed(2)+','+y.toFixed(2)+' ';});
    return `<svg class="spark" viewBox="0 0 ${w} ${h}" preserveAspectRatio="none"><path d="${d.trim()}" fill="none" stroke="${color}" stroke-width="2"/></svg>`;
  }

  /* ===== Equity curve drawing (area + line + tooltip) ===== */
  function drawEquity(svgEl, series, labels){
    const W=900,H=320,pad=34;
    svgEl.innerHTML='';

    // grid
    for(let i=0;i<5;i++){
      const y=pad+i*(H-2*pad)/4;
      const ln=document.createElementNS('http://www.w3.org/2000/svg','line');
      ln.setAttribute('x1',pad); ln.setAttribute('x2',W-pad); ln.setAttribute('y1',y); ln.setAttribute('y2',y);
      ln.setAttribute('stroke','#e5e7eb'); ln.setAttribute('stroke-width','1');
      svgEl.appendChild(ln);
    }

    const min=Math.min(...series), max=Math.max(...series), rng=(max-min)||1;
    const step=(W-2*pad)/(series.length-1);
    const X=i=> pad+i*step;
    const Y=v=> H-pad - ((v-min)/rng)*(H-2*pad);

    // defs: gradient for fill (olive→black fade)
    const defs=document.createElementNS('http://www.w3.org/2000/svg','defs');
    const grad=document.createElementNS('http://www.w3.org/2000/svg','linearGradient');
    grad.setAttribute('id','eqGrad'); grad.setAttribute('x1','0'); grad.setAttribute('y1','0'); grad.setAttribute('x2','0'); grad.setAttribute('y2','1');
    const st1=document.createElementNS('http://www.w3.org/2000/svg','stop'); st1.setAttribute('offset','0%');  st1.setAttribute('stop-color','#556B2F'); st1.setAttribute('stop-opacity','.28');
    const st2=document.createElementNS('http://www.w3.org/2000/svg','stop'); st2.setAttribute('offset','100%'); st2.setAttribute('stop-color','#111827'); st2.setAttribute('stop-opacity','0.02');
    grad.append(st1,st2); defs.appendChild(grad); svgEl.appendChild(defs);

    // area + line
    let dLine='', dArea='';
    series.forEach((v,i)=>{ const x=X(i), y=Y(v); dLine += `${i?'L':'M'}${x.toFixed(2)},${y.toFixed(2)} `; });
    dArea = dLine + `L${X(series.length-1).toFixed(2)},${H-pad} L${X(0).toFixed(2)},${H-pad} Z`;

    const area=document.createElementNS('http://www.w3.org/2000/svg','path');
    area.setAttribute('d', dArea.trim()); area.setAttribute('fill','url(#eqGrad)'); svgEl.appendChild(area);

    const line=document.createElementNS('http://www.w3.org/2000/svg','path');
    line.setAttribute('d', dLine.trim()); line.setAttribute('fill','none');
    line.setAttribute('stroke','#0f172a'); line.setAttribute('stroke-width','2.75'); svgEl.appendChild(line);

    const dot=document.createElementNS('http://www.w3.org/2000/svg','circle');
    dot.setAttribute('cx',X(series.length-1)); dot.setAttribute('cy',Y(series.at(-1)));
    dot.setAttribute('r','4.2'); dot.setAttribute('fill','#0f172a'); svgEl.appendChild(dot);

    // x labels
    const gL=document.createElementNS('http://www.w3.org/2000/svg','g');
    labels.forEach((lb,i)=>{ const t=document.createElementNS('http://www.w3.org/2000/svg','text');
      t.textContent=lb; t.setAttribute('x',X(i)); t.setAttribute('y',H-8); t.setAttribute('font-size','10'); t.setAttribute('text-anchor','middle'); t.setAttribute('fill','#64748b'); gL.appendChild(t); });
    svgEl.appendChild(gL);
  }

  function calcMetrics(series){
    const first=series[0], last=series.at(-1);
    const ret=((last/first)-1)*100;

    // max drawdown
    let peak=series[0], maxDD=0;
    for(const v of series){ peak=Math.max(peak,v); maxDD=Math.min(maxDD,(v/peak-1)); }
    const ddPct = Math.abs(maxDD*100);

    // simple pct-change series
    const rets=[]; for(let i=1;i<series.length;i++) rets.push((series[i]/series[i-1])-1);
    const avg = rets.reduce((a,b)=>a+b,0)/rets.length;
    const sd = Math.sqrt(rets.reduce((a,b)=>a+(b-avg)*(b-avg),0)/rets.length) || 0.00001;
    const sharpe = (avg/sd)*Math.sqrt(12);         // monthly-ish annualization
    const wins = rets.filter(r=>r>0).length / rets.length * 100;
    const vol = sd*Math.sqrt(12)*100;              // annualized vol %

    return {ret, ddPct, sharpe, wins, vol};
  }

  /* ===== Portfolio rating donut (black → olive) ===== */
  function drawDonut(el, percent){
    const r=68, cx=80, cy=80, C=2*Math.PI*r, val=Math.max(0,Math.min(100,percent));
    el.innerHTML='';
    const defs=document.createElementNS('http://www.w3.org/2000/svg','defs');
    const grad=document.createElementNS('http://www.w3.org/2000/svg','linearGradient'); grad.setAttribute('id','gOlive');
    grad.setAttribute('x1','0%'); grad.setAttribute('y1','0%'); grad.setAttribute('x2','100%'); grad.setAttribute('y2','0%');
    const s1=document.createElementNS('http://www.w3.org/2000/svg','stop'); s1.setAttribute('offset','0%'); s1.setAttribute('stop-color','#000000');
    const s2=document.createElementNS('http://www.w3.org/2000/svg','stop'); s2.setAttribute('offset','60%'); s2.setAttribute('stop-color','#111827');
    const s3=document.createElementNS('http://www.w3.org/2000/svg','stop'); s3.setAttribute('offset','100%'); s3.setAttribute('stop-color','#556B2F');
    grad.append(s1,s2,s3); defs.appendChild(grad); el.appendChild(defs);

    const bg=document.createElementNS('http://www.w3.org/2000/svg','circle');
    bg.setAttribute('cx',cx); bg.setAttribute('cy',cy); bg.setAttribute('r',r);
    bg.setAttribute('fill','none'); bg.setAttribute('stroke','#e5e7eb'); bg.setAttribute('stroke-width','16'); el.appendChild(bg);

    const arc=document.createElementNS('http://www.w3.org/2000/svg','circle');
    arc.setAttribute('cx',cx); arc.setAttribute('cy',cy); arc.setAttribute('r',r);
    arc.setAttribute('fill','none'); arc.setAttribute('stroke','url(#gOlive)'); arc.setAttribute('stroke-width','16');
    arc.setAttribute('stroke-linecap','round'); arc.setAttribute('transform','rotate(-90 80 80)');
    arc.setAttribute('stroke-dasharray', `${(val/100)*C} ${C}`); el.appendChild(arc);

    const txt=document.createElementNS('http://www.w3.org/2000/svg','text');
    txt.textContent=val.toFixed(0)+'%'; txt.setAttribute('x',cx); txt.setAttribute('y',cy+5);
    txt.setAttribute('text-anchor','middle'); txt.setAttribute('font-size','20'); txt.setAttribute('font-weight','700'); txt.setAttribute('fill','#0f172a');
    el.appendChild(txt);
  }

  /* =================== BOOT =================== */
  (async function(){
    await loadMenu();
    buildMenu('dashboard');

    // Greeting
    document.getElementById('greet').textContent = greetLine();

    /* -------- Equity Curve Data -------- */
    const base = 1_000_000; // starting capital for display
    const EQ = {
      "1M":  { lbl: ['W1','W2','W3','W4','W5'], arr:[1.00,1.03,1.01,1.06,1.09] },
      "3M":  { lbl: ['M1','M2','M3'],           arr:[1.00,1.07,1.12] },
      "6M":  { lbl: ['M1','M2','M3','M4','M5','M6'], arr:[1.00,1.04,1.02,1.09,1.13,1.18] },
      "YTD": { lbl: ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep'], arr:[1.00,1.03,1.02,1.08,1.12,1.15,1.19,1.22,1.27] },
      "1Y":  { lbl: ['J','F','M','A','M','J','J','A','S','O','N','D'], arr:[1.00,1.03,1.01,1.07,1.10,1.12,1.18,1.21,1.25,1.32,1.38,1.43] },
      "3Y":  { lbl: ['Y1','Y2','Y3','Y3+'],     arr:[1.00,1.26,1.58,1.90] }
    };

    const eqSvg = document.getElementById('eqSvg');
    const eqTip = document.getElementById('eqTip');
    const eqWrap = document.getElementById('eqWrap');

    function renderEq(range='1Y'){
      const d = EQ[range] || EQ['1Y'];
      drawEquity(eqSvg, d.arr, d.lbl);

      // headline value + delta
      const first=d.arr[0], last=d.arr.at(-1);
      const value = base*last;
      const delta = ((last/first)-1)*100;
      const vEl=document.getElementById('eqValue'), dEl=document.getElementById('eqDelta');
      vEl.textContent = fmtMoney(value);
      dEl.textContent = (delta>=0?'+':'')+delta.toFixed(2)+'%';
      dEl.className = 'chip ' + (delta>=0?'bg-green-50 text-green-700':'bg-rose-50 text-rose-700');

      // metrics
      const m=calcMetrics(d.arr);
      document.getElementById('mRet').textContent    = (m.ret>=0?'+':'')+m.ret.toFixed(2)+'%';
      document.getElementById('mDD').textContent     = m.ddPct.toFixed(2)+'%';
      document.getElementById('mSharpe').textContent = m.sharpe.toFixed(2);
      document.getElementById('mWin').textContent    = m.wins.toFixed(0)+'%';
      document.getElementById('mVol').textContent    = m.vol.toFixed(1)+'%';

      // tooltip
      const W=eqWrap.clientWidth, pad=34, step=(W-2*pad)/(d.arr.length-1);
      eqWrap.onmousemove = (e)=>{
        const rect=eqWrap.getBoundingClientRect();
        const x=e.clientX-rect.left;
        const idx=Math.max(0,Math.min(d.arr.length-1, Math.round((x-pad)/step)));
        const label=d.lbl[idx];
        const val=fmtMoney(base*d.arr[idx]);
        eqTip.innerHTML = `<div class="font-semibold">${label}</div><div class="num">${val}</div>`;
        eqTip.style.left = Math.min(rect.width-90, Math.max(10, x+12))+'px';
        eqTip.style.top = '12px';
        eqTip.classList.remove('hidden');
      };
      eqWrap.onmouseleave = ()=> eqTip.classList.add('hidden');
    }
    renderEq('1Y');
    document.querySelectorAll('#eqTabs .tab-btn').forEach(b=>{
      b.addEventListener('click', ()=>{
        document.querySelectorAll('#eqTabs .tab-btn').forEach(x=>x.classList.remove('active'));
        b.classList.add('active'); renderEq(b.dataset.range);
      });
    });

    /* -------- Portfolio Rating with account dropdown -------- */
    const ratingByAcct = { all:82, ibkr:78, paper:65 };
    const delta=+5.48;
    function renderRating(acct='all'){
      const pct=ratingByAcct[acct]??82;
      drawDonut(document.getElementById('ratingGauge'), pct);
      document.getElementById('ratingText').textContent = pct>=85?'Excellent':(pct>=70?'Very Good':'Fair');
      const chip=document.getElementById('ratingDeltaChip');
      chip.textContent = (delta>=0?'+':'')+delta.toFixed(2)+'%';
      chip.className = 'chip '+(delta>=0?'bg-green-50 text-green-700':'bg-rose-50 text-rose-700');
    }
    renderRating('all');
    document.getElementById('acctSel').addEventListener('change', (e)=>renderRating(e.target.value));

    /* -------- Asset Allocation -------- */
    const alloc = [
      { label:'Equities',    pct:48, color:'#0f172a' },
      { label:'FX',          pct:18, color:'#10b981' },
      { label:'Crypto',      pct:12, color:'#f59e0b' },
      { label:'Futures',     pct:14, color:'#6366f1' },
      { label:'Commodities', pct:6,  color:'#ef4444' },
      { label:'Cash',        pct:2,  color:'#94a3b8' },
    ];
    const bars = document.getElementById('allocBars');
    bars.innerHTML = alloc.map(a=>`
      <div>
        <div class="flex items-center justify-between text-sm mb-1">
          <div class="flex items-center gap-2"><span class="h-2 w-2 rounded-full inline-block" style="background:${a.color}"></span>${a.label}</div>
          <div class="num">${a.pct}%</div>
        </div>
        <div class="h-2 rounded-full bg-gray-100 overflow-hidden">
          <div class="h-2" style="width:${a.pct}%; background:${a.color}"></div>
        </div>
      </div>
    `).join('');

    /* -------- Subscribed Strategies (container) -------- */
    const subs = [
      { name:'Trend Alpha',     provider:'AlgoForge',  change:+1.8, aum:'R1.2m', series:[10,12,11,13,12,15,14,16] },
      { name:'Momentum FX',     provider:'QuantBee',   change:+0.9, aum:'R820k', series:[8,8.4,8.2,8.6,8.9,9.2,9.6] },
      { name:'Grid Delta',      provider:'GridOps',    change:-0.6, aum:'R540k', series:[7,6.9,6.7,6.8,6.6,6.7,6.5] },
      { name:'NewsPulse',       provider:'PulseAI',    change:+1.2, aum:'R410k', series:[6,6.2,6.4,6.1,6.5,6.7,6.9] },
      { name:'Equity Trend+',   provider:'AlgoForge',  change:+0.4, aum:'R2.0m', series:[9,9.1,9.2,9.3,9.5,9.6,9.8] },
      { name:'Carry FX',        provider:'QuantBee',   change:+0.3, aum:'R300k', series:[5,5.1,5.2,5.15,5.25,5.3,5.35] },
    ];
    const subsWrap = document.getElementById('subsWrap');
    subsWrap.innerHTML = subs.map(s=>`
      <div class="border rounded-xl p-3 hover:bg-[var(--olive-100)] transition">
        <div class="flex items-center justify-between">
          <div class="font-medium text-sm truncate">${s.name}</div>
          <span class="chip ${s.change>=0?'bg-green-50 text-green-700':'bg-rose-50 text-rose-700'}">${s.change>=0?'+':''}${s.change.toFixed(1)}%</span>
        </div>
        <div class="text-xs text-slate-500">${s.provider} · AUM ${s.aum}</div>
        <div class="mt-2">${sparkSvg(s.series, '#0f172a')}</div>
      </div>
    `).join('');

    /* -------- Popular Assets (sample) -------- */
    const popular = [
      { logo:'https://www.google.com/s2/favicons?domain=google.com&sz=64', name:'Google',  ticker:'GOOG',  change:+2.37, price:289.28 },
      { logo:'https://www.google.com/s2/favicons?domain=x.com&sz=64',      name:'Twitter', ticker:'TWTR',  change:-2.37, price:289.28 },
      { logo:'https://www.google.com/s2/favicons?domain=spotify.com&sz=64',name:'Spotify', ticker:'SPOT',  change:+2.37, price:289.28 },
      { logo:'https://www.google.com/s2/favicons?domain=apple.com&sz=64',  name:'Apple',   ticker:'AAPL',  change:+0.70, price:172.40 },
    ];
    const pa=document.getElementById('popularAssets');
    pa.innerHTML = popular.map(a=>`
      <div class="px-5 py-4 flex items-center justify-between">
        <div class="flex items-center gap-3">
          <img src="${a.logo}" class="h-7 w-7 rounded" alt="">
          <div>
            <div class="text-sm font-medium">${a.name}</div>
            <div class="text-xs text-slate-500">${a.ticker}</div>
          </div>
        </div>
        <div class="flex items-center gap-3">
          <span class="chip ${a.change>=0?'bg-emerald-50 text-emerald-700':'bg-amber-50 text-amber-700'}">
            ${a.change>=0?'<i class="fa-solid fa-arrow-up-right mr-1"></i>':'<i class="fa-solid fa-arrow-down-right mr-1"></i>'}
            ${a.change>=0?'+':''}${a.change.toFixed(2)}%
          </span>
          <div class="num text-slate-700">${fmtMoney(a.price)}</div>
        </div>
      </div>
    `).join('');

    // Set greeting on load
    document.getElementById('greet').textContent = greetLine();
  })();
  </script>
</body>
</html>
