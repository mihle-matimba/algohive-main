<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AlgoHive — Dashboard</title>

  <!-- Tailwind + Fonts + Icons -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>

  <style>
    :root { --olive:#556B2F; --olive-700:#3e4f23; --olive-100:#ecf4e6; --page-bg:#f9fafb; }
    html,body{font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:var(--page-bg);color:#0f172a}
    .card{background:#fff;border:1px solid #e5e7eb;border-radius:1rem;box-shadow:0 1px 2px rgba(0,0,0,.04)}
    .stat{display:flex;gap:.75rem;align-items:center}
    .stat i{font-size:1.05rem}
    .num{font-variant-numeric:tabular-nums}
    .chip{display:inline-flex;align-items:center;border-radius:9999px;padding:.2rem .5rem;font-size:.75rem;font-weight:600}
    .glass{backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px);background:rgba(255,255,255,.65);border-bottom:1px solid rgba(229,231,235,.9)}
    .btn{display:inline-flex;align-items:center;gap:.5rem;border-radius:.75rem;padding:.5rem .75rem;border:1px solid #e5e7eb}
    .btn-olive{background:var(--olive);color:#fff;border-color:var(--olive)}
    .aside-rail{width:320px}
    @media (max-width:1024px){.aside-rail{width:auto}}
  </style>
</head>
<body>
  <div class="min-h-screen flex">
    <!-- GLOBAL MENU MOUNT (this will be replaced by /partials/menu.html) -->
    <div id="sidebarMount" data-menu="/partials/menu.html"></div>

    <!-- MAIN -->
    <main class="flex-1 min-h-screen">
      <!-- Topbar -->
      <section class="glass sticky top-0 z-10">
        <div class="max-w-7xl mx-auto px-6 py-4 flex items-center gap-3">
          <h1 class="text-xl font-semibold">Overview</h1>
          <div class="ml-auto flex items-center gap-2">
            <div class="hidden md:flex items-center border rounded-full px-3 h-10 bg-white">
              <i class="fa-solid fa-magnifying-glass mr-2 text-gray-500"></i>
              <input id="search" placeholder="Search anything…" class="outline-none text-sm w-56" />
            </div>
            <button class="btn" title="Export"><i class="fa-solid fa-file-arrow-down"></i><span class="hidden sm:inline">Export</span></button>
            <button class="btn" title="This Month" id="rangeBtn"><span id="rangeLabel">This Month</span><i class="fa-solid fa-chevron-down text-xs"></i></button>
            <img src="https://i.pravatar.cc/80?img=8" class="h-9 w-9 rounded-full object-cover" alt="avatar"/>
          </div>
        </div>
      </section>

      <!-- Content -->
      <section class="max-w-7xl mx-auto px-6 py-6 grid grid-cols-1 lg:grid-cols-12 gap-6">
        <!-- LEFT: main content -->
        <div class="lg:col-span-8 xl:col-span-9 space-y-6">
          <!-- Greeting + KPI tiles -->
          <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
            <div class="card p-4">
              <div class="stat mb-2 text-slate-600"><i class="fa-solid fa-wallet"></i><span>Total Portfolio</span></div>
              <div class="text-2xl font-bold num" id="kpiPortfolio">R0</div>
              <div class="chip bg-green-50 text-green-700 mt-2" id="kpiPortChg">+0.0%</div>
            </div>
            <div class="card p-4">
              <div class="stat mb-2 text-slate-600"><i class="fa-solid fa-arrow-trend-up"></i><span>Monthly P&L</span></div>
              <div class="text-2xl font-bold num" id="kpiPnl">R0</div>
              <div class="chip bg-green-50 text-green-700 mt-2" id="kpiPnlChg">+0.0%</div>
            </div>
            <div class="card p-4">
              <div class="stat mb-2 text-slate-600"><i class="fa-solid fa-cubes"></i><span>Active Strategies</span></div>
              <div class="text-2xl font-bold num" id="kpiStrats">0</div>
              <div class="text-xs text-slate-500 mt-1">Vetted allocations running</div>
            </div>
            <div class="card p-4">
              <div class="stat mb-2 text-slate-600"><i class="fa-solid fa-money-bill-transfer"></i><span>Cash Available</span></div>
              <div class="text-2xl font-bold num" id="kpiCash">R0</div>
              <div class="text-xs text-slate-500 mt-1">Ready to allocate</div>
            </div>
          </div>

          <!-- Performance Overview -->
          <div class="card p-5">
            <div class="flex items-center justify-between mb-3">
              <div>
                <div class="text-sm text-slate-600">Performance Overview</div>
                <div class="text-2xl font-semibold num mt-1" id="perfHeadline">R0</div>
              </div>
              <div class="flex gap-2">
                <button class="btn" data-mode="monthly">Monthly</button>
                <button class="btn" data-mode="yearly">Yearly</button>
              </div>
            </div>
            <div class="text-xs text-slate-500 mb-3">Earnings vs. Drawdown vs. Subscriptions</div>
            <div class="w-full h-[260px] relative overflow-hidden">
              <svg id="perfChart" viewBox="0 0 900 260" class="w-full h-full"></svg>
            </div>
            <div class="mt-3 grid grid-cols-3 gap-3 text-sm">
              <div class="flex items-center gap-2"><span class="h-2 w-2 rounded-full bg-slate-900 inline-block"></span>Earnings</div>
              <div class="flex items-center gap-2"><span class="h-2 w-2 rounded-full bg-emerald-500 inline-block"></span>Subs</div>
              <div class="flex items-center gap-2"><span class="h-2 w-2 rounded-full bg-rose-500 inline-block"></span>Drawdown</div>
            </div>
          </div>

          <!-- Recent Allocations -->
          <div class="card">
            <div class="flex items-center justify-between px-5 py-4 border-b">
              <div class="font-semibold">Recent Allocations</div>
              <div class="flex items-center gap-2">
                <input class="border rounded-lg h-9 px-3 text-sm" placeholder="Search"/>
                <button class="btn"><i class="fa-solid fa-filter"></i> Filter</button>
              </div>
            </div>
            <div class="overflow-x-auto">
              <table class="w-full text-sm">
                <thead class="text-slate-600">
                  <tr>
                    <th class="text-left px-5 py-3">Strategy</th>
                    <th class="text-left px-5 py-3">Provider</th>
                    <th class="text-right px-5 py-3">Amount</th>
                    <th class="text-left px-5 py-3">Date</th>
                    <th class="text-right px-5 py-3">Status</th>
                  </tr>
                </thead>
                <tbody id="allocRows" class="divide-y"></tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- RIGHT: rail -->
        <aside class="lg:col-span-4 xl:col-span-3 space-y-6 aside-rail">
          <!-- Accounts -->
          <div class="card p-5">
            <div class="flex items-center justify-between mb-3">
              <div class="font-semibold">My Accounts</div>
              <a class="text-sm text-[var(--olive-700)] hover:underline" href="#">Manage</a>
            </div>
            <div class="space-y-3">
              <div class="p-3 border rounded-xl flex items-center justify-between">
                <div>
                  <div class="text-sm text-slate-600">IBKR Pro</div>
                  <div class="text-lg font-semibold num">R 1,240,000</div>
                </div>
                <span class="chip bg-green-50 text-green-700">Active</span>
              </div>
              <div class="p-3 border rounded-xl flex items-center justify-between">
                <div>
                  <div class="text-sm text-slate-600">Paper · DU7654321</div>
                  <div class="text-lg font-semibold num">R 250,000</div>
                </div>
                <span class="chip bg-slate-100 text-slate-700">Sandbox</span>
              </div>
            </div>
          </div>

          <!-- Allocation Mix -->
          <div class="card p-5">
            <div class="font-semibold mb-3">Allocation Mix</div>
            <div class="space-y-3 text-sm">
              <div class="flex items-center justify-between">
                <div class="flex items-center gap-2"><span class="h-2 w-2 rounded-full bg-slate-900 inline-block"></span> Trend</div>
                <div class="num">48%</div>
              </div>
              <div class="flex items-center justify-between">
                <div class="flex items-center gap-2"><span class="h-2 w-2 rounded-full bg-emerald-500 inline-block"></span> Mean-Revert</div>
                <div class="num">28%</div>
              </div>
              <div class="flex items-center justify-between">
                <div class="flex items-center gap-2"><span class="h-2 w-2 rounded-full bg-amber-500 inline-block"></span> Grid</div>
                <div class="num">16%</div>
              </div>
              <div class="flex items-center justify-between">
                <div class="flex items-center gap-2"><span class="h-2 w-2 rounded-full bg-rose-500 inline-block"></span> News</div>
                <div class="num">8%</div>
              </div>
            </div>
          </div>

          <!-- CTA -->
          <div class="card p-5">
            <div class="text-sm uppercase tracking-wide text-slate-500 mb-1">Get started</div>
            <div class="text-lg font-semibold mb-2">Allocate to a new strategy</div>
            <p class="text-sm text-slate-600 mb-4">Diversify with vetted providers in minutes.</p>
            <a href="/open-strategies.html" class="btn-olive btn">Explore Strategies <i class="fa-solid fa-arrow-right"></i></a>
          </div>
        </aside>
      </section>
    </main>
  </div>

  <!-- Script: load shared menu, draw chart, sample data -->
  <script>
    /* ========= 1) Load global menu partial ========= */
    async function loadMenu() {
      const mount = document.getElementById('sidebarMount');
      if (!mount) return;
      const hint = (mount.getAttribute('data-menu') || '/partials/menu.html').trim();
      const res = await fetch(hint, { cache: 'no-store' });
      if (!res.ok) {
        console.error('menu.html not found at', hint);
        return;
      }
      const html = await res.text();
      mount.outerHTML = html;
    }

    /* ========= 2) Simple helpers ========= */
    const fmtMoney = (v, cur='ZAR') => {
      try { return new Intl.NumberFormat('en-ZA', { style:'currency', currency:cur }).format(v); }
      catch { return 'R ' + (v||0).toLocaleString(); }
    };

    function drawLines(svgEl, seriesList, opts={}) {
      const W = 900, H = 260, pad = 28;
      svgEl.setAttribute('viewBox', `0 0 ${W} ${H}`);
      svgEl.innerHTML = '';

      // grid
      const grid = document.createElementNS('http://www.w3.org/2000/svg','g');
      for (let i=0;i<5;i++){
        const y = pad + i*(H-2*pad)/4;
        const line = document.createElementNS('http://www.w3.org/2000/svg','line');
        line.setAttribute('x1', pad); line.setAttribute('x2', W-pad);
        line.setAttribute('y1', y);   line.setAttribute('y2', y);
        line.setAttribute('stroke', '#e5e7eb'); line.setAttribute('stroke-width','1');
        grid.appendChild(line);
      }
      svgEl.appendChild(grid);

      // scales
      const allVals = seriesList.flatMap(s => s.data);
      const min = Math.min(...allVals), max = Math.max(...allVals);
      const rng = (max-min)||1;
      const x = i => pad + i*((W-2*pad)/(seriesList[0].data.length-1));
      const y = v => H-pad - ( (v-min)/rng )*(H-2*pad);

      // axes labels (months)
      const months = (opts.labels || []).slice(0, seriesList[0].data.length);
      if (months.length){
        const g = document.createElementNS('http://www.w3.org/2000/svg','g');
        months.forEach((m,i)=>{
          const t = document.createElementNS('http://www.w3.org/2000/svg','text');
          t.textContent = m; t.setAttribute('x', x(i)); t.setAttribute('y', H-6);
          t.setAttribute('font-size','10'); t.setAttribute('text-anchor','middle'); t.setAttribute('fill','#64748b');
          g.appendChild(t);
        });
        svgEl.appendChild(g);
      }

      // draw paths
      seriesList.forEach(s=>{
        let d='';
        s.data.forEach((v,i)=>{ d += `${i?'L':'M'}${x(i).toFixed(2)},${y(v).toFixed(2)} `; });
        const p = document.createElementNS('http://www.w3.org/2000/svg','path');
        p.setAttribute('d', d.trim());
        p.setAttribute('fill','none');
        p.setAttribute('stroke', s.color || '#0f172a');
        p.setAttribute('stroke-width','2.5');
        svgEl.appendChild(p);
      });
    }

    /* ========= 3) Page boot ========= */
    (async function(){
      await loadMenu();

      // ----- KPIs (fake demo numbers) -----
      const kpi = {
        portfolio: 1523400,
        portChg: 4.9,
        pnl: 58200,
        pnlChg: 2.3,
        strats: 9,
        cash: 188000
      };
      document.getElementById('kpiPortfolio').textContent = fmtMoney(kpi.portfolio);
      document.getElementById('kpiPortChg').textContent = (kpi.portChg>=0?'+':'') + kpi.portChg.toFixed(1) + '%';
      document.getElementById('kpiPortChg').className = 'chip ' + (kpi.portChg>=0 ? 'bg-green-50 text-green-700' : 'bg-rose-50 text-rose-700');
      document.getElementById('kpiPnl').textContent = fmtMoney(kpi.pnl);
      document.getElementById('kpiPnlChg').textContent = (kpi.pnlChg>=0?'+':'') + kpi.pnlChg.toFixed(1) + '%';
      document.getElementById('kpiPnlChg').className = 'chip ' + (kpi.pnlChg>=0 ? 'bg-green-50 text-green-700' : 'bg-rose-50 text-rose-700');
      document.getElementById('kpiStrats').textContent = kpi.strats;
      document.getElementById('kpiCash').textContent = fmtMoney(kpi.cash);

      // ----- Chart -----
      const svg = document.getElementById('perfChart');
      const months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
      const monthly = {
        earn:  [22,26,21,28,32,29,35,38,36,42,48,50],
        subs:  [120,140,150,180,210,230,260,280,300,320,340,360],
        dd:    [5,4,6,3,7,4,5,6,3,4,5,4].map(v=> 50 - v) // inverted to plot downward feel
      };
      const yearly = {
        earn: [320, 410, 460, 580, 720],
        subs: [520, 690, 820, 980, 1120],
        dd:   [40, 46, 43, 47, 44].map(v=>120 - v)
      };

      function render(mode='monthly'){
        const data = mode==='monthly' ? monthly : yearly;
        document.getElementById('perfHeadline').textContent =
          mode==='monthly' ? fmtMoney(45567) : fmtMoney(545670);
        const labels = mode==='monthly' ? months : ['2022','2023','2024','2025','2026'];
        drawLines(svg, [
          { data: data.earn, color:'#0f172a' },
          { data: data.subs, color:'#10b981' },
          { data: data.dd,   color:'#ef4444' },
        ], { labels });
      }

      render('monthly');
      document.querySelectorAll('[data-mode]').forEach(btn=>{
        btn.addEventListener('click', ()=>render(btn.dataset.mode));
      });

      // ----- Recent Allocations -----
      const rows = [
        { strat:'Momentum FX', provider:'QuantBee', amt:28000, date:'2025-04-17 14:15', status:'Success' },
        { strat:'Equity Trend Plus', provider:'AlgoForge', amt:125000, date:'2025-04-15 11:30', status:'Pending' },
        { strat:'Grid Alpha', provider:'GridOps', amt:40000, date:'2025-04-10 09:20', status:'Success' },
        { strat:'NewsPulse', provider:'PulseAI', amt:25000, date:'2025-04-07 16:05', status:'Failed' },
      ];
      const tbody = document.getElementById('allocRows');
      tbody.innerHTML = rows.map(r=>`
        <tr class="hover:bg-slate-50">
          <td class="px-5 py-3">${r.strat}</td>
          <td class="px-5 py-3 text-slate-600">${r.provider}</td>
          <td class="px-5 py-3 text-right num">${fmtMoney(r.amt)}</td>
          <td class="px-5 py-3">${r.date}</td>
          <td class="px-5 py-3 text-right">
            <span class="chip ${r.status==='Success'?'bg-green-50 text-green-700': r.status==='Pending'?'bg-amber-50 text-amber-700':'bg-rose-50 text-rose-700'}">${r.status}</span>
          </td>
        </tr>
      `).join('');
    })();
  </script>
</body>
</html>
